!function(){var e,t,r=function(e){var t;return function(r){return t||e(t={exports:{},parent:r},t.exports),t.exports}},n=r(function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const r=i({});t.DB=class{constructor(e){let{secret:t,debug:n}=e||{};P.default("biota").enabled=n,this.client=new Nr.Client({secret:t}),this.query=r.query.bind(this),this.paginate=r.paginate.bind(this),this.login=r.login.bind(this),this.relation=r.relation.bind(this),this.execute=jn.execute.bind(this),this.foundation=r.foundation.bind(this),this.collection=r.collection.bind(this),this.framework=r,function(e,t){const r=t=>{let n=Object.entries(t);for(let[i,o]of n)t[i]="object"==typeof o?r(o):"function"==typeof o?o.bind(e):o;return t};r(e.framework||{})}(this)}}}),i=r(function(e,t){"use strict";function r(e){for(var r in e)t.hasOwnProperty(r)||(t[r]=e[r])}Object.defineProperty(t,"__esModule",{value:!0}),r(Kn),r(o({})),r(Yn),r(Zn),r(ki),r(Di)}),o=r(function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const r=n({});t.login=async function(e,t){return jn.execute([{name:`Loggin in as (${e})`,task(){return this.query(Wr.collection("users").login(e,t)).then(({secret:e})=>new r.DB({secret:e}))}}],{domain:"DB.login"})}}),a=r(function(e,t){var r=s({}),n=e.exports;for(var i in r)r.hasOwnProperty(i)&&(n[i]=r[i]);function o(e){if("string"==typeof e&&(e=mr.parse(e)),e.protocol||(e.protocol="https:"),"https:"!==e.protocol)throw new Error('Protocol "'+e.protocol+'" not supported. Expected "https:"');return e}n.request=function(e,t){return e=o(e),r.request.call(this,e,t)},n.get=function(e,t){return e=o(e),r.get.call(this,e,t)}}),s=r(function(e,t){(function(e){var r=t;r.request=function(t,r){t="string"==typeof t?mr.parse(t):ir(t);var n=-1===e.location.protocol.search(/^https?:$/)?"http:":"",i=t.protocol||n,o=t.hostname||t.host,a=t.port,s=t.path||"/";o&&-1!==o.indexOf(":")&&(o="["+o+"]"),t.url=(o?i+"//"+o:"")+(a?":"+a:"")+s,t.method=(t.method||"GET").toUpperCase(),t.headers=t.headers||{};var u=new nr(t);return r&&u.on("response",r),u},r.get=function(e,t){var n=r.request(e,t);return n.end(),n},r.ClientRequest=nr,r.IncomingMessage=rr.IncomingMessage,r.Agent=function(){},r.Agent.defaultMaxSockets=4,r.globalAgent=new r.Agent,r.STATUS_CODES=ar,r.METHODS=["CHECKOUT","CONNECT","COPY","DELETE","GET","HEAD","LOCK","M-SEARCH","MERGE","MKACTIVITY","MKCOL","MOVE","NOTIFY","OPTIONS","PATCH","POST","PROPFIND","PROPPATCH","PURGE","PUT","REPORT","SEARCH","SUBSCRIBE","TRACE","UNLOCK","UNSUBSCRIBE"]}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})}),u=r(function(e,t){(function(t,r){"use strict";var n;e.exports=O,O.ReadableState=E,Ye.EventEmitter;var i,o=function(e,t){return e.listeners(t).length},a=y({}).Buffer,s=r.Uint8Array||function(){};i=yt&&yt.debuglog?yt.debuglog("stream"):function(){};var u,f,p,m=At.getHighWaterMark,b=Et.codes,g=b.ERR_INVALID_ARG_TYPE,v=b.ERR_STREAM_PUSH_AFTER_EOF,w=b.ERR_METHOD_NOT_IMPLEMENTED,_=b.ERR_STREAM_UNSHIFT_AFTER_END_EVENT;Ke(O,ht);var q=xt.errorOrDestroy,x=["error","close","destroy","pause","resume"];function E(e,t,r){n=n||h({}),e=e||{},"boolean"!=typeof r&&(r=t instanceof n),this.objectMode=!!e.objectMode,r&&(this.objectMode=this.objectMode||!!e.readableObjectMode),this.highWaterMark=m(this,e,"readableHighWaterMark",r),this.buffer=new qt,this.length=0,this.pipes=null,this.pipesCount=0,this.flowing=null,this.ended=!1,this.endEmitted=!1,this.reading=!1,this.sync=!0,this.needReadable=!1,this.emittedReadable=!1,this.readableListening=!1,this.resumeScheduled=!1,this.paused=!0,this.emitClose=!1!==e.emitClose,this.autoDestroy=!!e.autoDestroy,this.destroyed=!1,this.defaultEncoding=e.defaultEncoding||"utf8",this.awaitDrain=0,this.readingMore=!1,this.decoder=null,this.encoding=null,e.encoding&&(u||(u=d({}).StringDecoder),this.decoder=new u(e.encoding),this.encoding=e.encoding)}function O(e){if(n=n||h({}),!(this instanceof O))return new O(e);var t=this instanceof n;this._readableState=new E(e,this,t),this.readable=!0,e&&("function"==typeof e.read&&(this._read=e.read),"function"==typeof e.destroy&&(this._destroy=e.destroy)),ht.call(this)}function S(e,t,r,n,o){i("readableAddChunk",t);var u,c=e._readableState;if(null===t)c.reading=!1,function(e,t){if(i("onEofChunk"),!t.ended){if(t.decoder){var r=t.decoder.end();r&&r.length&&(t.buffer.push(r),t.length+=t.objectMode?1:r.length)}t.ended=!0,t.sync?T(e):(t.needReadable=!1,t.emittedReadable||(t.emittedReadable=!0,P(e)))}}(e,c);else if(o||(u=function(e,t){var r,n;return n=t,a.isBuffer(n)||n instanceof s||"string"==typeof t||void 0===t||e.objectMode||(r=new g("chunk",["string","Buffer","Uint8Array"],t)),r}(c,t)),u)q(e,u);else if(c.objectMode||t&&t.length>0)if("string"==typeof t||c.objectMode||Object.getPrototypeOf(t)===a.prototype||(t=function(e){return a.from(e)}(t)),n)c.endEmitted?q(e,new _):C(e,c,t,!0);else if(c.ended)q(e,new v);else{if(c.destroyed)return!1;c.reading=!1,c.decoder&&!r?(t=c.decoder.write(t),c.objectMode||0!==t.length?C(e,c,t,!1):I(e,c)):C(e,c,t,!1)}else n||(c.reading=!1,I(e,c));return!c.ended&&(c.length<c.highWaterMark||0===c.length)}function C(e,t,r,n){t.flowing&&0===t.length&&!t.sync?(t.awaitDrain=0,e.emit("data",r)):(t.length+=t.objectMode?1:r.length,n?t.buffer.unshift(r):t.buffer.push(r),t.needReadable&&T(e)),I(e,t)}Object.defineProperty(O.prototype,"destroyed",{enumerable:!1,get:function(){return void 0!==this._readableState&&this._readableState.destroyed},set:function(e){this._readableState&&(this._readableState.destroyed=e)}}),O.prototype.destroy=xt.destroy,O.prototype._undestroy=xt.undestroy,O.prototype._destroy=function(e,t){t(e)},O.prototype.push=function(e,t){var r,n=this._readableState;return n.objectMode?r=!0:"string"==typeof e&&((t=t||n.defaultEncoding)!==n.encoding&&(e=a.from(e,t),t=""),r=!0),S(this,e,t,!1,r)},O.prototype.unshift=function(e){return S(this,e,null,!0,!1)},O.prototype.isPaused=function(){return!1===this._readableState.flowing},O.prototype.setEncoding=function(e){u||(u=d({}).StringDecoder);var t=new u(e);this._readableState.decoder=t,this._readableState.encoding=this._readableState.decoder.encoding;for(var r=this._readableState.buffer.head,n="";null!==r;)n+=t.write(r.data),r=r.next;return this._readableState.buffer.clear(),""!==n&&this._readableState.buffer.push(n),this._readableState.length=n.length,this};var R=1073741824;function A(e,t){return e<=0||0===t.length&&t.ended?0:t.objectMode?1:e!=e?t.flowing&&t.length?t.buffer.head.data.length:t.length:(e>t.highWaterMark&&(t.highWaterMark=function(e){return e>=R?e=R:(e--,e|=e>>>1,e|=e>>>2,e|=e>>>4,e|=e>>>8,e|=e>>>16,e++),e}(e)),e<=t.length?e:t.ended?t.length:(t.needReadable=!0,0))}function T(e){var r=e._readableState;i("emitReadable",r.needReadable,r.emittedReadable),r.needReadable=!1,r.emittedReadable||(i("emitReadable",r.flowing),r.emittedReadable=!0,t.nextTick(P,e))}function P(e){var t=e._readableState;i("emitReadable_",t.destroyed,t.length,t.ended),t.destroyed||!t.length&&!t.ended||(e.emit("readable"),t.emittedReadable=!1),t.needReadable=!t.flowing&&!t.ended&&t.length<=t.highWaterMark,k(e)}function I(e,r){r.readingMore||(r.readingMore=!0,t.nextTick(j,e,r))}function j(e,t){for(;!t.reading&&!t.ended&&(t.length<t.highWaterMark||t.flowing&&0===t.length);){var r=t.length;if(i("maybeReadMore read 0"),e.read(0),r===t.length)break}t.readingMore=!1}function N(e){var t=e._readableState;t.readableListening=e.listenerCount("readable")>0,t.resumeScheduled&&!t.paused?t.flowing=!0:e.listenerCount("data")>0&&e.resume()}function M(e){i("readable nexttick read 0"),e.read(0)}function L(e,t){i("resume",t.reading),t.reading||e.read(0),t.resumeScheduled=!1,e.emit("resume"),k(e),t.flowing&&!t.reading&&e.read(0)}function k(e){var t=e._readableState;for(i("flow",t.flowing);t.flowing&&null!==e.read(););}function D(e,t){return 0===t.length?null:(t.objectMode?r=t.buffer.shift():!e||e>=t.length?(r=t.decoder?t.buffer.join(""):1===t.buffer.length?t.buffer.first():t.buffer.concat(t.length),t.buffer.clear()):r=t.buffer.consume(e,t.decoder),r);var r}function F(e){var r=e._readableState;i("endReadable",r.endEmitted),r.endEmitted||(r.ended=!0,t.nextTick(U,r,e))}function U(e,t){if(i("endReadableNT",e.endEmitted,e.length),!e.endEmitted&&0===e.length&&(e.endEmitted=!0,t.readable=!1,t.emit("end"),e.autoDestroy)){var r=t._writableState;(!r||r.autoDestroy&&r.finished)&&t.destroy()}}function B(e,t){for(var r=0,n=e.length;r<n;r++)if(e[r]===t)return r;return-1}O.prototype.read=function(e){i("read",e),e=parseInt(e,10);var t=this._readableState,r=e;if(0!==e&&(t.emittedReadable=!1),0===e&&t.needReadable&&((0!==t.highWaterMark?t.length>=t.highWaterMark:t.length>0)||t.ended))return i("read: emitReadable",t.length,t.ended),0===t.length&&t.ended?F(this):T(this),null;if(0===(e=A(e,t))&&t.ended)return 0===t.length&&F(this),null;var n,o=t.needReadable;return i("need readable",o),(0===t.length||t.length-e<t.highWaterMark)&&i("length less than watermark",o=!0),t.ended||t.reading?i("reading or ended",o=!1):o&&(i("do read"),t.reading=!0,t.sync=!0,0===t.length&&(t.needReadable=!0),this._read(t.highWaterMark),t.sync=!1,t.reading||(e=A(r,t))),null===(n=e>0?D(e,t):null)?(t.needReadable=t.length<=t.highWaterMark,e=0):(t.length-=e,t.awaitDrain=0),0===t.length&&(t.ended||(t.needReadable=!0),r!==e&&t.ended&&F(this)),null!==n&&this.emit("data",n),n},O.prototype._read=function(e){q(this,new w("_read()"))},O.prototype.pipe=function(e,r){var n=this,a=this._readableState;switch(a.pipesCount){case 0:a.pipes=e;break;case 1:a.pipes=[a.pipes,e];break;default:a.pipes.push(e)}a.pipesCount+=1,i("pipe count=%d opts=%j",a.pipesCount,r);var s=r&&!1===r.end||e===t.stdout||e===t.stderr?y:u;function u(){i("onend"),e.end()}a.endEmitted?t.nextTick(s):n.once("end",s),e.on("unpipe",function t(r,o){i("onunpipe"),r===n&&o&&!1===o.hasUnpiped&&(o.hasUnpiped=!0,i("cleanup"),e.removeListener("close",h),e.removeListener("finish",p),e.removeListener("drain",c),e.removeListener("error",d),e.removeListener("unpipe",t),n.removeListener("end",u),n.removeListener("end",y),n.removeListener("data",f),l=!0,!a.awaitDrain||e._writableState&&!e._writableState.needDrain||c())});var c=function(e){return function(){var t=e._readableState;i("pipeOnDrain",t.awaitDrain),t.awaitDrain&&t.awaitDrain--,0===t.awaitDrain&&o(e,"data")&&(t.flowing=!0,k(e))}}(n);e.on("drain",c);var l=!1;function f(t){i("ondata");var r=e.write(t);i("dest.write",r),!1===r&&((1===a.pipesCount&&a.pipes===e||a.pipesCount>1&&-1!==B(a.pipes,e))&&!l&&(i("false write response, pause",a.awaitDrain),a.awaitDrain++),n.pause())}function d(t){i("onerror",t),y(),e.removeListener("error",d),0===o(e,"error")&&q(e,t)}function h(){e.removeListener("finish",p),y()}function p(){i("onfinish"),e.removeListener("close",h),y()}function y(){i("unpipe"),n.unpipe(e)}return n.on("data",f),function(e,t,r){if("function"==typeof e.prependListener)return e.prependListener("error",r);e._events&&e._events.error?Array.isArray(e._events.error)?e._events.error.unshift(r):e._events.error=[r,e._events.error]:e.on("error",r)}(e,0,d),e.once("close",h),e.once("finish",p),e.emit("pipe",n),a.flowing||(i("pipe resume"),n.resume()),e},O.prototype.unpipe=function(e){var t=this._readableState,r={hasUnpiped:!1};if(0===t.pipesCount)return this;if(1===t.pipesCount)return e&&e!==t.pipes?this:(e||(e=t.pipes),t.pipes=null,t.pipesCount=0,t.flowing=!1,e&&e.emit("unpipe",this,r),this);if(!e){var n=t.pipes,i=t.pipesCount;t.pipes=null,t.pipesCount=0,t.flowing=!1;for(var o=0;o<i;o++)n[o].emit("unpipe",this,{hasUnpiped:!1});return this}var a=B(t.pipes,e);return-1===a?this:(t.pipes.splice(a,1),t.pipesCount-=1,1===t.pipesCount&&(t.pipes=t.pipes[0]),e.emit("unpipe",this,r),this)},O.prototype.on=function(e,r){var n=ht.prototype.on.call(this,e,r),o=this._readableState;return"data"===e?(o.readableListening=this.listenerCount("readable")>0,!1!==o.flowing&&this.resume()):"readable"===e&&(o.endEmitted||o.readableListening||(o.readableListening=o.needReadable=!0,o.flowing=!1,o.emittedReadable=!1,i("on readable",o.length,o.reading),o.length?T(this):o.reading||t.nextTick(M,this))),n},O.prototype.addListener=O.prototype.on,O.prototype.removeListener=function(e,r){var n=ht.prototype.removeListener.call(this,e,r);return"readable"===e&&t.nextTick(N,this),n},O.prototype.removeAllListeners=function(e){var r=ht.prototype.removeAllListeners.apply(this,arguments);return"readable"!==e&&void 0!==e||t.nextTick(N,this),r},O.prototype.resume=function(){var e=this._readableState;return e.flowing||(i("resume"),e.flowing=!e.readableListening,function(e,r){r.resumeScheduled||(r.resumeScheduled=!0,t.nextTick(L,e,r))}(this,e)),e.paused=!1,this},O.prototype.pause=function(){return i("call pause flowing=%j",this._readableState.flowing),!1!==this._readableState.flowing&&(i("pause"),this._readableState.flowing=!1,this.emit("pause")),this._readableState.paused=!0,this},O.prototype.wrap=function(e){var t=this,r=this._readableState,n=!1;for(var o in e.on("end",function(){if(i("wrapped end"),r.decoder&&!r.ended){var e=r.decoder.end();e&&e.length&&t.push(e)}t.push(null)}),e.on("data",function(o){i("wrapped data"),r.decoder&&(o=r.decoder.write(o)),r.objectMode&&null==o||(r.objectMode||o&&o.length)&&(t.push(o)||(n=!0,e.pause()))}),e)void 0===this[o]&&"function"==typeof e[o]&&(this[o]=function(t){return function(){return e[t].apply(e,arguments)}}(o));for(var a=0;a<x.length;a++)e.on(x[a],this.emit.bind(this,x[a]));return this._read=function(t){i("wrapped _read",t),n&&(n=!1,e.resume())},this},"function"==typeof Symbol&&(O.prototype[Symbol.asyncIterator]=function(){return void 0===f&&(f=l({})),f(this)}),Object.defineProperty(O.prototype,"readableHighWaterMark",{enumerable:!1,get:function(){return this._readableState.highWaterMark}}),Object.defineProperty(O.prototype,"readableBuffer",{enumerable:!1,get:function(){return this._readableState&&this._readableState.buffer}}),Object.defineProperty(O.prototype,"readableFlowing",{enumerable:!1,get:function(){return this._readableState.flowing},set:function(e){this._readableState&&(this._readableState.flowing=e)}}),O._fromList=D,Object.defineProperty(O.prototype,"readableLength",{enumerable:!1,get:function(){return this._readableState.length}}),"function"==typeof Symbol&&(O.from=function(e,t){return void 0===p&&(p=c({})),p(O,e,t)})}).call(this,g,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})}),c=r(function(e,t){e.exports=function(){throw new Error("Readable.from is not available in the browser")}}),l=r(function(e,t){(function(t){"use strict";var r;function n(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}var i=f({}),o=Symbol("lastResolve"),a=Symbol("lastReject"),s=Symbol("error"),u=Symbol("ended"),c=Symbol("lastPromise"),l=Symbol("handlePromise"),d=Symbol("stream");function h(e,t){return{value:e,done:t}}function p(e){var t=e[o];if(null!==t){var r=e[d].read();null!==r&&(e[c]=null,e[o]=null,e[a]=null,t(h(r,!1)))}}var y=Object.getPrototypeOf(function(){}),m=Object.setPrototypeOf((n(r={get stream(){return this[d]},next:function(){var e=this,r=this[s];if(null!==r)return Promise.reject(r);if(this[u])return Promise.resolve(h(void 0,!0));if(this[d].destroyed)return new Promise(function(r,n){t.nextTick(function(){e[s]?n(e[s]):r(h(void 0,!0))})});var n,i=this[c];if(i)n=new Promise(function(e,t){return function(r,n){e.then(function(){t[u]?r(h(void 0,!0)):t[l](r,n)},n)}}(i,this));else{var o=this[d].read();if(null!==o)return Promise.resolve(h(o,!1));n=new Promise(this[l])}return this[c]=n,n}},Symbol.asyncIterator,function(){return this}),n(r,"return",function(){var e=this;return new Promise(function(t,r){e[d].destroy(null,function(e){e?r(e):t(h(void 0,!0))})})}),r),y);e.exports=function(e){var r,f=Object.create(m,(n(r={},d,{value:e,writable:!0}),n(r,o,{value:null,writable:!0}),n(r,a,{value:null,writable:!0}),n(r,s,{value:null,writable:!0}),n(r,u,{value:e._readableState.endEmitted,writable:!0}),n(r,l,{value:function(e,t){var r=f[d].read();r?(f[c]=null,f[o]=null,f[a]=null,e(h(r,!1))):(f[o]=e,f[a]=t)},writable:!0}),r));return f[c]=null,i(e,function(e){if(e&&"ERR_STREAM_PREMATURE_CLOSE"!==e.code){var t=f[a];return null!==t&&(f[c]=null,f[o]=null,f[a]=null,t(e)),void(f[s]=e)}var r=f[o];null!==r&&(f[c]=null,f[o]=null,f[a]=null,r(h(void 0,!0))),f[u]=!0}),e.on("readable",function(e){t.nextTick(p,e)}.bind(null,f)),f}}).call(this,g)}),f=r(function(e,t){"use strict";var r=Et.codes.ERR_STREAM_PREMATURE_CLOSE;function n(){}e.exports=function e(t,i,o){if("function"==typeof i)return e(t,null,i);i||(i={}),o=function(e){var t=!1;return function(){if(!t){t=!0;for(var r=arguments.length,n=new Array(r),i=0;i<r;i++)n[i]=arguments[i];e.apply(this,n)}}}(o||n);var a=i.readable||!1!==i.readable&&t.readable,s=i.writable||!1!==i.writable&&t.writable,u=function(){t.writable||l()},c=t._writableState&&t._writableState.finished,l=function(){s=!1,c=!0,a||o.call(t)},f=t._readableState&&t._readableState.endEmitted,d=function(){a=!1,f=!0,s||o.call(t)},h=function(e){o.call(t,e)},p=function(){var e;return a&&!f?(t._readableState&&t._readableState.ended||(e=new r),o.call(t,e)):s&&!c?(t._writableState&&t._writableState.ended||(e=new r),o.call(t,e)):void 0},y=function(){t.req.on("finish",l)};return function(e){return e.setHeader&&"function"==typeof e.abort}(t)?(t.on("complete",l),t.on("abort",p),t.req?y():t.on("request",y)):s&&!t._writableState&&(t.on("end",u),t.on("close",u)),t.on("end",d),t.on("finish",l),!1!==i.error&&t.on("error",h),t.on("close",p),function(){t.removeListener("complete",l),t.removeListener("abort",p),t.removeListener("request",y),t.req&&t.req.removeListener("finish",l),t.removeListener("end",u),t.removeListener("close",u),t.removeListener("finish",l),t.removeListener("end",d),t.removeListener("error",h),t.removeListener("close",p)}}}),d=r(function(e,t){"use strict";var r=Tt.Buffer,n=r.isEncoding||function(e){switch((e=""+e)&&e.toLowerCase()){case"hex":case"utf8":case"utf-8":case"ascii":case"binary":case"base64":case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":case"raw":return!0;default:return!1}};function i(e){var t;switch(this.encoding=function(e){var t=function(e){if(!e)return"utf8";for(var t;;)switch(e){case"utf8":case"utf-8":return"utf8";case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return"utf16le";case"latin1":case"binary":return"latin1";case"base64":case"ascii":case"hex":return e;default:if(t)return;e=(""+e).toLowerCase(),t=!0}}(e);if("string"!=typeof t&&(r.isEncoding===n||!n(e)))throw new Error("Unknown encoding: "+e);return t||e}(e),this.encoding){case"utf16le":this.text=s,this.end=u,t=4;break;case"utf8":this.fillLast=a,t=4;break;case"base64":this.text=c,this.end=l,t=3;break;default:return this.write=f,void(this.end=d)}this.lastNeed=0,this.lastTotal=0,this.lastChar=r.allocUnsafe(t)}function o(e){return e<=127?0:e>>5==6?2:e>>4==14?3:e>>3==30?4:e>>6==2?-1:-2}function a(e){var t=this.lastTotal-this.lastNeed,r=function(e,t,r){if(128!=(192&t[0]))return e.lastNeed=0,"\ufffd";if(e.lastNeed>1&&t.length>1){if(128!=(192&t[1]))return e.lastNeed=1,"\ufffd";if(e.lastNeed>2&&t.length>2&&128!=(192&t[2]))return e.lastNeed=2,"\ufffd"}}(this,e);return void 0!==r?r:this.lastNeed<=e.length?(e.copy(this.lastChar,t,0,this.lastNeed),this.lastChar.toString(this.encoding,0,this.lastTotal)):(e.copy(this.lastChar,t,0,e.length),void(this.lastNeed-=e.length))}function s(e,t){if((e.length-t)%2==0){var r=e.toString("utf16le",t);if(r){var n=r.charCodeAt(r.length-1);if(n>=55296&&n<=56319)return this.lastNeed=2,this.lastTotal=4,this.lastChar[0]=e[e.length-2],this.lastChar[1]=e[e.length-1],r.slice(0,-1)}return r}return this.lastNeed=1,this.lastTotal=2,this.lastChar[0]=e[e.length-1],e.toString("utf16le",t,e.length-1)}function u(e){var t=e&&e.length?this.write(e):"";if(this.lastNeed){var r=this.lastTotal-this.lastNeed;return t+this.lastChar.toString("utf16le",0,r)}return t}function c(e,t){var r=(e.length-t)%3;return 0===r?e.toString("base64",t):(this.lastNeed=3-r,this.lastTotal=3,1===r?this.lastChar[0]=e[e.length-1]:(this.lastChar[0]=e[e.length-2],this.lastChar[1]=e[e.length-1]),e.toString("base64",t,e.length-r))}function l(e){var t=e&&e.length?this.write(e):"";return this.lastNeed?t+this.lastChar.toString("base64",0,3-this.lastNeed):t}function f(e){return e.toString(this.encoding)}function d(e){return e&&e.length?this.write(e):""}t.StringDecoder=i,i.prototype.write=function(e){if(0===e.length)return"";var t,r;if(this.lastNeed){if(void 0===(t=this.fillLast(e)))return"";r=this.lastNeed,this.lastNeed=0}else r=0;return r<e.length?t?t+this.text(e,r):this.text(e,r):t||""},i.prototype.end=function(e){var t=e&&e.length?this.write(e):"";return this.lastNeed?t+"\ufffd":t},i.prototype.text=function(e,t){var r=function(e,t,r){var n=t.length-1;if(n<r)return 0;var i=o(t[n]);return i>=0?(i>0&&(e.lastNeed=i-1),i):--n<r||-2===i?0:(i=o(t[n]))>=0?(i>0&&(e.lastNeed=i-2),i):--n<r||-2===i?0:(i=o(t[n]))>=0?(i>0&&(2===i?i=0:e.lastNeed=i-3),i):0}(this,e,t);if(!this.lastNeed)return e.toString("utf8",t);this.lastTotal=r;var n=e.length-(r-this.lastNeed);return e.copy(this.lastChar,0,n),e.toString("utf8",t,n)},i.prototype.fillLast=function(e){if(this.lastNeed<=e.length)return e.copy(this.lastChar,this.lastTotal-this.lastNeed,0,this.lastNeed),this.lastChar.toString(this.encoding,0,this.lastTotal);e.copy(this.lastChar,this.lastTotal-this.lastNeed,0,e.length),this.lastNeed-=e.length}}),h=r(function(e,t){(function(t){"use strict";var r=Object.keys||function(e){var t=[];for(var r in e)t.push(r);return t};e.exports=c;var n=u({}),i=p({});Ke(c,n);for(var o=r(i.prototype),a=0;a<o.length;a++){var s=o[a];c.prototype[s]||(c.prototype[s]=i.prototype[s])}function c(e){if(!(this instanceof c))return new c(e);n.call(this,e),i.call(this,e),this.allowHalfOpen=!0,e&&(!1===e.readable&&(this.readable=!1),!1===e.writable&&(this.writable=!1),!1===e.allowHalfOpen&&(this.allowHalfOpen=!1,this.once("end",l)))}function l(){this._writableState.ended||t.nextTick(f,this)}function f(e){e.end()}Object.defineProperty(c.prototype,"writableHighWaterMark",{enumerable:!1,get:function(){return this._writableState.highWaterMark}}),Object.defineProperty(c.prototype,"writableBuffer",{enumerable:!1,get:function(){return this._writableState&&this._writableState.getBuffer()}}),Object.defineProperty(c.prototype,"writableLength",{enumerable:!1,get:function(){return this._writableState.length}}),Object.defineProperty(c.prototype,"destroyed",{enumerable:!1,get:function(){return void 0!==this._readableState&&void 0!==this._writableState&&this._readableState.destroyed&&this._writableState.destroyed},set:function(e){void 0!==this._readableState&&void 0!==this._writableState&&(this._readableState.destroyed=e,this._writableState.destroyed=e)}})}).call(this,g)}),p=r(function(e,t){(function(t,r){"use strict";function n(e){var t=this;this.next=null,this.entry=null,this.finish=function(){!function(e,t,r){var n=e.entry;for(e.entry=null;n;){var i=n.callback;t.pendingcb--,i(void 0),n=n.next}t.corkedRequestsFree.next=e}(t,e)}}var i;e.exports=E,E.WritableState=x;var o,a={deprecate:Q},s=y({}).Buffer,u=r.Uint8Array||function(){},c=At.getHighWaterMark,l=Et.codes,f=l.ERR_INVALID_ARG_TYPE,d=l.ERR_METHOD_NOT_IMPLEMENTED,p=l.ERR_MULTIPLE_CALLBACK,m=l.ERR_STREAM_CANNOT_PIPE,b=l.ERR_STREAM_DESTROYED,g=l.ERR_STREAM_NULL_VALUES,v=l.ERR_STREAM_WRITE_AFTER_END,w=l.ERR_UNKNOWN_ENCODING,_=xt.errorOrDestroy;function q(){}function x(e,r,o){i=i||h({}),e=e||{},"boolean"!=typeof o&&(o=r instanceof i),this.objectMode=!!e.objectMode,o&&(this.objectMode=this.objectMode||!!e.writableObjectMode),this.highWaterMark=c(this,e,"writableHighWaterMark",o),this.finalCalled=!1,this.needDrain=!1,this.ending=!1,this.ended=!1,this.finished=!1,this.destroyed=!1;var a=!1===e.decodeStrings;this.decodeStrings=!a,this.defaultEncoding=e.defaultEncoding||"utf8",this.length=0,this.writing=!1,this.corked=0,this.sync=!0,this.bufferProcessing=!1,this.onwrite=function(e){!function(e,r){var n=e._writableState,i=n.sync,o=n.writecb;if("function"!=typeof o)throw new p;if(function(e){e.writing=!1,e.writecb=null,e.length-=e.writelen,e.writelen=0}(n),r)!function(e,r,n,i,o){--r.pendingcb,n?(t.nextTick(o,i),t.nextTick(T,e,r),e._writableState.errorEmitted=!0,_(e,i)):(o(i),e._writableState.errorEmitted=!0,_(e,i),T(e,r))}(e,n,i,r,o);else{var a=R(n)||e.destroyed;a||n.corked||n.bufferProcessing||!n.bufferedRequest||C(e,n),i?t.nextTick(S,e,n,a,o):S(e,n,a,o)}}(r,e)},this.writecb=null,this.writelen=0,this.bufferedRequest=null,this.lastBufferedRequest=null,this.pendingcb=0,this.prefinished=!1,this.errorEmitted=!1,this.emitClose=!1!==e.emitClose,this.autoDestroy=!!e.autoDestroy,this.bufferedRequestCount=0,this.corkedRequestsFree=new n(this)}function E(e){var t=this instanceof(i=i||h({}));if(!t&&!o.call(E,this))return new E(e);this._writableState=new x(e,this,t),this.writable=!0,e&&("function"==typeof e.write&&(this._write=e.write),"function"==typeof e.writev&&(this._writev=e.writev),"function"==typeof e.destroy&&(this._destroy=e.destroy),"function"==typeof e.final&&(this._final=e.final)),ht.call(this)}function O(e,t,r,n,i,o,a){t.writelen=n,t.writecb=a,t.writing=!0,t.sync=!0,t.destroyed?t.onwrite(new b("write")):r?e._writev(i,t.onwrite):e._write(i,o,t.onwrite),t.sync=!1}function S(e,t,r,n){r||function(e,t){0===t.length&&t.needDrain&&(t.needDrain=!1,e.emit("drain"))}(e,t),t.pendingcb--,n(),T(e,t)}function C(e,t){t.bufferProcessing=!0;var r=t.bufferedRequest;if(e._writev&&r&&r.next){var i=t.bufferedRequestCount,o=new Array(i),a=t.corkedRequestsFree;a.entry=r;for(var s=0,u=!0;r;)o[s]=r,r.isBuf||(u=!1),r=r.next,s+=1;o.allBuffers=u,O(e,t,!0,t.length,o,"",a.finish),t.pendingcb++,t.lastBufferedRequest=null,a.next?(t.corkedRequestsFree=a.next,a.next=null):t.corkedRequestsFree=new n(t),t.bufferedRequestCount=0}else{for(;r;){var c=r.chunk,l=r.encoding,f=r.callback;if(O(e,t,!1,t.objectMode?1:c.length,c,l,f),r=r.next,t.bufferedRequestCount--,t.writing)break}null===r&&(t.lastBufferedRequest=null)}t.bufferedRequest=r,t.bufferProcessing=!1}function R(e){return e.ending&&0===e.length&&null===e.bufferedRequest&&!e.finished&&!e.writing}function A(e,t){e._final(function(r){t.pendingcb--,r&&_(e,r),t.prefinished=!0,e.emit("prefinish"),T(e,t)})}function T(e,r){var n=R(r);if(n&&(function(e,r){r.prefinished||r.finalCalled||("function"!=typeof e._final||r.destroyed?(r.prefinished=!0,e.emit("prefinish")):(r.pendingcb++,r.finalCalled=!0,t.nextTick(A,e,r)))}(e,r),0===r.pendingcb&&(r.finished=!0,e.emit("finish"),r.autoDestroy))){var i=e._readableState;(!i||i.autoDestroy&&i.endEmitted)&&e.destroy()}return n}Ke(E,ht),x.prototype.getBuffer=function(){for(var e=this.bufferedRequest,t=[];e;)t.push(e),e=e.next;return t},function(){try{Object.defineProperty(x.prototype,"buffer",{get:a.deprecate(function(){return this.getBuffer()},"_writableState.buffer is deprecated. Use _writableState.getBuffer instead.","DEP0003")})}catch(e){}}(),"function"==typeof Symbol&&Symbol.hasInstance&&"function"==typeof Function.prototype[Symbol.hasInstance]?(o=Function.prototype[Symbol.hasInstance],Object.defineProperty(E,Symbol.hasInstance,{value:function(e){return!!o.call(this,e)||this===E&&e&&e._writableState instanceof x}})):o=function(e){return e instanceof this},E.prototype.pipe=function(){_(this,new m)},E.prototype.write=function(e,r,n){var i,o=this._writableState,a=!1,c=!o.objectMode&&(i=e,s.isBuffer(i)||i instanceof u);return c&&!s.isBuffer(e)&&(e=function(e){return s.from(e)}(e)),"function"==typeof r&&(n=r,r=null),c?r="buffer":r||(r=o.defaultEncoding),"function"!=typeof n&&(n=q),o.ending?function(e,r){var n=new v;_(e,n),t.nextTick(r,n)}(this,n):(c||function(e,r,n,i){var o;return null===n?o=new g:"string"==typeof n||r.objectMode||(o=new f("chunk",["string","Buffer"],n)),!o||(_(e,o),t.nextTick(i,o),!1)}(this,o,e,n))&&(o.pendingcb++,a=function(e,t,r,n,i,o){if(!r){var a=function(e,t,r){return e.objectMode||!1===e.decodeStrings||"string"!=typeof t||(t=s.from(t,r)),t}(t,n,i);n!==a&&(r=!0,i="buffer",n=a)}var u=t.objectMode?1:n.length;t.length+=u;var c=t.length<t.highWaterMark;if(c||(t.needDrain=!0),t.writing||t.corked){var l=t.lastBufferedRequest;t.lastBufferedRequest={chunk:n,encoding:i,isBuf:r,callback:o,next:null},l?l.next=t.lastBufferedRequest:t.bufferedRequest=t.lastBufferedRequest,t.bufferedRequestCount+=1}else O(e,t,!1,u,n,i,o);return c}(this,o,c,e,r,n)),a},E.prototype.cork=function(){this._writableState.corked++},E.prototype.uncork=function(){var e=this._writableState;e.corked&&(e.corked--,e.writing||e.corked||e.bufferProcessing||!e.bufferedRequest||C(this,e))},E.prototype.setDefaultEncoding=function(e){if("string"==typeof e&&(e=e.toLowerCase()),!(["hex","utf8","utf-8","ascii","binary","base64","ucs2","ucs-2","utf16le","utf-16le","raw"].indexOf((e+"").toLowerCase())>-1))throw new w(e);return this._writableState.defaultEncoding=e,this},Object.defineProperty(E.prototype,"writableBuffer",{enumerable:!1,get:function(){return this._writableState&&this._writableState.getBuffer()}}),Object.defineProperty(E.prototype,"writableHighWaterMark",{enumerable:!1,get:function(){return this._writableState.highWaterMark}}),E.prototype._write=function(e,t,r){r(new d("_write()"))},E.prototype._writev=null,E.prototype.end=function(e,r,n){var i=this._writableState;return"function"==typeof e?(n=e,e=null,r=null):"function"==typeof r&&(n=r,r=null),null!=e&&this.write(e,r),i.corked&&(i.corked=1,this.uncork()),i.ending||function(e,r,n){r.ending=!0,T(e,r),n&&(r.finished?t.nextTick(n):e.once("finish",n)),r.ended=!0,e.writable=!1}(this,i,n),this},Object.defineProperty(E.prototype,"writableLength",{enumerable:!1,get:function(){return this._writableState.length}}),Object.defineProperty(E.prototype,"destroyed",{enumerable:!1,get:function(){return void 0!==this._writableState&&this._writableState.destroyed},set:function(e){this._writableState&&(this._writableState.destroyed=e)}}),E.prototype.destroy=xt.destroy,E.prototype._undestroy=xt.undestroy,E.prototype._destroy=function(e,t){t(e)}}).call(this,g,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})}),y=r(function(e,t){(function(e){"use strict";t.Buffer=e,t.SlowBuffer=function(t){return+t!=t&&(t=0),e.alloc(+t)},t.INSPECT_MAX_BYTES=50;var r=2147483647;function n(t){if(t>r)throw new RangeError('The value "'+t+'" is invalid for option "size"');var n=new Uint8Array(t);return n.__proto__=e.prototype,n}function e(e,t,r){if("number"==typeof e){if("string"==typeof t)throw new TypeError('The "string" argument must be of type string. Received type number');return a(e)}return i(e,t,r)}function i(t,r,i){if("string"==typeof t)return function(t,r){if("string"==typeof r&&""!==r||(r="utf8"),!e.isEncoding(r))throw new TypeError("Unknown encoding: "+r);var i=0|c(t,r),o=n(i),a=o.write(t,r);return a!==i&&(o=o.slice(0,a)),o}(t,r);if(ArrayBuffer.isView(t))return s(t);if(null==t)throw TypeError("The first argument must be one of type string, Buffer, ArrayBuffer, Array, or Array-like Object. Received type "+typeof t);if(M(t,ArrayBuffer)||t&&M(t.buffer,ArrayBuffer))return function(t,r,n){if(r<0||t.byteLength<r)throw new RangeError('"offset" is outside of buffer bounds');if(t.byteLength<r+(n||0))throw new RangeError('"length" is outside of buffer bounds');var i;return(i=void 0===r&&void 0===n?new Uint8Array(t):void 0===n?new Uint8Array(t,r):new Uint8Array(t,r,n)).__proto__=e.prototype,i}(t,r,i);if("number"==typeof t)throw new TypeError('The "value" argument must not be of type number. Received type number');var o=t.valueOf&&t.valueOf();if(null!=o&&o!==t)return e.from(o,r,i);var a=function(t){if(e.isBuffer(t)){var r=0|u(t.length),i=n(r);return 0===i.length?i:(t.copy(i,0,0,r),i)}return void 0!==t.length?"number"!=typeof t.length||L(t.length)?n(0):s(t):"Buffer"===t.type&&Array.isArray(t.data)?s(t.data):void 0}(t);if(a)return a;if("undefined"!=typeof Symbol&&null!=Symbol.toPrimitive&&"function"==typeof t[Symbol.toPrimitive])return e.from(t[Symbol.toPrimitive]("string"),r,i);throw new TypeError("The first argument must be one of type string, Buffer, ArrayBuffer, Array, or Array-like Object. Received type "+typeof t)}function o(e){if("number"!=typeof e)throw new TypeError('"size" argument must be of type number');if(e<0)throw new RangeError('The value "'+e+'" is invalid for option "size"')}function a(e){return o(e),n(e<0?0:0|u(e))}function s(e){for(var t=e.length<0?0:0|u(e.length),r=n(t),i=0;i<t;i+=1)r[i]=255&e[i];return r}function u(e){if(e>=r)throw new RangeError("Attempt to allocate Buffer larger than maximum size: 0x"+r.toString(16)+" bytes");return 0|e}function c(t,r){if(e.isBuffer(t))return t.length;if(ArrayBuffer.isView(t)||M(t,ArrayBuffer))return t.byteLength;if("string"!=typeof t)throw new TypeError('The "string" argument must be one of type string, Buffer, or ArrayBuffer. Received type '+typeof t);var n=t.length,i=arguments.length>2&&!0===arguments[2];if(!i&&0===n)return 0;for(var o=!1;;)switch(r){case"ascii":case"latin1":case"binary":return n;case"utf8":case"utf-8":return I(t).length;case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return 2*n;case"hex":return n>>>1;case"base64":return j(t).length;default:if(o)return i?-1:I(t).length;r=(""+r).toLowerCase(),o=!0}}function l(e,t,r){var n=e[t];e[t]=e[r],e[r]=n}function f(t,r,n,i,o){if(0===t.length)return-1;if("string"==typeof n?(i=n,n=0):n>2147483647?n=2147483647:n<-2147483648&&(n=-2147483648),L(n=+n)&&(n=o?0:t.length-1),n<0&&(n=t.length+n),n>=t.length){if(o)return-1;n=t.length-1}else if(n<0){if(!o)return-1;n=0}if("string"==typeof r&&(r=e.from(r,i)),e.isBuffer(r))return 0===r.length?-1:d(t,r,n,i,o);if("number"==typeof r)return r&=255,"function"==typeof Uint8Array.prototype.indexOf?o?Uint8Array.prototype.indexOf.call(t,r,n):Uint8Array.prototype.lastIndexOf.call(t,r,n):d(t,[r],n,i,o);throw new TypeError("val must be string, number or Buffer")}function d(e,t,r,n,i){var o,a=1,s=e.length,u=t.length;if(void 0!==n&&("ucs2"===(n=String(n).toLowerCase())||"ucs-2"===n||"utf16le"===n||"utf-16le"===n)){if(e.length<2||t.length<2)return-1;a=2,s/=2,u/=2,r/=2}function c(e,t){return 1===a?e[t]:e.readUInt16BE(t*a)}if(i){var l=-1;for(o=r;o<s;o++)if(c(e,o)===c(t,-1===l?0:o-l)){if(-1===l&&(l=o),o-l+1===u)return l*a}else-1!==l&&(o-=o-l),l=-1}else for(r+u>s&&(r=s-u),o=r;o>=0;o--){for(var f=!0,d=0;d<u;d++)if(c(e,o+d)!==c(t,d)){f=!1;break}if(f)return o}return-1}function h(e,t,r,n){r=Number(r)||0;var i=e.length-r;n?(n=Number(n))>i&&(n=i):n=i;var o=t.length;n>o/2&&(n=o/2);for(var a=0;a<n;++a){var s=parseInt(t.substr(2*a,2),16);if(L(s))return a;e[r+a]=s}return a}function p(e,t,r,n){return N(I(t,e.length-r),e,r,n)}function y(e,t,r,n){return N(function(e){for(var t=[],r=0;r<e.length;++r)t.push(255&e.charCodeAt(r));return t}(t),e,r,n)}function m(e,t,r,n){return y(e,t,r,n)}function b(e,t,r,n){return N(j(t),e,r,n)}function g(e,t,r,n){return N(function(e,t){for(var r,n,i,o=[],a=0;a<e.length&&!((t-=2)<0);++a)n=(r=e.charCodeAt(a))>>8,i=r%256,o.push(i),o.push(n);return o}(t,e.length-r),e,r,n)}function v(e,t,r){return 0===t&&r===e.length?te.fromByteArray(e):te.fromByteArray(e.slice(t,r))}function w(e,t,r){r=Math.min(e.length,r);for(var n=[],i=t;i<r;){var o,a,s,u,c=e[i],l=null,f=c>239?4:c>223?3:c>191?2:1;if(i+f<=r)switch(f){case 1:c<128&&(l=c);break;case 2:128==(192&(o=e[i+1]))&&(u=(31&c)<<6|63&o)>127&&(l=u);break;case 3:o=e[i+1],a=e[i+2],128==(192&o)&&128==(192&a)&&(u=(15&c)<<12|(63&o)<<6|63&a)>2047&&(u<55296||u>57343)&&(l=u);break;case 4:o=e[i+1],a=e[i+2],s=e[i+3],128==(192&o)&&128==(192&a)&&128==(192&s)&&(u=(15&c)<<18|(63&o)<<12|(63&a)<<6|63&s)>65535&&u<1114112&&(l=u)}null===l?(l=65533,f=1):l>65535&&(l-=65536,n.push(l>>>10&1023|55296),l=56320|1023&l),n.push(l),i+=f}return function(e){var t=e.length;if(t<=_)return String.fromCharCode.apply(String,e);for(var r="",n=0;n<t;)r+=String.fromCharCode.apply(String,e.slice(n,n+=_));return r}(n)}t.kMaxLength=r,e.TYPED_ARRAY_SUPPORT=function(){try{var e=new Uint8Array(1);return e.__proto__={__proto__:Uint8Array.prototype,foo:function(){return 42}},42===e.foo()}catch(t){return!1}}(),e.TYPED_ARRAY_SUPPORT||"undefined"==typeof console||"function"!=typeof console.error||console.error("This browser lacks typed array (Uint8Array) support which is required by `buffer` v5.x. Use `buffer` v4.x if you require old browser support."),Object.defineProperty(e.prototype,"parent",{enumerable:!0,get:function(){if(e.isBuffer(this))return this.buffer}}),Object.defineProperty(e.prototype,"offset",{enumerable:!0,get:function(){if(e.isBuffer(this))return this.byteOffset}}),"undefined"!=typeof Symbol&&null!=Symbol.species&&e[Symbol.species]===e&&Object.defineProperty(e,Symbol.species,{value:null,configurable:!0,enumerable:!1,writable:!1}),e.poolSize=8192,e.from=function(e,t,r){return i(e,t,r)},e.prototype.__proto__=Uint8Array.prototype,e.__proto__=Uint8Array,e.alloc=function(e,t,r){return function(e,t,r){return o(e),e<=0?n(e):void 0!==t?"string"==typeof r?n(e).fill(t,r):n(e).fill(t):n(e)}(e,t,r)},e.allocUnsafe=function(e){return a(e)},e.allocUnsafeSlow=function(e){return a(e)},e.isBuffer=function(t){return null!=t&&!0===t._isBuffer&&t!==e.prototype},e.compare=function(t,r){if(M(t,Uint8Array)&&(t=e.from(t,t.offset,t.byteLength)),M(r,Uint8Array)&&(r=e.from(r,r.offset,r.byteLength)),!e.isBuffer(t)||!e.isBuffer(r))throw new TypeError('The "buf1", "buf2" arguments must be one of type Buffer or Uint8Array');if(t===r)return 0;for(var n=t.length,i=r.length,o=0,a=Math.min(n,i);o<a;++o)if(t[o]!==r[o]){n=t[o],i=r[o];break}return n<i?-1:i<n?1:0},e.isEncoding=function(e){switch(String(e).toLowerCase()){case"hex":case"utf8":case"utf-8":case"ascii":case"latin1":case"binary":case"base64":case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return!0;default:return!1}},e.concat=function(t,r){if(!Array.isArray(t))throw new TypeError('"list" argument must be an Array of Buffers');if(0===t.length)return e.alloc(0);var n;if(void 0===r)for(r=0,n=0;n<t.length;++n)r+=t[n].length;var i=e.allocUnsafe(r),o=0;for(n=0;n<t.length;++n){var a=t[n];if(M(a,Uint8Array)&&(a=e.from(a)),!e.isBuffer(a))throw new TypeError('"list" argument must be an Array of Buffers');a.copy(i,o),o+=a.length}return i},e.byteLength=c,e.prototype._isBuffer=!0,e.prototype.swap16=function(){var e=this.length;if(e%2!=0)throw new RangeError("Buffer size must be a multiple of 16-bits");for(var t=0;t<e;t+=2)l(this,t,t+1);return this},e.prototype.swap32=function(){var e=this.length;if(e%4!=0)throw new RangeError("Buffer size must be a multiple of 32-bits");for(var t=0;t<e;t+=4)l(this,t,t+3),l(this,t+1,t+2);return this},e.prototype.swap64=function(){var e=this.length;if(e%8!=0)throw new RangeError("Buffer size must be a multiple of 64-bits");for(var t=0;t<e;t+=8)l(this,t,t+7),l(this,t+1,t+6),l(this,t+2,t+5),l(this,t+3,t+4);return this},e.prototype.toString=function(){var e=this.length;return 0===e?"":0===arguments.length?w(this,0,e):function(e,t,r){var n=!1;if((void 0===t||t<0)&&(t=0),t>this.length)return"";if((void 0===r||r>this.length)&&(r=this.length),r<=0)return"";if((r>>>=0)<=(t>>>=0))return"";for(e||(e="utf8");;)switch(e){case"hex":return E(this,t,r);case"utf8":case"utf-8":return w(this,t,r);case"ascii":return q(this,t,r);case"latin1":case"binary":return x(this,t,r);case"base64":return v(this,t,r);case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return O(this,t,r);default:if(n)throw new TypeError("Unknown encoding: "+e);e=(e+"").toLowerCase(),n=!0}}.apply(this,arguments)},e.prototype.toLocaleString=e.prototype.toString,e.prototype.equals=function(t){if(!e.isBuffer(t))throw new TypeError("Argument must be a Buffer");return this===t||0===e.compare(this,t)},e.prototype.inspect=function(){var e="",r=t.INSPECT_MAX_BYTES;return e=this.toString("hex",0,r).replace(/(.{2})/g,"$1 ").trim(),this.length>r&&(e+=" ... "),"<Buffer "+e+">"},e.prototype.compare=function(t,r,n,i,o){if(M(t,Uint8Array)&&(t=e.from(t,t.offset,t.byteLength)),!e.isBuffer(t))throw new TypeError('The "target" argument must be one of type Buffer or Uint8Array. Received type '+typeof t);if(void 0===r&&(r=0),void 0===n&&(n=t?t.length:0),void 0===i&&(i=0),void 0===o&&(o=this.length),r<0||n>t.length||i<0||o>this.length)throw new RangeError("out of range index");if(i>=o&&r>=n)return 0;if(i>=o)return-1;if(r>=n)return 1;if(this===t)return 0;for(var a=(o>>>=0)-(i>>>=0),s=(n>>>=0)-(r>>>=0),u=Math.min(a,s),c=this.slice(i,o),l=t.slice(r,n),f=0;f<u;++f)if(c[f]!==l[f]){a=c[f],s=l[f];break}return a<s?-1:s<a?1:0},e.prototype.includes=function(e,t,r){return-1!==this.indexOf(e,t,r)},e.prototype.indexOf=function(e,t,r){return f(this,e,t,r,!0)},e.prototype.lastIndexOf=function(e,t,r){return f(this,e,t,r,!1)},e.prototype.write=function(e,t,r,n){if(void 0===t)n="utf8",r=this.length,t=0;else if(void 0===r&&"string"==typeof t)n=t,r=this.length,t=0;else{if(!isFinite(t))throw new Error("Buffer.write(string, encoding, offset[, length]) is no longer supported");t>>>=0,isFinite(r)?(r>>>=0,void 0===n&&(n="utf8")):(n=r,r=void 0)}var i=this.length-t;if((void 0===r||r>i)&&(r=i),e.length>0&&(r<0||t<0)||t>this.length)throw new RangeError("Attempt to write outside buffer bounds");n||(n="utf8");for(var o=!1;;)switch(n){case"hex":return h(this,e,t,r);case"utf8":case"utf-8":return p(this,e,t,r);case"ascii":return y(this,e,t,r);case"latin1":case"binary":return m(this,e,t,r);case"base64":return b(this,e,t,r);case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return g(this,e,t,r);default:if(o)throw new TypeError("Unknown encoding: "+n);n=(""+n).toLowerCase(),o=!0}},e.prototype.toJSON=function(){return{type:"Buffer",data:Array.prototype.slice.call(this._arr||this,0)}};var _=4096;function q(e,t,r){var n="";r=Math.min(e.length,r);for(var i=t;i<r;++i)n+=String.fromCharCode(127&e[i]);return n}function x(e,t,r){var n="";r=Math.min(e.length,r);for(var i=t;i<r;++i)n+=String.fromCharCode(e[i]);return n}function E(e,t,r){var n,i=e.length;(!t||t<0)&&(t=0),(!r||r<0||r>i)&&(r=i);for(var o="",a=t;a<r;++a)o+=(n=e[a])<16?"0"+n.toString(16):n.toString(16);return o}function O(e,t,r){for(var n=e.slice(t,r),i="",o=0;o<n.length;o+=2)i+=String.fromCharCode(n[o]+256*n[o+1]);return i}function S(e,t,r){if(e%1!=0||e<0)throw new RangeError("offset is not uint");if(e+t>r)throw new RangeError("Trying to access beyond buffer length")}function C(t,r,n,i,o,a){if(!e.isBuffer(t))throw new TypeError('"buffer" argument must be a Buffer instance');if(r>o||r<a)throw new RangeError('"value" argument is out of bounds');if(n+i>t.length)throw new RangeError("Index out of range")}function R(e,t,r,n,i,o){if(r+n>e.length)throw new RangeError("Index out of range");if(r<0)throw new RangeError("Index out of range")}function A(e,t,r,n,i){return t=+t,r>>>=0,i||R(e,0,r,4),pt.write(e,t,r,n,23,4),r+4}function T(e,t,r,n,i){return t=+t,r>>>=0,i||R(e,0,r,8),pt.write(e,t,r,n,52,8),r+8}e.prototype.slice=function(t,r){var n=this.length;(t=~~t)<0?(t+=n)<0&&(t=0):t>n&&(t=n),(r=void 0===r?n:~~r)<0?(r+=n)<0&&(r=0):r>n&&(r=n),r<t&&(r=t);var i=this.subarray(t,r);return i.__proto__=e.prototype,i},e.prototype.readUIntLE=function(e,t,r){e>>>=0,t>>>=0,r||S(e,t,this.length);for(var n=this[e],i=1,o=0;++o<t&&(i*=256);)n+=this[e+o]*i;return n},e.prototype.readUIntBE=function(e,t,r){e>>>=0,t>>>=0,r||S(e,t,this.length);for(var n=this[e+--t],i=1;t>0&&(i*=256);)n+=this[e+--t]*i;return n},e.prototype.readUInt8=function(e,t){return e>>>=0,t||S(e,1,this.length),this[e]},e.prototype.readUInt16LE=function(e,t){return e>>>=0,t||S(e,2,this.length),this[e]|this[e+1]<<8},e.prototype.readUInt16BE=function(e,t){return e>>>=0,t||S(e,2,this.length),this[e]<<8|this[e+1]},e.prototype.readUInt32LE=function(e,t){return e>>>=0,t||S(e,4,this.length),(this[e]|this[e+1]<<8|this[e+2]<<16)+16777216*this[e+3]},e.prototype.readUInt32BE=function(e,t){return e>>>=0,t||S(e,4,this.length),16777216*this[e]+(this[e+1]<<16|this[e+2]<<8|this[e+3])},e.prototype.readIntLE=function(e,t,r){e>>>=0,t>>>=0,r||S(e,t,this.length);for(var n=this[e],i=1,o=0;++o<t&&(i*=256);)n+=this[e+o]*i;return n>=(i*=128)&&(n-=Math.pow(2,8*t)),n},e.prototype.readIntBE=function(e,t,r){e>>>=0,t>>>=0,r||S(e,t,this.length);for(var n=t,i=1,o=this[e+--n];n>0&&(i*=256);)o+=this[e+--n]*i;return o>=(i*=128)&&(o-=Math.pow(2,8*t)),o},e.prototype.readInt8=function(e,t){return e>>>=0,t||S(e,1,this.length),128&this[e]?-1*(255-this[e]+1):this[e]},e.prototype.readInt16LE=function(e,t){e>>>=0,t||S(e,2,this.length);var r=this[e]|this[e+1]<<8;return 32768&r?4294901760|r:r},e.prototype.readInt16BE=function(e,t){e>>>=0,t||S(e,2,this.length);var r=this[e+1]|this[e]<<8;return 32768&r?4294901760|r:r},e.prototype.readInt32LE=function(e,t){return e>>>=0,t||S(e,4,this.length),this[e]|this[e+1]<<8|this[e+2]<<16|this[e+3]<<24},e.prototype.readInt32BE=function(e,t){return e>>>=0,t||S(e,4,this.length),this[e]<<24|this[e+1]<<16|this[e+2]<<8|this[e+3]},e.prototype.readFloatLE=function(e,t){return e>>>=0,t||S(e,4,this.length),pt.read(this,e,!0,23,4)},e.prototype.readFloatBE=function(e,t){return e>>>=0,t||S(e,4,this.length),pt.read(this,e,!1,23,4)},e.prototype.readDoubleLE=function(e,t){return e>>>=0,t||S(e,8,this.length),pt.read(this,e,!0,52,8)},e.prototype.readDoubleBE=function(e,t){return e>>>=0,t||S(e,8,this.length),pt.read(this,e,!1,52,8)},e.prototype.writeUIntLE=function(e,t,r,n){e=+e,t>>>=0,r>>>=0,n||C(this,e,t,r,Math.pow(2,8*r)-1,0);var i=1,o=0;for(this[t]=255&e;++o<r&&(i*=256);)this[t+o]=e/i&255;return t+r},e.prototype.writeUIntBE=function(e,t,r,n){e=+e,t>>>=0,r>>>=0,n||C(this,e,t,r,Math.pow(2,8*r)-1,0);var i=r-1,o=1;for(this[t+i]=255&e;--i>=0&&(o*=256);)this[t+i]=e/o&255;return t+r},e.prototype.writeUInt8=function(e,t,r){return e=+e,t>>>=0,r||C(this,e,t,1,255,0),this[t]=255&e,t+1},e.prototype.writeUInt16LE=function(e,t,r){return e=+e,t>>>=0,r||C(this,e,t,2,65535,0),this[t]=255&e,this[t+1]=e>>>8,t+2},e.prototype.writeUInt16BE=function(e,t,r){return e=+e,t>>>=0,r||C(this,e,t,2,65535,0),this[t]=e>>>8,this[t+1]=255&e,t+2},e.prototype.writeUInt32LE=function(e,t,r){return e=+e,t>>>=0,r||C(this,e,t,4,4294967295,0),this[t+3]=e>>>24,this[t+2]=e>>>16,this[t+1]=e>>>8,this[t]=255&e,t+4},e.prototype.writeUInt32BE=function(e,t,r){return e=+e,t>>>=0,r||C(this,e,t,4,4294967295,0),this[t]=e>>>24,this[t+1]=e>>>16,this[t+2]=e>>>8,this[t+3]=255&e,t+4},e.prototype.writeIntLE=function(e,t,r,n){if(e=+e,t>>>=0,!n){var i=Math.pow(2,8*r-1);C(this,e,t,r,i-1,-i)}var o=0,a=1,s=0;for(this[t]=255&e;++o<r&&(a*=256);)e<0&&0===s&&0!==this[t+o-1]&&(s=1),this[t+o]=(e/a>>0)-s&255;return t+r},e.prototype.writeIntBE=function(e,t,r,n){if(e=+e,t>>>=0,!n){var i=Math.pow(2,8*r-1);C(this,e,t,r,i-1,-i)}var o=r-1,a=1,s=0;for(this[t+o]=255&e;--o>=0&&(a*=256);)e<0&&0===s&&0!==this[t+o+1]&&(s=1),this[t+o]=(e/a>>0)-s&255;return t+r},e.prototype.writeInt8=function(e,t,r){return e=+e,t>>>=0,r||C(this,e,t,1,127,-128),e<0&&(e=255+e+1),this[t]=255&e,t+1},e.prototype.writeInt16LE=function(e,t,r){return e=+e,t>>>=0,r||C(this,e,t,2,32767,-32768),this[t]=255&e,this[t+1]=e>>>8,t+2},e.prototype.writeInt16BE=function(e,t,r){return e=+e,t>>>=0,r||C(this,e,t,2,32767,-32768),this[t]=e>>>8,this[t+1]=255&e,t+2},e.prototype.writeInt32LE=function(e,t,r){return e=+e,t>>>=0,r||C(this,e,t,4,2147483647,-2147483648),this[t]=255&e,this[t+1]=e>>>8,this[t+2]=e>>>16,this[t+3]=e>>>24,t+4},e.prototype.writeInt32BE=function(e,t,r){return e=+e,t>>>=0,r||C(this,e,t,4,2147483647,-2147483648),e<0&&(e=4294967295+e+1),this[t]=e>>>24,this[t+1]=e>>>16,this[t+2]=e>>>8,this[t+3]=255&e,t+4},e.prototype.writeFloatLE=function(e,t,r){return A(this,e,t,!0,r)},e.prototype.writeFloatBE=function(e,t,r){return A(this,e,t,!1,r)},e.prototype.writeDoubleLE=function(e,t,r){return T(this,e,t,!0,r)},e.prototype.writeDoubleBE=function(e,t,r){return T(this,e,t,!1,r)},e.prototype.copy=function(t,r,n,i){if(!e.isBuffer(t))throw new TypeError("argument should be a Buffer");if(n||(n=0),i||0===i||(i=this.length),r>=t.length&&(r=t.length),r||(r=0),i>0&&i<n&&(i=n),i===n)return 0;if(0===t.length||0===this.length)return 0;if(r<0)throw new RangeError("targetStart out of bounds");if(n<0||n>=this.length)throw new RangeError("Index out of range");if(i<0)throw new RangeError("sourceEnd out of bounds");i>this.length&&(i=this.length),t.length-r<i-n&&(i=t.length-r+n);var o=i-n;if(this===t&&"function"==typeof Uint8Array.prototype.copyWithin)this.copyWithin(r,n,i);else if(this===t&&n<r&&r<i)for(var a=o-1;a>=0;--a)t[a+r]=this[a+n];else Uint8Array.prototype.set.call(t,this.subarray(n,i),r);return o},e.prototype.fill=function(t,r,n,i){if("string"==typeof t){if("string"==typeof r?(i=r,r=0,n=this.length):"string"==typeof n&&(i=n,n=this.length),void 0!==i&&"string"!=typeof i)throw new TypeError("encoding must be a string");if("string"==typeof i&&!e.isEncoding(i))throw new TypeError("Unknown encoding: "+i);if(1===t.length){var o=t.charCodeAt(0);("utf8"===i&&o<128||"latin1"===i)&&(t=o)}}else"number"==typeof t&&(t&=255);if(r<0||this.length<r||this.length<n)throw new RangeError("Out of range index");if(n<=r)return this;var a;if(r>>>=0,n=void 0===n?this.length:n>>>0,t||(t=0),"number"==typeof t)for(a=r;a<n;++a)this[a]=t;else{var s=e.isBuffer(t)?t:e.from(t,i),u=s.length;if(0===u)throw new TypeError('The value "'+t+'" is invalid for argument "value"');for(a=0;a<n-r;++a)this[a+r]=s[a%u]}return this};var P=/[^+\/0-9A-Za-z-_]/g;function I(e,t){var r;t=t||1/0;for(var n=e.length,i=null,o=[],a=0;a<n;++a){if((r=e.charCodeAt(a))>55295&&r<57344){if(!i){if(r>56319){(t-=3)>-1&&o.push(239,191,189);continue}if(a+1===n){(t-=3)>-1&&o.push(239,191,189);continue}i=r;continue}if(r<56320){(t-=3)>-1&&o.push(239,191,189),i=r;continue}r=65536+(i-55296<<10|r-56320)}else i&&(t-=3)>-1&&o.push(239,191,189);if(i=null,r<128){if((t-=1)<0)break;o.push(r)}else if(r<2048){if((t-=2)<0)break;o.push(r>>6|192,63&r|128)}else if(r<65536){if((t-=3)<0)break;o.push(r>>12|224,r>>6&63|128,63&r|128)}else{if(!(r<1114112))throw new Error("Invalid code point");if((t-=4)<0)break;o.push(r>>18|240,r>>12&63|128,r>>6&63|128,63&r|128)}}return o}function j(e){return te.toByteArray(function(e){if((e=(e=e.split("=")[0]).trim().replace(P,"")).length<2)return"";for(;e.length%4!=0;)e+="=";return e}(e))}function N(e,t,r,n){for(var i=0;i<n&&!(i+r>=t.length||i>=e.length);++i)t[i+r]=e[i];return i}function M(e,t){return e instanceof t||null!=e&&null!=e.constructor&&null!=e.constructor.name&&e.constructor.name===t.name}function L(e){return e!=e}}).call(this,y({}).Buffer)}),m=r(function(e,t){var r=function(e){function t(){this.fetch=!1,this.DOMException=e.DOMException}return t.prototype=e,new t}("undefined"!=typeof self?self:this);!function(e){!function(t){var r={searchParams:"URLSearchParams"in e,iterable:"Symbol"in e&&"iterator"in Symbol,blob:"FileReader"in e&&"Blob"in e&&function(){try{return new Blob,!0}catch(e){return!1}}(),formData:"FormData"in e,arrayBuffer:"ArrayBuffer"in e};if(r.arrayBuffer)var n=["[object Int8Array]","[object Uint8Array]","[object Uint8ClampedArray]","[object Int16Array]","[object Uint16Array]","[object Int32Array]","[object Uint32Array]","[object Float32Array]","[object Float64Array]"],i=ArrayBuffer.isView||function(e){return e&&n.indexOf(Object.prototype.toString.call(e))>-1};function o(e){if("string"!=typeof e&&(e=String(e)),/[^a-z0-9\-#$%&'*+.^_`|~]/i.test(e))throw new TypeError("Invalid character in header field name");return e.toLowerCase()}function a(e){return"string"!=typeof e&&(e=String(e)),e}function s(e){var t={next:function(){var t=e.shift();return{done:void 0===t,value:t}}};return r.iterable&&(t[Symbol.iterator]=function(){return t}),t}function u(e){this.map={},e instanceof u?e.forEach(function(e,t){this.append(t,e)},this):Array.isArray(e)?e.forEach(function(e){this.append(e[0],e[1])},this):e&&Object.getOwnPropertyNames(e).forEach(function(t){this.append(t,e[t])},this)}function c(e){if(e.bodyUsed)return Promise.reject(new TypeError("Already read"));e.bodyUsed=!0}function l(e){return new Promise(function(t,r){e.onload=function(){t(e.result)},e.onerror=function(){r(e.error)}})}function f(e){var t=new FileReader,r=l(t);return t.readAsArrayBuffer(e),r}function d(e){if(e.slice)return e.slice(0);var t=new Uint8Array(e.byteLength);return t.set(new Uint8Array(e)),t.buffer}function h(){return this.bodyUsed=!1,this._initBody=function(e){var t;this._bodyInit=e,e?"string"==typeof e?this._bodyText=e:r.blob&&Blob.prototype.isPrototypeOf(e)?this._bodyBlob=e:r.formData&&FormData.prototype.isPrototypeOf(e)?this._bodyFormData=e:r.searchParams&&URLSearchParams.prototype.isPrototypeOf(e)?this._bodyText=e.toString():r.arrayBuffer&&r.blob&&(t=e)&&DataView.prototype.isPrototypeOf(t)?(this._bodyArrayBuffer=d(e.buffer),this._bodyInit=new Blob([this._bodyArrayBuffer])):r.arrayBuffer&&(ArrayBuffer.prototype.isPrototypeOf(e)||i(e))?this._bodyArrayBuffer=d(e):this._bodyText=e=Object.prototype.toString.call(e):this._bodyText="",this.headers.get("content-type")||("string"==typeof e?this.headers.set("content-type","text/plain;charset=UTF-8"):this._bodyBlob&&this._bodyBlob.type?this.headers.set("content-type",this._bodyBlob.type):r.searchParams&&URLSearchParams.prototype.isPrototypeOf(e)&&this.headers.set("content-type","application/x-www-form-urlencoded;charset=UTF-8"))},r.blob&&(this.blob=function(){var e=c(this);if(e)return e;if(this._bodyBlob)return Promise.resolve(this._bodyBlob);if(this._bodyArrayBuffer)return Promise.resolve(new Blob([this._bodyArrayBuffer]));if(this._bodyFormData)throw new Error("could not read FormData body as blob");return Promise.resolve(new Blob([this._bodyText]))},this.arrayBuffer=function(){return this._bodyArrayBuffer?c(this)||Promise.resolve(this._bodyArrayBuffer):this.blob().then(f)}),this.text=function(){var e,t,r,n=c(this);if(n)return n;if(this._bodyBlob)return e=this._bodyBlob,r=l(t=new FileReader),t.readAsText(e),r;if(this._bodyArrayBuffer)return Promise.resolve(function(e){for(var t=new Uint8Array(e),r=new Array(t.length),n=0;n<t.length;n++)r[n]=String.fromCharCode(t[n]);return r.join("")}(this._bodyArrayBuffer));if(this._bodyFormData)throw new Error("could not read FormData body as text");return Promise.resolve(this._bodyText)},r.formData&&(this.formData=function(){return this.text().then(m)}),this.json=function(){return this.text().then(JSON.parse)},this}u.prototype.append=function(e,t){e=o(e),t=a(t);var r=this.map[e];this.map[e]=r?r+", "+t:t},u.prototype.delete=function(e){delete this.map[o(e)]},u.prototype.get=function(e){return e=o(e),this.has(e)?this.map[e]:null},u.prototype.has=function(e){return this.map.hasOwnProperty(o(e))},u.prototype.set=function(e,t){this.map[o(e)]=a(t)},u.prototype.forEach=function(e,t){for(var r in this.map)this.map.hasOwnProperty(r)&&e.call(t,this.map[r],r,this)},u.prototype.keys=function(){var e=[];return this.forEach(function(t,r){e.push(r)}),s(e)},u.prototype.values=function(){var e=[];return this.forEach(function(t){e.push(t)}),s(e)},u.prototype.entries=function(){var e=[];return this.forEach(function(t,r){e.push([r,t])}),s(e)},r.iterable&&(u.prototype[Symbol.iterator]=u.prototype.entries);var p=["DELETE","GET","HEAD","OPTIONS","POST","PUT"];function y(e,t){var r,n,i=(t=t||{}).body;if(e instanceof y){if(e.bodyUsed)throw new TypeError("Already read");this.url=e.url,this.credentials=e.credentials,t.headers||(this.headers=new u(e.headers)),this.method=e.method,this.mode=e.mode,this.signal=e.signal,i||null==e._bodyInit||(i=e._bodyInit,e.bodyUsed=!0)}else this.url=String(e);if(this.credentials=t.credentials||this.credentials||"same-origin",!t.headers&&this.headers||(this.headers=new u(t.headers)),this.method=(n=(r=t.method||this.method||"GET").toUpperCase(),p.indexOf(n)>-1?n:r),this.mode=t.mode||this.mode||null,this.signal=t.signal||this.signal,this.referrer=null,("GET"===this.method||"HEAD"===this.method)&&i)throw new TypeError("Body not allowed for GET or HEAD requests");this._initBody(i)}function m(e){var t=new FormData;return e.trim().split("&").forEach(function(e){if(e){var r=e.split("="),n=r.shift().replace(/\+/g," "),i=r.join("=").replace(/\+/g," ");t.append(decodeURIComponent(n),decodeURIComponent(i))}}),t}function b(e,t){t||(t={}),this.type="default",this.status=void 0===t.status?200:t.status,this.ok=this.status>=200&&this.status<300,this.statusText="statusText"in t?t.statusText:"OK",this.headers=new u(t.headers),this.url=t.url||"",this._initBody(e)}y.prototype.clone=function(){return new y(this,{body:this._bodyInit})},h.call(y.prototype),h.call(b.prototype),b.prototype.clone=function(){return new b(this._bodyInit,{status:this.status,statusText:this.statusText,headers:new u(this.headers),url:this.url})},b.error=function(){var e=new b(null,{status:0,statusText:""});return e.type="error",e};var g=[301,302,303,307,308];b.redirect=function(e,t){if(-1===g.indexOf(t))throw new RangeError("Invalid status code");return new b(null,{status:t,headers:{location:e}})},t.DOMException=e.DOMException;try{new t.DOMException}catch(w){t.DOMException=function(e,t){this.message=e,this.name=t;var r=Error(e);this.stack=r.stack},t.DOMException.prototype=Object.create(Error.prototype),t.DOMException.prototype.constructor=t.DOMException}function v(e,n){return new Promise(function(i,o){var a=new y(e,n);if(a.signal&&a.signal.aborted)return o(new t.DOMException("Aborted","AbortError"));var s=new XMLHttpRequest;function c(){s.abort()}s.onload=function(){var e,t,r={status:s.status,statusText:s.statusText,headers:(e=s.getAllResponseHeaders()||"",t=new u,e.replace(/\r?\n[\t ]+/g," ").split(/\r?\n/).forEach(function(e){var r=e.split(":"),n=r.shift().trim();if(n){var i=r.join(":").trim();t.append(n,i)}}),t)};r.url="responseURL"in s?s.responseURL:r.headers.get("X-Request-URL");var n="response"in s?s.response:s.responseText;i(new b(n,r))},s.onerror=function(){o(new TypeError("Network request failed"))},s.ontimeout=function(){o(new TypeError("Network request failed"))},s.onabort=function(){o(new t.DOMException("Aborted","AbortError"))},s.open(a.method,a.url,!0),"include"===a.credentials?s.withCredentials=!0:"omit"===a.credentials&&(s.withCredentials=!1),"responseType"in s&&r.blob&&(s.responseType="blob"),a.headers.forEach(function(e,t){s.setRequestHeader(t,e)}),a.signal&&(a.signal.addEventListener("abort",c),s.onreadystatechange=function(){4===s.readyState&&a.signal.removeEventListener("abort",c)}),s.send(void 0===a._bodyInit?null:a._bodyInit)})}v.polyfill=!0,e.fetch||(e.fetch=v,e.Headers=u,e.Request=y,e.Response=b),t.Headers=u,t.Request=y,t.Response=b,t.fetch=v}({})}(r),delete r.fetch.polyfill,(t=r.fetch).default=r.fetch,t.fetch=r.fetch,t.Headers=r.Headers,t.Request=r.Request,t.Response=r.Response,e.exports=t}),b=r(function(e,t){var r=1e3,n=6e4,i=36e5,o=24*i;function a(e,t,r,n){var i=t>=1.5*r;return Math.round(e/r)+" "+n+(i?"s":"")}e.exports=function(e,t){t=t||{};var s,u,c=typeof e;if("string"===c&&e.length>0)return function(e){if(!((e=String(e)).length>100)){var t=/^(-?(?:\d+)?\.?\d+) *(milliseconds?|msecs?|ms|seconds?|secs?|s|minutes?|mins?|m|hours?|hrs?|h|days?|d|weeks?|w|years?|yrs?|y)?$/i.exec(e);if(t){var a=parseFloat(t[1]);switch((t[2]||"ms").toLowerCase()){case"years":case"year":case"yrs":case"yr":case"y":return 315576e5*a;case"weeks":case"week":case"w":return 6048e5*a;case"days":case"day":case"d":return a*o;case"hours":case"hour":case"hrs":case"hr":case"h":return a*i;case"minutes":case"minute":case"mins":case"min":case"m":return a*n;case"seconds":case"second":case"secs":case"sec":case"s":return a*r;case"milliseconds":case"millisecond":case"msecs":case"msec":case"ms":return a;default:return}}}}(e);if("number"===c&&isFinite(e))return t.long?(s=e,(u=Math.abs(s))>=o?a(s,u,o,"day"):u>=i?a(s,u,i,"hour"):u>=n?a(s,u,n,"minute"):u>=r?a(s,u,r,"second"):s+" ms"):function(e){var t=Math.abs(e);return t>=o?Math.round(e/o)+"d":t>=i?Math.round(e/i)+"h":t>=n?Math.round(e/n)+"m":t>=r?Math.round(e/r)+"s":e+"ms"}(e);throw new Error("val is not a non-empty string or a valid number. val="+JSON.stringify(e))}}),g={},v=g={};function w(){throw new Error("setTimeout has not been defined")}function _(){throw new Error("clearTimeout has not been defined")}function q(t){if(e===setTimeout)return setTimeout(t,0);if((e===w||!e)&&setTimeout)return e=setTimeout,setTimeout(t,0);try{return e(t,0)}catch(r){try{return e.call(null,t,0)}catch(r){return e.call(this,t,0)}}}!function(){try{e="function"==typeof setTimeout?setTimeout:w}catch(r){e=w}try{t="function"==typeof clearTimeout?clearTimeout:_}catch(r){t=_}}();var x,E=[],O=!1,S=-1;function C(){O&&x&&(O=!1,x.length?E=x.concat(E):S=-1,E.length&&R())}function R(){if(!O){var e=q(C);O=!0;for(var r=E.length;r;){for(x=E,E=[];++S<r;)x&&x[S].run();S=-1,r=E.length}x=null,O=!1,function(e){if(t===clearTimeout)return clearTimeout(e);if((t===_||!t)&&clearTimeout)return t=clearTimeout,clearTimeout(e);try{t(e)}catch(r){try{return t.call(null,e)}catch(r){return t.call(this,e)}}}(e)}}function A(e,t){this.fun=e,this.array=t}function T(){}v.nextTick=function(e){var t=new Array(arguments.length-1);if(arguments.length>1)for(var r=1;r<arguments.length;r++)t[r-1]=arguments[r];E.push(new A(e,t)),1!==E.length||O||q(R)},A.prototype.run=function(){this.fun.apply(null,this.array)},v.title="browser",v.browser=!0,v.env={},v.argv=[],v.version="",v.versions={},v.on=T,v.addListener=T,v.once=T,v.off=T,v.removeListener=T,v.removeAllListeners=T,v.emit=T,v.prependListener=T,v.prependOnceListener=T,v.listeners=function(e){return[]},v.binding=function(e){throw new Error("process.binding is not supported")},v.cwd=function(){return"/"},v.chdir=function(e){throw new Error("process.chdir is not supported")},v.umask=function(){return 0};var P={};(function(e){P.log=function(...e){return"object"==typeof console&&console.log&&console.log(...e)},P.formatArgs=function(e){if(e[0]=(this.useColors?"%c":"")+this.namespace+(this.useColors?" %c":" ")+e[0]+(this.useColors?"%c ":" ")+"+"+P.humanize(this.diff),!this.useColors)return;const t="color: "+this.color;e.splice(1,0,t,"color: inherit");let r=0,n=0;e[0].replace(/%[a-zA-Z%]/g,e=>{"%%"!==e&&(r++,"%c"===e&&(n=r))}),e.splice(n,0,t)},P.save=function(e){try{e?P.storage.setItem("debug",e):P.storage.removeItem("debug")}catch(t){}},P.load=function(){let t;try{t=P.storage.getItem("debug")}catch(r){}return!t&&void 0!==e&&"env"in e&&(t=e.env.DEBUG),t},P.useColors=function(){return!("undefined"==typeof window||!window.process||"renderer"!==window.process.type&&!window.process.__nwjs)||("undefined"==typeof navigator||!navigator.userAgent||!navigator.userAgent.toLowerCase().match(/(edge|trident)\/(\d+)/))&&("undefined"!=typeof document&&document.documentElement&&document.documentElement.style&&document.documentElement.style.WebkitAppearance||"undefined"!=typeof window&&window.console&&(window.console.firebug||window.console.exception&&window.console.table)||"undefined"!=typeof navigator&&navigator.userAgent&&navigator.userAgent.toLowerCase().match(/firefox\/(\d+)/)&&parseInt(RegExp.$1,10)>=31||"undefined"!=typeof navigator&&navigator.userAgent&&navigator.userAgent.toLowerCase().match(/applewebkit\/(\d+)/))},P.storage=function(){try{return localStorage}catch(e){}}(),P.colors=["#0000CC","#0000FF","#0033CC","#0033FF","#0066CC","#0066FF","#0099CC","#0099FF","#00CC00","#00CC33","#00CC66","#00CC99","#00CCCC","#00CCFF","#3300CC","#3300FF","#3333CC","#3333FF","#3366CC","#3366FF","#3399CC","#3399FF","#33CC00","#33CC33","#33CC66","#33CC99","#33CCCC","#33CCFF","#6600CC","#6600FF","#6633CC","#6633FF","#66CC00","#66CC33","#9900CC","#9900FF","#9933CC","#9933FF","#99CC00","#99CC33","#CC0000","#CC0033","#CC0066","#CC0099","#CC00CC","#CC00FF","#CC3300","#CC3333","#CC3366","#CC3399","#CC33CC","#CC33FF","#CC6600","#CC6633","#CC9900","#CC9933","#CCCC00","#CCCC33","#FF0000","#FF0033","#FF0066","#FF0099","#FF00CC","#FF00FF","#FF3300","#FF3333","#FF3366","#FF3399","#FF33CC","#FF33FF","#FF6600","#FF6633","#FF9900","#FF9933","#FFCC00","#FFCC33"],P=function(e){function t(e){let t=0;for(let r=0;r<e.length;r++)t=(t<<5)-t+e.charCodeAt(r),t|=0;return r.colors[Math.abs(t)%r.colors.length]}function r(e){let o;function a(...e){if(!a.enabled)return;const t=a,n=Number(new Date),i=n-(o||n);t.diff=i,t.prev=o,t.curr=n,o=n,e[0]=r.coerce(e[0]),"string"!=typeof e[0]&&e.unshift("%O");let s=0;e[0]=e[0].replace(/%([a-zA-Z%])/g,(n,i)=>{if("%%"===n)return n;s++;const o=r.formatters[i];if("function"==typeof o){const r=e[s];n=o.call(t,r),e.splice(s,1),s--}return n}),r.formatArgs.call(t,e),(t.log||r.log).apply(t,e)}return a.namespace=e,a.enabled=r.enabled(e),a.useColors=r.useColors(),a.color=t(e),a.destroy=n,a.extend=i,"function"==typeof r.init&&r.init(a),r.instances.push(a),a}function n(){const e=r.instances.indexOf(this);return-1!==e&&(r.instances.splice(e,1),!0)}function i(e,t){const n=r(this.namespace+(void 0===t?":":t)+e);return n.log=this.log,n}function o(e){return e.toString().substring(2,e.toString().length-2).replace(/\.\*\?$/,"*")}return r.debug=r,r.default=r,r.coerce=function(e){return e instanceof Error?e.stack||e.message:e},r.disable=function(){const e=[...r.names.map(o),...r.skips.map(o).map(e=>"-"+e)].join(",");return r.enable(""),e},r.enable=function(e){let t;r.save(e),r.names=[],r.skips=[];const n=("string"==typeof e?e:"").split(/[\s,]+/),i=n.length;for(t=0;t<i;t++)n[t]&&("-"===(e=n[t].replace(/\*/g,".*?"))[0]?r.skips.push(new RegExp("^"+e.substr(1)+"$")):r.names.push(new RegExp("^"+e+"$")));for(t=0;t<r.instances.length;t++){const e=r.instances[t];e.enabled=r.enabled(e.namespace)}},r.enabled=function(e){if("*"===e[e.length-1])return!0;let t,n;for(t=0,n=r.skips.length;t<n;t++)if(r.skips[t].test(e))return!1;for(t=0,n=r.names.length;t<n;t++)if(r.names[t].test(e))return!0;return!1},r.humanize=b({}),Object.keys(e).forEach(t=>{r[t]=e[t]}),r.instances=[],r.names=[],r.skips=[],r.formatters={},r.selectColor=t,r.enable(r.load()),r}(P);const{formatters:t}=P;t.j=function(e){try{return JSON.stringify(e)}catch(t){return"[UnexpectedJSONParseError]: "+t.message}}}).call(this,g);var I=function(e){return btoa(e)},j=function(e){return e&&"object"==typeof e&&"function"==typeof e.copy&&"function"==typeof e.fill&&"function"==typeof e.readUInt8},N={};N="function"==typeof Object.create?function(e,t){e.super_=t,e.prototype=Object.create(t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}})}:function(e,t){e.super_=t;var r=function(){};r.prototype=t.prototype,e.prototype=new r,e.prototype.constructor=e};var M={};(function(e,t){var r=/%[sdj%]/g;M.format=function(e){if(!y(e)){for(var t=[],n=0;n<arguments.length;n++)t.push(o(arguments[n]));return t.join(" ")}n=1;for(var i=arguments,a=i.length,s=String(e).replace(r,function(e){if("%%"===e)return"%";if(n>=a)return e;switch(e){case"%s":return String(i[n++]);case"%d":return Number(i[n++]);case"%j":try{return JSON.stringify(i[n++])}catch(t){return"[Circular]"}default:return e}}),u=i[n];n<a;u=i[++n])h(u)||!g(u)?s+=" "+u:s+=" "+o(u);return s},M.deprecate=function(r,n){if(m(t.process))return function(){return M.deprecate(r,n).apply(this,arguments)};if(!0===e.noDeprecation)return r;var i=!1;return function(){if(!i){if(e.throwDeprecation)throw new Error(n);e.traceDeprecation?console.trace(n):console.error(n),i=!0}return r.apply(this,arguments)}};var n,i={};function o(e,t){var r={seen:[],stylize:s};return arguments.length>=3&&(r.depth=arguments[2]),arguments.length>=4&&(r.colors=arguments[3]),d(t)?r.showHidden=t:t&&M._extend(r,t),m(r.showHidden)&&(r.showHidden=!1),m(r.depth)&&(r.depth=2),m(r.colors)&&(r.colors=!1),m(r.customInspect)&&(r.customInspect=!0),r.colors&&(r.stylize=a),u(r,e,r.depth)}function a(e,t){var r=o.styles[t];return r?"\x1b["+o.colors[r][0]+"m"+e+"\x1b["+o.colors[r][1]+"m":e}function s(e,t){return e}function u(e,t,r){if(e.customInspect&&t&&_(t.inspect)&&t.inspect!==M.inspect&&(!t.constructor||t.constructor.prototype!==t)){var n=t.inspect(r,e);return y(n)||(n=u(e,n,r)),n}var i=function(e,t){if(m(t))return e.stylize("undefined","undefined");if(y(t)){var r="'"+JSON.stringify(t).replace(/^"|"$/g,"").replace(/'/g,"\\'").replace(/\\"/g,'"')+"'";return e.stylize(r,"string")}return p(t)?e.stylize(""+t,"number"):d(t)?e.stylize(""+t,"boolean"):h(t)?e.stylize("null","null"):void 0}(e,t);if(i)return i;var o,a=Object.keys(t),s=(o={},a.forEach(function(e,t){o[e]=!0}),o);if(e.showHidden&&(a=Object.getOwnPropertyNames(t)),w(t)&&(a.indexOf("message")>=0||a.indexOf("description")>=0))return c(t);if(0===a.length){if(_(t)){var g=t.name?": "+t.name:"";return e.stylize("[Function"+g+"]","special")}if(b(t))return e.stylize(RegExp.prototype.toString.call(t),"regexp");if(v(t))return e.stylize(Date.prototype.toString.call(t),"date");if(w(t))return c(t)}var q,x="",E=!1,S=["{","}"];return f(t)&&(E=!0,S=["[","]"]),_(t)&&(x=" [Function"+(t.name?": "+t.name:"")+"]"),b(t)&&(x=" "+RegExp.prototype.toString.call(t)),v(t)&&(x=" "+Date.prototype.toUTCString.call(t)),w(t)&&(x=" "+c(t)),0!==a.length||E&&0!=t.length?r<0?b(t)?e.stylize(RegExp.prototype.toString.call(t),"regexp"):e.stylize("[Object]","special"):(e.seen.push(t),q=E?function(e,t,r,n,i){for(var o=[],a=0,s=t.length;a<s;++a)O(t,String(a))?o.push(l(e,t,r,n,String(a),!0)):o.push("");return i.forEach(function(i){i.match(/^\d+$/)||o.push(l(e,t,r,n,i,!0))}),o}(e,t,r,s,a):a.map(function(n){return l(e,t,r,s,n,E)}),e.seen.pop(),function(e,t,r){return e.reduce(function(e,t){return t.indexOf("\n"),e+t.replace(/\u001b\[\d\d?m/g,"").length+1},0)>60?r[0]+(""===t?"":t+"\n ")+" "+e.join(",\n  ")+" "+r[1]:r[0]+t+" "+e.join(", ")+" "+r[1]}(q,x,S)):S[0]+x+S[1]}function c(e){return"["+Error.prototype.toString.call(e)+"]"}function l(e,t,r,n,i,o){var a,s,c;if((c=Object.getOwnPropertyDescriptor(t,i)||{value:t[i]}).get?s=c.set?e.stylize("[Getter/Setter]","special"):e.stylize("[Getter]","special"):c.set&&(s=e.stylize("[Setter]","special")),O(n,i)||(a="["+i+"]"),s||(e.seen.indexOf(c.value)<0?(s=h(r)?u(e,c.value,null):u(e,c.value,r-1)).indexOf("\n")>-1&&(s=o?s.split("\n").map(function(e){return"  "+e}).join("\n").substr(2):"\n"+s.split("\n").map(function(e){return"   "+e}).join("\n")):s=e.stylize("[Circular]","special")),m(a)){if(o&&i.match(/^\d+$/))return s;(a=JSON.stringify(""+i)).match(/^"([a-zA-Z_][a-zA-Z_0-9]*)"$/)?(a=a.substr(1,a.length-2),a=e.stylize(a,"name")):(a=a.replace(/'/g,"\\'").replace(/\\"/g,'"').replace(/(^"|"$)/g,"'"),a=e.stylize(a,"string"))}return a+": "+s}function f(e){return Array.isArray(e)}function d(e){return"boolean"==typeof e}function h(e){return null===e}function p(e){return"number"==typeof e}function y(e){return"string"==typeof e}function m(e){return void 0===e}function b(e){return g(e)&&"[object RegExp]"===q(e)}function g(e){return"object"==typeof e&&null!==e}function v(e){return g(e)&&"[object Date]"===q(e)}function w(e){return g(e)&&("[object Error]"===q(e)||e instanceof Error)}function _(e){return"function"==typeof e}function q(e){return Object.prototype.toString.call(e)}function x(e){return e<10?"0"+e.toString(10):e.toString(10)}M.debuglog=function(t){if(m(n)&&(n=e.env.NODE_DEBUG||""),t=t.toUpperCase(),!i[t])if(new RegExp("\\b"+t+"\\b","i").test(n)){var r=e.pid;i[t]=function(){var e=M.format.apply(M,arguments);console.error("%s %d: %s",t,r,e)}}else i[t]=function(){};return i[t]},M.inspect=o,o.colors={bold:[1,22],italic:[3,23],underline:[4,24],inverse:[7,27],white:[37,39],grey:[90,39],black:[30,39],blue:[34,39],cyan:[36,39],green:[32,39],magenta:[35,39],red:[31,39],yellow:[33,39]},o.styles={special:"cyan",number:"yellow",boolean:"yellow",undefined:"grey",null:"bold",string:"green",date:"magenta",regexp:"red"},M.isArray=f,M.isBoolean=d,M.isNull=h,M.isNullOrUndefined=function(e){return null==e},M.isNumber=p,M.isString=y,M.isSymbol=function(e){return"symbol"==typeof e},M.isUndefined=m,M.isRegExp=b,M.isObject=g,M.isDate=v,M.isError=w,M.isFunction=_,M.isPrimitive=function(e){return null===e||"boolean"==typeof e||"number"==typeof e||"string"==typeof e||"symbol"==typeof e||void 0===e},M.isBuffer=j;var E=["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"];function O(e,t){return Object.prototype.hasOwnProperty.call(e,t)}M.log=function(){var e,t;console.log("%s - %s",(t=[x((e=new Date).getHours()),x(e.getMinutes()),x(e.getSeconds())].join(":"),[e.getDate(),E[e.getMonth()],t].join(" ")),M.format.apply(M,arguments))},M.inherits=N,M._extend=function(e,t){if(!t||!g(t))return e;for(var r=Object.keys(t),n=r.length;n--;)e[r[n]]=t[r[n]];return e}}).call(this,g,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{});var L={};function k(e,t){Error.call(this),this.name=e,this.message=t}function D(e){k.call(this,"InvalidValue",e)}function F(e,t,r,n){const i=`${n} function requires ${function(e,t){return null===t?"at least "+e:null===e?"up to "+t:e===t?e:"from "+e+" to "+t}(e,t)} argument(s) but ${r} were given`,o=`For more info, see the docs: https://docs.fauna.com/fauna/current/api/fql/functions/${n.toLowerCase()}`;k.call(this,"InvalidArity",`${i}\n${o}`),this.min=e,this.max=t,this.actual=r}function U(e,t){var r=t.responseContent.errors,n=0===r.length?'(empty "errors")':r[0].code;k.call(this,e,n),this.requestResult=t}function B(e){U.call(this,"BadRequest",e)}function V(e){U.call(this,"Unauthorized",e)}function z(e){U.call(this,"PermissionDenied",e)}function $(e){U.call(this,"NotFound",e)}function H(e){U.call(this,"MethodNotAllowed",e)}function W(e){U.call(this,"InternalError",e)}function G(e){U.call(this,"UnavailableError",e)}M.inherits(k,Error),M.inherits(D,k),M.inherits(F,k),M.inherits(U,k),U.prototype.errors=function(){return this.requestResult.responseContent.errors},U.raiseForStatusCode=function(e){var t=e.statusCode;if(t<200||t>=300)switch(t){case 400:throw new B(e);case 401:throw new V(e);case 403:throw new z(e);case 404:throw new $(e);case 405:throw new H(e);case 500:throw new W(e);case 503:throw new G(e);default:throw new U("UnknownError",e)}},M.inherits(B,U),M.inherits(V,U),M.inherits(z,U),M.inherits($,U),M.inherits(H,U),M.inherits(W,U),M.inherits(G,U),L={FaunaHTTPError:U,InvalidValue:D,InvalidArity:F,BadRequest:B,Unauthorized:V,PermissionDenied:z,NotFound:$,MethodNotAllowed:H,InternalError:W,UnavailableError:G};var J=function(e){if("function"!=typeof e)throw new Error("Could not parse function signature for injection dependencies: Object is not a function");if(!e.length)return[];var t=/^()\(?([^)=]*)\)? *=>/.exec(e+"")||/^[^(]+([^ \(]*) *\(([^\)]*)\)/.exec(e+"");if(!t)throw new Error("Could not parse function signature for injection dependencies: "+e);var r=t[2].replace(/\/\*[\S\s]*?\*\//g," ").replace(/\/\/.*/g," ");function n(e,t,r){return t+r.split(",").map(function(e){return e&&e.trim()}).filter(Boolean).join("@")}return(r=(r=r.replace(/(\{)([^}]*)\}/g,n)).replace(/(\[)([^}]*)\]/g,n)).split(",").map(function(e){return e&&e.trim()}).map(function(e){return"{"===e[0]?e.substring(1).split("@"):"["===e[0]?{items:e.substring(1).split("@")}:e}).filter(Boolean)},Q={};(function(e){function t(t){try{if(!e.localStorage)return!1}catch(n){return!1}var r=e.localStorage[t];return null!=r&&"true"===String(r).toLowerCase()}Q=function(e,r){if(t("noDeprecation"))return e;var n=!1;return function(){if(!n){if(t("throwDeprecation"))throw new Error(r);t("traceDeprecation")?console.trace(r):console.warn(r),n=!0}return e.apply(this,arguments)}}}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{});var X={};function K(e){this.raw=e}K.prototype.toJSON=function(){return this.raw};var Y=["Do","Call","Union","Intersection","Difference","Equals","Add","BitAnd","BitOr","BitXor","Divide","Max","Min","Modulo","Multiply","Subtract","LT","LTE","GT","GTE","And","Or"],Z={is_nonempty:"is_non_empty",lt:"LT",lte:"LTE",gt:"GT",gte:"GTE"},ee=function(e,t){if(e instanceof K){if("value"in e)return e.toString();e=e.raw}var r=typeof e;if("string"===r)return JSON.stringify(e);if("symbol"===r||"number"===r||"boolean"===r)return e.toString();if("undefined"===r)return"undefined";if(null===e)return"null";var n=function(e){return"{"+Object.keys(e).map(function(t){return t+": "+ee(e[t])}).join(", ")+"}"},i=function(e,t){return e.map(function(e){return t(e)}).join(", ")};if(Array.isArray(e)){var o=i(e,ee);return-1!=Y.indexOf(t)?o:"["+o+"]"}if("let"in e&&"in"in e)return"Let("+(Array.isArray(e.let)?"["+i(e.let,n)+"]":n(e.let))+", "+ee(e.in)+")";if("object"in e)return n(e.object);var a=Object.keys(e),s=a[0];s in Z&&(s=Z[s]),s=s.split("_").map(function(e){return e.charAt(0).toUpperCase()+e.slice(1)}).join("");var u=a.map(function(t){var r=e[t];return ee(r,s)});return["filter","map","foreach"].some(function(t){return t in e})&&u.reverse(),u=u.join(", "),s+"("+u+")"};K.toString=ee,X=K;for(var te={toByteArray:function(e){var t,r,n=ue(e),i=n[0],o=n[1],a=new ie(function(e,t,r){return 3*(t+r)/4-r}(0,i,o)),s=0,u=o>0?i-4:i;for(r=0;r<u;r+=4)t=ne[e.charCodeAt(r)]<<18|ne[e.charCodeAt(r+1)]<<12|ne[e.charCodeAt(r+2)]<<6|ne[e.charCodeAt(r+3)],a[s++]=t>>16&255,a[s++]=t>>8&255,a[s++]=255&t;return 2===o&&(t=ne[e.charCodeAt(r)]<<2|ne[e.charCodeAt(r+1)]>>4,a[s++]=255&t),1===o&&(t=ne[e.charCodeAt(r)]<<10|ne[e.charCodeAt(r+1)]<<4|ne[e.charCodeAt(r+2)]>>2,a[s++]=t>>8&255,a[s++]=255&t),a},fromByteArray:function(e){for(var t,r=e.length,n=r%3,i=[],o=0,a=r-n;o<a;o+=16383)i.push(ce(e,o,o+16383>a?a:o+16383));return 1===n?(t=e[r-1],i.push(re[t>>2]+re[t<<4&63]+"==")):2===n&&(t=(e[r-2]<<8)+e[r-1],i.push(re[t>>10]+re[t>>4&63]+re[t<<2&63]+"=")),i.join("")}},re=[],ne=[],ie="undefined"!=typeof Uint8Array?Uint8Array:Array,oe="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",ae=0,se=oe.length;ae<se;++ae)re[ae]=oe[ae],ne[oe.charCodeAt(ae)]=ae;function ue(e){var t=e.length;if(t%4>0)throw new Error("Invalid string. Length must be a multiple of 4");var r=e.indexOf("=");return-1===r&&(r=t),[r,r===t?0:4-r%4]}function ce(e,t,r){for(var n,i,o=[],a=t;a<r;a+=3)n=(e[a]<<16&16711680)+(e[a+1]<<8&65280)+(255&e[a+2]),o.push(re[(i=n)>>18&63]+re[i>>12&63]+re[i>>6&63]+re[63&i]);return o.join("")}ne["-".charCodeAt(0)]=62,ne["_".charCodeAt(0)]=63;var le={},fe=M&&M.inspect&&M.inspect.custom,de=M&&M.inspect||JSON.stringify;function he(){}function pe(e,t,r){if(!e)throw new L.InvalidValue("id cannot be null or undefined");this.value={id:e},t&&(this.value.collection=t),r&&(this.value.database=r)}M.inherits(he,X),M.inherits(pe,he),Object.defineProperty(pe.prototype,"collection",{get:function(){return this.value.collection}}),Object.defineProperty(pe.prototype,"class",{get:Q(function(){return this.value.collection},"class is deprecated, use collection instead")}),Object.defineProperty(pe.prototype,"database",{get:function(){return this.value.database}}),Object.defineProperty(pe.prototype,"id",{get:function(){return this.value.id}}),pe.prototype.toJSON=function(){return{"@ref":this.value}},_e(pe,function(){var e={collections:"Collection",databases:"Database",indexes:"Index",functions:"Function",roles:"Role"},t=function(r){if(void 0===r.collection){var n=void 0!==r.database?r.database.toString():"";return r.id.charAt(0).toUpperCase()+r.id.slice(1)+"("+n+")"}var i=e[r.collection.id];return void 0!==i?(n=void 0!==r.database?", "+r.database.toString():"",i+'("'+r.id+'"'+n+")"):"Ref("+t(r.collection)+', "'+r.id+'")'};return t(this)}),pe.prototype.valueOf=function(){return this.value},pe.prototype.equals=function(e){return e instanceof pe&&this.id===e.id&&(void 0===this.collection&&void 0===e.collection||this.collection.equals(e.collection))&&(void 0===this.database&&void 0===e.database||this.database.equals(e.database))};var ye={COLLECTIONS:new pe("collections"),INDEXES:new pe("indexes"),DATABASES:new pe("databases"),FUNCTIONS:new pe("functions"),ROLES:new pe("roles"),KEYS:new pe("keys")};function me(e){this.value=e}function be(e){if(e instanceof Date)e=e.toISOString();else if("Z"!==e.charAt(e.length-1))throw new L.InvalidValue("Only allowed timezone is 'Z', got: "+e);this.value=e}function ge(e){e instanceof Date&&(e=e.toISOString().slice(0,10)),this.value=e}function ve(e){if(e instanceof ArrayBuffer)this.value=new Uint8Array(e);else if("string"==typeof e)this.value=te.toByteArray(e);else{if(!(e instanceof Uint8Array))throw new L.InvalidValue("Bytes type expect argument to be either Uint8Array|ArrayBuffer|string, got: "+de(e));this.value=e}}function we(e){this.value=e}function _e(e,t){e.prototype.toString=t,e.prototype.inspect=t,fe&&(e.prototype[fe]=t)}ye.fromName=function(e){switch(e){case"collections":return ye.COLLECTIONS;case"indexes":return ye.INDEXES;case"databases":return ye.DATABASES;case"functions":return ye.FUNCTIONS;case"roles":return ye.ROLES;case"keys":return ye.KEYS}return new pe(e)},M.inherits(me,he),_e(me,function(){return X.toString(this.value)}),me.prototype.toJSON=function(){return{"@set":this.value}},M.inherits(be,he),Object.defineProperty(be.prototype,"date",{get:function(){return new Date(this.value)}}),_e(be,function(){return'Time("'+this.value+'")'}),be.prototype.toJSON=function(){return{"@ts":this.value}},M.inherits(ge,he),Object.defineProperty(ge.prototype,"date",{get:function(){return new Date(this.value)}}),_e(ge,function(){return'Date("'+this.value+'")'}),ge.prototype.toJSON=function(){return{"@date":this.value}},M.inherits(ve,he),_e(ve,function(){return'Bytes("'+te.fromByteArray(this.value)+'")'}),ve.prototype.toJSON=function(){return{"@bytes":te.fromByteArray(this.value)}},M.inherits(we,he),_e(we,function(){return"Query("+X.toString(this.value)+")"}),we.prototype.toJSON=function(){return{"@query":this.value}},le={Value:he,Ref:pe,Native:ye,SetRef:me,FaunaTime:be,FaunaDate:ge,Bytes:ve,Query:we};var qe=Object.getOwnPropertySymbols,xe=Object.prototype.hasOwnProperty,Ee=Object.prototype.propertyIsEnumerable,Oe=function(){try{if(!Object.assign)return!1;var e=new String("abc");if(e[5]="de","5"===Object.getOwnPropertyNames(e)[0])return!1;for(var t={},r=0;r<10;r++)t["_"+String.fromCharCode(r)]=r;if("0123456789"!==Object.getOwnPropertyNames(t).map(function(e){return t[e]}).join(""))return!1;var n={};return"abcdefghijklmnopqrst".split("").forEach(function(e){n[e]=e}),"abcdefghijklmnopqrst"===Object.keys(Object.assign({},n)).join("")}catch(i){return!1}}()?Object.assign:function(e,t){for(var r,n,i=function(e){if(null==e)throw new TypeError("Object.assign cannot be called with null or undefined");return Object(e)}(e),o=1;o<arguments.length;o++){for(var a in r=Object(arguments[o]))xe.call(r,a)&&(i[a]=r[a]);if(qe){n=qe(r);for(var s=0;s<n.length;s++)Ee.call(r,n[s])&&(i[n[s]]=r[n[s]])}}return i},Se={};function Ce(e){return Pe.exact(1,arguments,Ce.name),new X({var:Le(e)})}var Re=function(e){return Pe.exact(1,arguments,Re.name),new X({object:ke(e)})};function Ae(){switch(Pe.between(1,2,arguments,Ae.name),arguments.length){case 1:var e=arguments[0];if("function"==typeof e)return function(e){var t=J(e);switch(t.length){case 0:throw new L.InvalidValue("Provided Function must take at least 1 argument.");case 1:return Te(t[0],e(Ce(t[0])));default:return Te(t,e.apply(null,t.map(function(e){return Ce(e)})))}}(e);if(e instanceof X)return e;throw new L.InvalidValue("Lambda function takes either a Function or an Expr.");case 2:return Te(arguments[0],arguments[1])}}function Te(e,t){return new X({lambda:Le(e),expr:Le(t)})}function Pe(e,t,r,n){if(null!==e&&r.length<e||null!==t&&r.length>t)throw new L.InvalidArity(e,t,r.length,n)}function Ie(e,t){for(var r in t){var n=t[r];null!==n&&(e[r]=n)}return e}function je(e){var t=Array.isArray(e)?e:Array.prototype.slice.call(e);return 1===e.length?e[0]:t}function Ne(e){var t=[];return t.push.apply(t,e),t}function Me(e,t){return void 0===e?t:e}function Le(e){return Pe.exact(1,arguments,Le.name),null===e?null:e instanceof X?e:"symbol"==typeof e?e.toString().replace(/Symbol\((.*)\)/,function(e,t){return t}):"function"==typeof e?Ae(e):Array.isArray(e)?new X(e.map(function(e){return Le(e)})):e instanceof Uint8Array||e instanceof ArrayBuffer?new le.Bytes(e):"object"==typeof e?new X({object:ke(e)}):e}function ke(e){if(null!==e){var t={};return Object.keys(e).forEach(function(r){t[r]=Le(e[r])}),t}return null}function De(e,t){if("object"!=typeof t||null===t)return t;if("@ref"in t){var r=t["@ref"];if(!("collection"in r||"database"in r))return le.Native.fromName(r.id);var n=De("collection",r.collection),i=De("database",r.database);return new le.Ref(r.id,n,i)}return"@obj"in t?t["@obj"]:"@set"in t?new le.SetRef(t["@set"]):"@ts"in t?new le.FaunaTime(t["@ts"]):"@date"in t?new le.FaunaDate(t["@date"]):"@bytes"in t?new le.Bytes(t["@bytes"]):"@query"in t?new le.Query(t["@query"]):t}Pe.exact=function(e,t,r){Pe(e,e,t,r)},Pe.max=function(e,t,r){Pe(null,e,t,r)},Pe.min=function(e,t,r){Pe(e,null,t,r)},Pe.between=function(e,t,r,n){Pe(e,t,r,n)},Se={Ref:function e(){switch(Pe.between(1,2,arguments,e.name),arguments.length){case 1:return new X({"@ref":Le(arguments[0])});case 2:return new X({ref:Le(arguments[0]),id:Le(arguments[1])})}},Bytes:function e(t){return Pe.exact(1,arguments,e.name),new le.Bytes(t)},Abort:function e(t){return Pe.exact(1,arguments,e.name),new X({abort:Le(t)})},At:function e(t,r){return Pe.exact(2,arguments,e.name),new X({at:Le(t),expr:Le(r)})},Let:function e(t,r){Pe.exact(2,arguments,e.name);var n;if(n=Array.isArray(t)?t.map(function(e){return ke(e)}):Object.keys(t).map(function(e){var r={};return r[e]=Le(t[e]),r}),"function"==typeof r)if(Array.isArray(t)){var i=[];t.forEach(function(e){Object.keys(e).forEach(function(e){i.push(Ce(e))})}),r=r.apply(null,i)}else r=r.apply(null,Object.keys(t).map(function(e){return Ce(e)}));return new X({let:n,in:Le(r)})},Var:Ce,If:function e(t,r,n){return Pe.exact(3,arguments,e.name),new X({if:Le(t),then:Le(r),else:Le(n)})},Do:function e(){Pe.min(1,arguments,e.name);var t=Ne(arguments);return new X({do:Le(t)})},Object:Re,Lambda:Ae,Call:function e(t){Pe.min(1,arguments,e.name);var r=Ne(arguments);return r.shift(),new X({call:Le(t),arguments:Le(je(r))})},Query:function e(t){return Pe.exact(1,arguments,e.name),new X({query:Le(t)})},Map:function e(t,r){return Pe.exact(2,arguments,e.name),new X({map:Le(r),collection:Le(t)})},Foreach:function e(t,r){return Pe.exact(2,arguments,e.name),new X({foreach:Le(r),collection:Le(t)})},Filter:function e(t,r){return Pe.exact(2,arguments,e.name),new X({filter:Le(r),collection:Le(t)})},Take:function e(t,r){return Pe.exact(2,arguments,e.name),new X({take:Le(t),collection:Le(r)})},Drop:function e(t,r){return Pe.exact(2,arguments,e.name),new X({drop:Le(t),collection:Le(r)})},Prepend:function e(t,r){return Pe.exact(2,arguments,e.name),new X({prepend:Le(t),collection:Le(r)})},Append:function e(t,r){return Pe.exact(2,arguments,e.name),new X({append:Le(t),collection:Le(r)})},IsEmpty:function e(t){return Pe.exact(1,arguments,e.name),new X({is_empty:Le(t)})},IsNonEmpty:function e(t){return Pe.exact(1,arguments,e.name),new X({is_nonempty:Le(t)})},IsNumber:function e(t){return Pe.exact(1,arguments,e.name),new X({is_number:Le(t)})},IsDouble:function e(t){return Pe.exact(1,arguments,e.name),new X({is_double:Le(t)})},IsInteger:function e(t){return Pe.exact(1,arguments,e.name),new X({is_integer:Le(t)})},IsBoolean:function e(t){return Pe.exact(1,arguments,e.name),new X({is_boolean:Le(t)})},IsNull:function e(t){return Pe.exact(1,arguments,e.name),new X({is_null:Le(t)})},IsBytes:function e(t){return Pe.exact(1,arguments,e.name),new X({is_bytes:Le(t)})},IsTimestamp:function e(t){return Pe.exact(1,arguments,e.name),new X({is_timestamp:Le(t)})},IsDate:function e(t){return Pe.exact(1,arguments,e.name),new X({is_date:Le(t)})},IsString:function e(t){return Pe.exact(1,arguments,e.name),new X({is_string:Le(t)})},IsArray:function e(t){return Pe.exact(1,arguments,e.name),new X({is_array:Le(t)})},IsObject:function e(t){return Pe.exact(1,arguments,e.name),new X({is_object:Le(t)})},IsRef:function e(t){return Pe.exact(1,arguments,e.name),new X({is_ref:Le(t)})},IsSet:function e(t){return Pe.exact(1,arguments,e.name),new X({is_set:Le(t)})},IsDoc:function e(t){return Pe.exact(1,arguments,e.name),new X({is_doc:Le(t)})},IsLambda:function e(t){return Pe.exact(1,arguments,e.name),new X({is_lambda:Le(t)})},IsCollection:function e(t){return Pe.exact(1,arguments,e.name),new X({is_collection:Le(t)})},IsDatabase:function e(t){return Pe.exact(1,arguments,e.name),new X({is_database:Le(t)})},IsIndex:function e(t){return Pe.exact(1,arguments,e.name),new X({is_index:Le(t)})},IsFunction:function e(t){return Pe.exact(1,arguments,e.name),new X({is_function:Le(t)})},IsKey:function e(t){return Pe.exact(1,arguments,e.name),new X({is_key:Le(t)})},IsToken:function e(t){return Pe.exact(1,arguments,e.name),new X({is_token:Le(t)})},IsCredentials:function e(t){return Pe.exact(1,arguments,e.name),new X({is_credentials:Le(t)})},IsRole:function e(t){return Pe.exact(1,arguments,e.name),new X({is_role:Le(t)})},Get:function e(t,r){return Pe.between(1,2,arguments,e.name),r=Me(r,null),new X(Ie({get:Le(t)},{ts:Le(r)}))},KeyFromSecret:function e(t){return Pe.exact(1,arguments,e.name),new X({key_from_secret:Le(t)})},Reduce:function e(t,r,n){return Pe.exact(3,arguments,e.name),new X({reduce:Le(t),initial:Le(r),collection:Le(n)})},Paginate:function e(t,r){return Pe.between(1,2,arguments,e.name),r=Me(r,{}),new X(Oe({paginate:Le(t)},ke(r)))},Exists:function e(t,r){return Pe.between(1,2,arguments,e.name),r=Me(r,null),new X(Ie({exists:Le(t)},{ts:Le(r)}))},Create:function e(t,r){return Pe.between(1,2,arguments,e.name),new X({create:Le(t),params:Le(r)})},Update:function e(t,r){return Pe.exact(2,arguments,e.name),new X({update:Le(t),params:Le(r)})},Replace:function e(t,r){return Pe.exact(2,arguments,e.name),new X({replace:Le(t),params:Le(r)})},Delete:function e(t){return Pe.exact(1,arguments,e.name),new X({delete:Le(t)})},Insert:function e(t,r,n,i){return Pe.exact(4,arguments,e.name),new X({insert:Le(t),ts:Le(r),action:Le(n),params:Le(i)})},Remove:function e(t,r,n){return Pe.exact(3,arguments,e.name),new X({remove:Le(t),ts:Le(r),action:Le(n)})},CreateClass:Q(function e(t){return Pe.exact(1,arguments,e.name),new X({create_class:Le(t)})},"CreateClass() is deprecated, use CreateCollection() instead"),CreateCollection:function e(t){return Pe.exact(1,arguments,e.name),new X({create_collection:Le(t)})},CreateDatabase:function e(t){return Pe.exact(1,arguments,e.name),new X({create_database:Le(t)})},CreateIndex:function e(t){return Pe.exact(1,arguments,e.name),new X({create_index:Le(t)})},CreateKey:function e(t){return Pe.exact(1,arguments,e.name),new X({create_key:Le(t)})},CreateFunction:function e(t){return Pe.exact(1,arguments,e.name),new X({create_function:Le(t)})},CreateRole:function e(t){return Pe.exact(1,arguments,e.name),new X({create_role:Le(t)})},Singleton:function e(t){return Pe.exact(1,arguments,e.name),new X({singleton:Le(t)})},Events:function e(t){return Pe.exact(1,arguments,e.name),new X({events:Le(t)})},Match:function e(t){Pe.min(1,arguments,e.name);var r=Ne(arguments);return r.shift(),new X({match:Le(t),terms:Le(je(r))})},Union:function e(){return Pe.min(1,arguments,e.name),new X({union:Le(je(arguments))})},Merge:function e(t,r,n){return Pe.between(2,3,arguments,e.name),new X(Ie({merge:Le(t),with:Le(r)},{lambda:Le(n)}))},Intersection:function e(){return Pe.min(1,arguments,e.name),new X({intersection:Le(je(arguments))})},Difference:function e(){return Pe.min(1,arguments,e.name),new X({difference:Le(je(arguments))})},Distinct:function e(t){return Pe.exact(1,arguments,e.name),new X({distinct:Le(t)})},Join:function e(t,r){return Pe.exact(2,arguments,e.name),new X({join:Le(t),with:Le(r)})},Range:function e(t,r,n){return Pe.exact(3,arguments,e.name),new X({range:Le(t),from:Le(r),to:Le(n)})},Login:function e(t,r){return Pe.exact(2,arguments,e.name),new X({login:Le(t),params:Le(r)})},Logout:function e(t){return Pe.exact(1,arguments,e.name),new X({logout:Le(t)})},Identify:function e(t,r){return Pe.exact(2,arguments,e.name),new X({identify:Le(t),password:Le(r)})},Identity:function e(){return Pe.exact(0,arguments,e.name),new X({identity:null})},HasIdentity:function e(){return Pe.exact(0,arguments,e.name),new X({has_identity:null})},Concat:function e(t,r){return Pe.min(1,arguments,e.name),r=Me(r,null),new X(Ie({concat:Le(t)},{separator:Le(r)}))},Casefold:function e(t,r){return Pe.min(1,arguments,e.name),new X(Ie({casefold:Le(t)},{normalizer:Le(r)}))},ContainsStr:function e(t,r){return Pe.exact(2,arguments,e.name),new X({containsstr:Le(t),search:Le(r)})},ContainsStrRegex:function e(t,r){return Pe.exact(2,arguments,e.name),new X({containsstrregex:Le(t),pattern:Le(r)})},StartsWith:function e(t,r){return Pe.exact(2,arguments,e.name),new X({startswith:Le(t),search:Le(r)})},EndsWith:function e(t,r){return Pe.exact(2,arguments,e.name),new X({endswith:Le(t),search:Le(r)})},FindStr:function e(t,r,n){return Pe.between(2,3,arguments,e.name),n=Me(n,null),new X(Ie({findstr:Le(t),find:Le(r)},{start:Le(n)}))},FindStrRegex:function e(t,r,n,i){return Pe.between(2,4,arguments,e.name),n=Me(n,null),new X(Ie({findstrregex:Le(t),pattern:Le(r)},{start:Le(n),num_results:Le(i)}))},Length:function e(t){return Pe.exact(1,arguments,e.name),new X({length:Le(t)})},LowerCase:function e(t){return Pe.exact(1,arguments,e.name),new X({lowercase:Le(t)})},LTrim:function e(t){return Pe.exact(1,arguments,e.name),new X({ltrim:Le(t)})},NGram:function e(t,r,n){return Pe.between(1,3,arguments,e.name),r=Me(r,null),n=Me(n,null),new X(Ie({ngram:Le(t)},{min:Le(r),max:Le(n)}))},Repeat:function e(t,r){return Pe.between(1,2,arguments,e.name),r=Me(r,null),new X(Ie({repeat:Le(t)},{number:Le(r)}))},ReplaceStr:function e(t,r,n){return Pe.exact(3,arguments,e.name),new X({replacestr:Le(t),find:Le(r),replace:Le(n)})},ReplaceStrRegex:function e(t,r,n,i){return Pe.between(3,4,arguments,e.name),i=Me(i,null),new X(Ie({replacestrregex:Le(t),pattern:Le(r),replace:Le(n)},{first:Le(i)}))},RegexEscape:function e(t){return Pe.exact(1,arguments,e.name),new X({regexescape:Le(t)})},RTrim:function e(t){return Pe.exact(1,arguments,e.name),new X({rtrim:Le(t)})},Space:function e(t){return Pe.exact(1,arguments,e.name),new X({space:Le(t)})},SubString:function e(t,r,n){return Pe.between(1,3,arguments,e.name),r=Me(r,null),n=Me(n,null),new X(Ie({substring:Le(t)},{start:Le(r),length:Le(n)}))},TitleCase:function e(t){return Pe.exact(1,arguments,e.name),new X({titlecase:Le(t)})},Trim:function e(t){return Pe.exact(1,arguments,e.name),new X({trim:Le(t)})},UpperCase:function e(t){return Pe.exact(1,arguments,e.name),new X({uppercase:Le(t)})},Format:function e(t){Pe.min(1,arguments,e.name);var r=Ne(arguments);return r.shift(),new X({format:Le(t),values:Le(je(r))})},Time:function e(t){return Pe.exact(1,arguments,e.name),new X({time:Le(t)})},TimeAdd:function e(t,r,n){return Pe.exact(3,arguments,e.name),new X({time_add:Le(t),offset:Le(r),unit:Le(n)})},TimeSubtract:function e(t,r,n){return Pe.exact(3,arguments,e.name),new X({time_subtract:Le(t),offset:Le(r),unit:Le(n)})},TimeDiff:function e(t,r,n){return Pe.exact(3,arguments,e.name),new X({time_diff:Le(t),other:Le(r),unit:Le(n)})},Epoch:function e(t,r){return Pe.exact(2,arguments,e.name),new X({epoch:Le(t),unit:Le(r)})},Date:function e(t){return Pe.exact(1,arguments,e.name),new X({date:Le(t)})},Now:function e(){return Pe.exact(0,arguments,e.name),new X({now:Le(null)})},NextId:Q(function e(){return Pe.exact(0,arguments,e.name),new X({next_id:null})},"NextId() is deprecated, use NewId() instead"),NewId:function e(){return Pe.exact(0,arguments,e.name),new X({new_id:null})},Database:function e(t,r){switch(Pe.between(1,2,arguments,e.name),arguments.length){case 1:return new X({database:Le(t)});case 2:return new X({database:Le(t),scope:Le(r)})}},Index:function e(t,r){switch(Pe.between(1,2,arguments,e.name),arguments.length){case 1:return new X({index:Le(t)});case 2:return new X({index:Le(t),scope:Le(r)})}},Class:Q(function e(t,r){switch(Pe.between(1,2,arguments,e.name),arguments.length){case 1:return new X({class:Le(t)});case 2:return new X({class:Le(t),scope:Le(r)})}},"Class() is deprecated, use Collection() instead"),Collection:function e(t,r){switch(Pe.between(1,2,arguments,e.name),arguments.length){case 1:return new X({collection:Le(t)});case 2:return new X({collection:Le(t),scope:Le(r)})}},Function:function e(t,r){switch(Pe.between(1,2,arguments,e.name),arguments.length){case 1:return new X({function:Le(t)});case 2:return new X({function:Le(t),scope:Le(r)})}},Role:function e(t,r){return Pe.between(1,2,arguments,e.name),r=Me(r,null),new X(Ie({role:Le(t)},{scope:Le(r)}))},Classes:Q(function e(t){return Pe.max(1,arguments,e.name),t=Me(t,null),new X({classes:Le(t)})},"Classes() is deprecated, use Collections() instead"),Collections:function e(t){return Pe.max(1,arguments,e.name),t=Me(t,null),new X({collections:Le(t)})},Databases:function e(t){return Pe.max(1,arguments,e.name),t=Me(t,null),new X({databases:Le(t)})},Indexes:function e(t){return Pe.max(1,arguments,e.name),t=Me(t,null),new X({indexes:Le(t)})},Functions:function e(t){return Pe.max(1,arguments,e.name),t=Me(t,null),new X({functions:Le(t)})},Roles:function e(t){return Pe.max(1,arguments,e.name),t=Me(t,null),new X({roles:Le(t)})},Keys:function e(t){return Pe.max(1,arguments,e.name),t=Me(t,null),new X({keys:Le(t)})},Tokens:function e(t){return Pe.max(1,arguments,e.name),t=Me(t,null),new X({tokens:Le(t)})},Credentials:function e(t){return Pe.max(1,arguments,e.name),t=Me(t,null),new X({credentials:Le(t)})},Equals:function e(){return Pe.min(1,arguments,e.name),new X({equals:Le(je(arguments))})},Contains:function e(t,r){return Pe.exact(2,arguments,e.name),new X({contains:Le(t),in:Le(r)})},Select:function e(t,r,n){Pe.between(2,3,arguments,e.name);var i={select:Le(t),from:Le(r)};return void 0!==n&&(i.default=Le(n)),new X(i)},SelectAll:Q(function e(t,r){return Pe.exact(2,arguments,e.name),new X({select_all:Le(t),from:Le(r)})},"SelectAll() is deprecated. Avoid use."),Abs:function e(t){return Pe.exact(1,arguments,e.name),new X({abs:Le(t)})},Add:function e(){return Pe.min(1,arguments,e.name),new X({add:Le(je(arguments))})},BitAnd:function e(){return Pe.min(1,arguments,e.name),new X({bitand:Le(je(arguments))})},BitNot:function e(t){return Pe.exact(1,arguments,e.name),new X({bitnot:Le(t)})},BitOr:function e(){return Pe.min(1,arguments,e.name),new X({bitor:Le(je(arguments))})},BitXor:function e(){return Pe.min(1,arguments,e.name),new X({bitxor:Le(je(arguments))})},Ceil:function e(t){return Pe.exact(1,arguments,e.name),new X({ceil:Le(t)})},Divide:function e(){return Pe.min(1,arguments,e.name),new X({divide:Le(je(arguments))})},Floor:function e(t){return Pe.exact(1,arguments,e.name),new X({floor:Le(t)})},Max:function e(){return Pe.min(1,arguments,e.name),new X({max:Le(je(arguments))})},Min:function e(){return Pe.min(1,arguments,e.name),new X({min:Le(je(arguments))})},Modulo:function e(){return Pe.min(1,arguments,e.name),new X({modulo:Le(je(arguments))})},Multiply:function e(){return Pe.min(1,arguments,e.name),new X({multiply:Le(je(arguments))})},Round:function e(t,r){return Pe.min(1,arguments,e.name),r=Me(r,null),new X(Ie({round:Le(t)},{precision:Le(r)}))},Subtract:function e(){return Pe.min(1,arguments,e.name),new X({subtract:Le(je(arguments))})},Sign:function e(t){return Pe.exact(1,arguments,e.name),new X({sign:Le(t)})},Sqrt:function e(t){return Pe.exact(1,arguments,e.name),new X({sqrt:Le(t)})},Trunc:function e(t,r){return Pe.min(1,arguments,e.name),r=Me(r,null),new X(Ie({trunc:Le(t)},{precision:Le(r)}))},Count:function e(t){return Pe.exact(1,arguments,e.name),new X({count:Le(t)})},Sum:function e(t){return Pe.exact(1,arguments,e.name),new X({sum:Le(t)})},Mean:function e(t){return Pe.exact(1,arguments,e.name),new X({mean:Le(t)})},Any:function e(t){return Pe.exact(1,arguments,e.name),new X({any:Le(t)})},All:function e(t){return Pe.exact(1,arguments,e.name),new X({all:Le(t)})},Acos:function e(t){return Pe.exact(1,arguments,e.name),new X({acos:Le(t)})},Asin:function e(t){return Pe.exact(1,arguments,e.name),new X({asin:Le(t)})},Atan:function e(t){return Pe.exact(1,arguments,e.name),new X({atan:Le(t)})},Cos:function e(t){return Pe.exact(1,arguments,e.name),new X({cos:Le(t)})},Cosh:function e(t){return Pe.exact(1,arguments,e.name),new X({cosh:Le(t)})},Degrees:function e(t){return Pe.exact(1,arguments,e.name),new X({degrees:Le(t)})},Exp:function e(t){return Pe.exact(1,arguments,e.name),new X({exp:Le(t)})},Hypot:function e(t,r){return Pe.min(1,arguments,e.name),r=Me(r,null),new X(Ie({hypot:Le(t)},{b:Le(r)}))},Ln:function e(t){return Pe.exact(1,arguments,e.name),new X({ln:Le(t)})},Log:function e(t){return Pe.exact(1,arguments,e.name),new X({log:Le(t)})},Pow:function e(t,r){return Pe.min(1,arguments,e.name),r=Me(r,null),new X(Ie({pow:Le(t)},{exp:Le(r)}))},Radians:function e(t){return Pe.exact(1,arguments,e.name),new X({radians:Le(t)})},Sin:function e(t){return Pe.exact(1,arguments,e.name),new X({sin:Le(t)})},Sinh:function e(t){return Pe.exact(1,arguments,e.name),new X({sinh:Le(t)})},Tan:function e(t){return Pe.exact(1,arguments,e.name),new X({tan:Le(t)})},Tanh:function e(t){return Pe.exact(1,arguments,e.name),new X({tanh:Le(t)})},LT:function e(){return Pe.min(1,arguments,e.name),new X({lt:Le(je(arguments))})},LTE:function e(){return Pe.min(1,arguments,e.name),new X({lte:Le(je(arguments))})},GT:function e(){return Pe.min(1,arguments,e.name),new X({gt:Le(je(arguments))})},GTE:function e(){return Pe.min(1,arguments,e.name),new X({gte:Le(je(arguments))})},And:function e(){return Pe.min(1,arguments,e.name),new X({and:Le(je(arguments))})},Or:function e(){return Pe.min(1,arguments,e.name),new X({or:Le(je(arguments))})},Not:function e(t){return Pe.exact(1,arguments,e.name),new X({not:Le(t)})},ToString:function e(t){return Pe.exact(1,arguments,e.name),new X({to_string:Le(t)})},ToNumber:function e(t){return Pe.exact(1,arguments,e.name),new X({to_number:Le(t)})},ToObject:function e(t){return Pe.exact(1,arguments,e.name),new X({to_object:Le(t)})},ToArray:function e(t){return Pe.exact(1,arguments,e.name),new X({to_array:Le(t)})},ToDouble:function e(t){return Pe.exact(1,arguments,e.name),new X({to_double:Le(t)})},ToInteger:function e(t){return Pe.exact(1,arguments,e.name),new X({to_integer:Le(t)})},ToTime:function e(t){return Pe.exact(1,arguments,e.name),new X({to_time:Le(t)})},ToSeconds:function e(t){return Pe.exact(1,arguments,e.name),new X({to_seconds:Le(t)})},ToMicros:function e(t){return Pe.exact(1,arguments,e.name),new X({to_micros:Le(t)})},ToMillis:function e(t){return Pe.exact(1,arguments,e.name),new X({to_millis:Le(t)})},DayOfMonth:function e(t){return Pe.exact(1,arguments,e.name),new X({day_of_month:Le(t)})},DayOfWeek:function e(t){return Pe.exact(1,arguments,e.name),new X({day_of_week:Le(t)})},DayOfYear:function e(t){return Pe.exact(1,arguments,e.name),new X({day_of_year:Le(t)})},Second:function e(t){return Pe.exact(1,arguments,e.name),new X({second:Le(t)})},Minute:function e(t){return Pe.exact(1,arguments,e.name),new X({minute:Le(t)})},Hour:function e(t){return Pe.exact(1,arguments,e.name),new X({hour:Le(t)})},Month:function e(t){return Pe.exact(1,arguments,e.name),new X({month:Le(t)})},Year:function e(t){return Pe.exact(1,arguments,e.name),new X({year:Le(t)})},ToDate:function e(t){return Pe.exact(1,arguments,e.name),new X({to_date:Le(t)})},MoveDatabase:function e(t,r){return Pe.exact(2,arguments,e.name),new X({move_database:Le(t),to:Le(r)})},Documents:function e(t){return Pe.exact(1,arguments,e.name),new X({documents:Le(t)})},wrap:Le};var Fe={toJSON:function(e,t){return(t=void 0!==t&&t)?JSON.stringify(e,null,"  "):JSON.stringify(e)},parseJSON:function(e){return JSON.parse(e,De)}},Ue={};function Be(e,t,r,n,i,o,a,s,u,c,l){this.method=e,this.path=t,this.query=r,this.requestRaw=n,this.requestContent=i,this.responseRaw=o,this.responseContent=a,this.statusCode=s,this.responseHeaders=u,this.startTime=c,this.endTime=l}Object.defineProperty(Be.prototype,"timeTaken",{get:function(){return this.endTime-this.startTime}}),Ue=Be;var Ve={applyDefaults:function(e,t){var r={};for(var n in e){if(!(n in t))throw new Error("No such option "+n);r[n]=e[n]}for(var i in t)i in r||(r[i]=t[i]);return r},removeNullAndUndefinedValues:function(e){var t={};for(var r in e){var n=e[r];null!=n&&(t[r]=n)}return t},removeUndefinedValues:function(e){var t={};for(var r in e){var n=e[r];void 0!==n&&(t[r]=n)}return t}},ze={};function $e(e,t,r,n){void 0===r&&(r={}),void 0===n&&(n={}),this.reverse=!1,this.params={},this.before=void 0,this.after=void 0,Oe(this.params,r);var i=this.params.cursor||this.params;"before"in i?(this.before=i.before,delete i.before):"after"in i&&(this.after=i.after,delete i.after),this.options={},Oe(this.options,n),this.client=e,this.set=t,this._faunaFunctions=[]}$e.prototype.map=function(e){var t=this._clone();return t._faunaFunctions.push(function(t){return Se.Map(t,e)}),t},$e.prototype.filter=function(e){var t=this._clone();return t._faunaFunctions.push(function(t){return Se.Filter(t,e)}),t},$e.prototype.each=function(e){return this._retrieveNextPage(this.after,!1).then(this._consumePages(e,!1))},$e.prototype.eachReverse=function(e){return this._retrieveNextPage(this.before,!0).then(this._consumePages(e,!0))},$e.prototype.previousPage=function(){return this._retrieveNextPage(this.before,!0).then(this._adjustCursors.bind(this))},$e.prototype.nextPage=function(){return this._retrieveNextPage(this.after,!1).then(this._adjustCursors.bind(this))},$e.prototype._adjustCursors=function(e){return void 0!==e.after&&(this.after=e.after),void 0!==e.before&&(this.before=e.before),e.data},$e.prototype._consumePages=function(e,t){var r=this;return function(n){var i,o=[];return n.data.forEach(function(e){e.document&&(e.instance=e.document),e.value&&e.value.document&&(e.value.instance=e.value.document),o.push(e)}),e(o),void 0!==(i=t?n.before:n.after)?r._retrieveNextPage(i,t).then(r._consumePages(e,t)):Promise.resolve()}},$e.prototype._retrieveNextPage=function(e,t){var r={};Oe(r,this.params);var n=r.cursor||r;void 0!==e?t?n.before=e:n.after=e:t&&(n.before=null);var i=Se.Paginate(this.set,r);return this._faunaFunctions.length>0&&this._faunaFunctions.forEach(function(e){i=e(i)}),this.client.query(i,this.options)},$e.prototype._clone=function(){return Object.create($e.prototype,{client:{value:this.client},set:{value:this.set},_faunaFunctions:{value:this._faunaFunctions},before:{value:this.before},after:{value:this.after}})},ze=$e;var He=function(e,t){if(t=t.split(":")[0],!(e=+e))return!1;switch(t){case"http":case"ws":return 80!==e;case"https":case"wss":return 443!==e;case"ftp":return 21!==e;case"gopher":return 70!==e;case"file":return!1}return 0!==e},We={},Ge=Object.prototype.hasOwnProperty;function Je(e){try{return decodeURIComponent(e.replace(/\+/g," "))}catch(t){return null}}We.stringify=function(e,t){t=t||"";var r,n,i=[];for(n in"string"!=typeof t&&(t="?"),e)if(Ge.call(e,n)){if((r=e[n])||null!=r&&!isNaN(r)||(r=""),n=encodeURIComponent(n),r=encodeURIComponent(r),null===n||null===r)continue;i.push(n+"="+r)}return i.length?t+i.join("&"):""},We.parse=function(e){for(var t,r=/([^=?&]+)=?([^&]*)/g,n={};t=r.exec(e);){var i=Je(t[1]),o=Je(t[2]);null===i||null===o||i in n||(n[i]=o)}return n};var Qe={};(function(e){"use strict";var t=/^[A-Za-z][A-Za-z0-9+-.]*:\/\//,r=/^([a-z][a-z0-9.+-]*:)?(\/\/)?([\S\s]*)/i,n=new RegExp("^[\\x09\\x0A\\x0B\\x0C\\x0D\\x20\\xA0\\u1680\\u180E\\u2000\\u2001\\u2002\\u2003\\u2004\\u2005\\u2006\\u2007\\u2008\\u2009\\u200A\\u202F\\u205F\\u3000\\u2028\\u2029\\uFEFF]+");function i(e){return(e||"").toString().replace(n,"")}var o=[["#","hash"],["?","query"],function(e){return e.replace("\\","/")},["/","pathname"],["@","auth",1],[NaN,"host",void 0,1,1],[/:(\d+)$/,"port",void 0,1],[NaN,"hostname",void 0,1,1]],a={hash:1,query:1};function s(r){var n,i=("undefined"!=typeof window?window:void 0!==e?e:"undefined"!=typeof self?self:{}).location||{},o={},s=typeof(r=r||i);if("blob:"===r.protocol)o=new c(unescape(r.pathname),{});else if("string"===s)for(n in o=new c(r,{}),a)delete o[n];else if("object"===s){for(n in r)n in a||(o[n]=r[n]);void 0===o.slashes&&(o.slashes=t.test(r.href))}return o}function u(e){e=i(e);var t=r.exec(e);return{protocol:t[1]?t[1].toLowerCase():"",slashes:!!t[2],rest:t[3]}}function c(e,t,r){if(e=i(e),!(this instanceof c))return new c(e,t,r);var n,a,l,f,d,h,p=o.slice(),y=typeof t,m=this,b=0;for("object"!==y&&"string"!==y&&(r=t,t=null),r&&"function"!=typeof r&&(r=We.parse),t=s(t),n=!(a=u(e||"")).protocol&&!a.slashes,m.slashes=a.slashes||n&&t.slashes,m.protocol=a.protocol||t.protocol||"",e=a.rest,a.slashes||(p[3]=[/(.*)/,"pathname"]);b<p.length;b++)"function"!=typeof(f=p[b])?(l=f[0],h=f[1],l!=l?m[h]=e:"string"==typeof l?~(d=e.indexOf(l))&&("number"==typeof f[2]?(m[h]=e.slice(0,d),e=e.slice(d+f[2])):(m[h]=e.slice(d),e=e.slice(0,d))):(d=l.exec(e))&&(m[h]=d[1],e=e.slice(0,d.index)),m[h]=m[h]||n&&f[3]&&t[h]||"",f[4]&&(m[h]=m[h].toLowerCase())):e=f(e);r&&(m.query=r(m.query)),n&&t.slashes&&"/"!==m.pathname.charAt(0)&&(""!==m.pathname||""!==t.pathname)&&(m.pathname=function(e,t){if(""===e)return t;for(var r=(t||"/").split("/").slice(0,-1).concat(e.split("/")),n=r.length,i=r[n-1],o=!1,a=0;n--;)"."===r[n]?r.splice(n,1):".."===r[n]?(r.splice(n,1),a++):a&&(0===n&&(o=!0),r.splice(n,1),a--);return o&&r.unshift(""),"."!==i&&".."!==i||r.push(""),r.join("/")}(m.pathname,t.pathname)),He(m.port,m.protocol)||(m.host=m.hostname,m.port=""),m.username=m.password="",m.auth&&(f=m.auth.split(":"),m.username=f[0]||"",m.password=f[1]||""),m.origin=m.protocol&&m.host&&"file:"!==m.protocol?m.protocol+"//"+m.host:"null",m.href=m.toString()}c.prototype={set:function(e,t,r){var n=this;switch(e){case"query":"string"==typeof t&&t.length&&(t=(r||We.parse)(t)),n[e]=t;break;case"port":n[e]=t,He(t,n.protocol)?t&&(n.host=n.hostname+":"+t):(n.host=n.hostname,n[e]="");break;case"hostname":n[e]=t,n.port&&(t+=":"+n.port),n.host=t;break;case"host":n[e]=t,/:\d+$/.test(t)?(t=t.split(":"),n.port=t.pop(),n.hostname=t.join(":")):(n.hostname=t,n.port="");break;case"protocol":n.protocol=t.toLowerCase(),n.slashes=!r;break;case"pathname":case"hash":if(t){var i="pathname"===e?"/":"#";n[e]=t.charAt(0)!==i?i+t:t}else n[e]=t;break;default:n[e]=t}for(var a=0;a<o.length;a++){var s=o[a];s[4]&&(n[s[1]]=n[s[1]].toLowerCase())}return n.origin=n.protocol&&n.host&&"file:"!==n.protocol?n.protocol+"//"+n.host:"null",n.href=n.toString(),n},toString:function(e){e&&"function"==typeof e||(e=We.stringify);var t,r=this,n=r.protocol;n&&":"!==n.charAt(n.length-1)&&(n+=":");var i=n+(r.slashes?"//":"");return r.username&&(i+=r.username,r.password&&(i+=":"+r.password),i+="@"),i+=r.host+r.pathname,(t="object"==typeof r.query?e(r.query):r.query)&&(i+="?"!==t.charAt(0)?"?"+t:t),r.hash&&(i+=r.hash),i}},c.extractProtocol=u,c.location=s,c.trimLeft=i,c.qs=We,Qe=c}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{});var Xe={};(function(e){var t;function r(){if(void 0!==t)return t;if(e.XMLHttpRequest){t=new e.XMLHttpRequest;try{t.open("GET",e.XDomainRequest?"/":"https://example.com")}catch(r){t=null}}else t=null;return t}function n(e){var t=r();if(!t)return!1;try{return t.responseType=e,t.responseType===e}catch(n){}return!1}function i(e){return"function"==typeof e}Xe.fetch=i(e.fetch)&&i(e.ReadableStream),Xe.writableStream=i(e.WritableStream),Xe.abortController=i(e.AbortController),Xe.arraybuffer=Xe.fetch||n("arraybuffer"),Xe.msstream=!Xe.fetch&&n("ms-stream"),Xe.mozchunkedarraybuffer=!Xe.fetch&&n("moz-chunked-arraybuffer"),Xe.overrideMimeType=Xe.fetch||!!r()&&i(r().overrideMimeType),t=null}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{});var Ke={};Ke="function"==typeof Object.create?function(e,t){t&&(e.super_=t,e.prototype=Object.create(t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}))}:function(e,t){if(t){e.super_=t;var r=function(){};r.prototype=t.prototype,e.prototype=new r,e.prototype.constructor=e}};var Ye={},Ze=Object.create||function(e){var t=function(){};return t.prototype=e,new t},et=Object.keys||function(e){var t=[];for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&t.push(r);return r},tt=Function.prototype.bind||function(e){var t=this;return function(){return t.apply(e,arguments)}};function rt(){this._events&&Object.prototype.hasOwnProperty.call(this,"_events")||(this._events=Ze(null),this._eventsCount=0),this._maxListeners=this._maxListeners||void 0}Ye=rt,rt.EventEmitter=rt,rt.prototype._events=void 0,rt.prototype._maxListeners=void 0;var nt,it=10;try{var ot={};Object.defineProperty&&Object.defineProperty(ot,"x",{value:0}),nt=0===ot.x}catch(Bi){nt=!1}function at(e){return void 0===e._maxListeners?rt.defaultMaxListeners:e._maxListeners}function st(e,t,r,n){var i,o,a;if("function"!=typeof r)throw new TypeError('"listener" argument must be a function');if((o=e._events)?(o.newListener&&(e.emit("newListener",t,r.listener?r.listener:r),o=e._events),a=o[t]):(o=e._events=Ze(null),e._eventsCount=0),a){if("function"==typeof a?a=o[t]=n?[r,a]:[a,r]:n?a.unshift(r):a.push(r),!a.warned&&(i=at(e))&&i>0&&a.length>i){a.warned=!0;var s=new Error("Possible EventEmitter memory leak detected. "+a.length+' "'+String(t)+'" listeners added. Use emitter.setMaxListeners() to increase limit.');s.name="MaxListenersExceededWarning",s.emitter=e,s.type=t,s.count=a.length,"object"==typeof console&&console.warn&&console.warn("%s: %s",s.name,s.message)}}else a=o[t]=r,++e._eventsCount;return e}function ut(){if(!this.fired)switch(this.target.removeListener(this.type,this.wrapFn),this.fired=!0,arguments.length){case 0:return this.listener.call(this.target);case 1:return this.listener.call(this.target,arguments[0]);case 2:return this.listener.call(this.target,arguments[0],arguments[1]);case 3:return this.listener.call(this.target,arguments[0],arguments[1],arguments[2]);default:for(var e=new Array(arguments.length),t=0;t<e.length;++t)e[t]=arguments[t];this.listener.apply(this.target,e)}}function ct(e,t,r){var n={fired:!1,wrapFn:void 0,target:e,type:t,listener:r},i=tt.call(ut,n);return i.listener=r,n.wrapFn=i,i}function lt(e,t,r){var n=e._events;if(!n)return[];var i=n[t];return i?"function"==typeof i?r?[i.listener||i]:[i]:r?function(e){for(var t=new Array(e.length),r=0;r<t.length;++r)t[r]=e[r].listener||e[r];return t}(i):dt(i,i.length):[]}function ft(e){var t=this._events;if(t){var r=t[e];if("function"==typeof r)return 1;if(r)return r.length}return 0}function dt(e,t){for(var r=new Array(t),n=0;n<t;++n)r[n]=e[n];return r}nt?Object.defineProperty(rt,"defaultMaxListeners",{enumerable:!0,get:function(){return it},set:function(e){if("number"!=typeof e||e<0||e!=e)throw new TypeError('"defaultMaxListeners" must be a positive number');it=e}}):rt.defaultMaxListeners=it,rt.prototype.setMaxListeners=function(e){if("number"!=typeof e||e<0||isNaN(e))throw new TypeError('"n" argument must be a positive number');return this._maxListeners=e,this},rt.prototype.getMaxListeners=function(){return at(this)},rt.prototype.emit=function(e){var t,r,n,i,o,a,s="error"===e;if(a=this._events)s=s&&null==a.error;else if(!s)return!1;if(s){if(arguments.length>1&&(t=arguments[1]),t instanceof Error)throw t;var u=new Error('Unhandled "error" event. ('+t+")");throw u.context=t,u}if(!(r=a[e]))return!1;var c="function"==typeof r;switch(n=arguments.length){case 1:!function(e,t,r){if(t)e.call(r);else for(var n=e.length,i=dt(e,n),o=0;o<n;++o)i[o].call(r)}(r,c,this);break;case 2:!function(e,t,r,n){if(t)e.call(r,n);else for(var i=e.length,o=dt(e,i),a=0;a<i;++a)o[a].call(r,n)}(r,c,this,arguments[1]);break;case 3:!function(e,t,r,n,i){if(t)e.call(r,n,i);else for(var o=e.length,a=dt(e,o),s=0;s<o;++s)a[s].call(r,n,i)}(r,c,this,arguments[1],arguments[2]);break;case 4:!function(e,t,r,n,i,o){if(t)e.call(r,n,i,o);else for(var a=e.length,s=dt(e,a),u=0;u<a;++u)s[u].call(r,n,i,o)}(r,c,this,arguments[1],arguments[2],arguments[3]);break;default:for(i=new Array(n-1),o=1;o<n;o++)i[o-1]=arguments[o];!function(e,t,r,n){if(t)e.apply(r,n);else for(var i=e.length,o=dt(e,i),a=0;a<i;++a)o[a].apply(r,n)}(r,c,this,i)}return!0},rt.prototype.addListener=function(e,t){return st(this,e,t,!1)},rt.prototype.on=rt.prototype.addListener,rt.prototype.prependListener=function(e,t){return st(this,e,t,!0)},rt.prototype.once=function(e,t){if("function"!=typeof t)throw new TypeError('"listener" argument must be a function');return this.on(e,ct(this,e,t)),this},rt.prototype.prependOnceListener=function(e,t){if("function"!=typeof t)throw new TypeError('"listener" argument must be a function');return this.prependListener(e,ct(this,e,t)),this},rt.prototype.removeListener=function(e,t){var r,n,i,o,a;if("function"!=typeof t)throw new TypeError('"listener" argument must be a function');if(!(n=this._events))return this;if(!(r=n[e]))return this;if(r===t||r.listener===t)0==--this._eventsCount?this._events=Ze(null):(delete n[e],n.removeListener&&this.emit("removeListener",e,r.listener||t));else if("function"!=typeof r){for(i=-1,o=r.length-1;o>=0;o--)if(r[o]===t||r[o].listener===t){a=r[o].listener,i=o;break}if(i<0)return this;0===i?r.shift():function(e,t){for(var r=i,n=r+1,o=e.length;n<o;r+=1,n+=1)e[r]=e[n];e.pop()}(r),1===r.length&&(n[e]=r[0]),n.removeListener&&this.emit("removeListener",e,a||t)}return this},rt.prototype.removeAllListeners=function(e){var t,r,n;if(!(r=this._events))return this;if(!r.removeListener)return 0===arguments.length?(this._events=Ze(null),this._eventsCount=0):r[e]&&(0==--this._eventsCount?this._events=Ze(null):delete r[e]),this;if(0===arguments.length){var i,o=et(r);for(n=0;n<o.length;++n)"removeListener"!==(i=o[n])&&this.removeAllListeners(i);return this.removeAllListeners("removeListener"),this._events=Ze(null),this._eventsCount=0,this}if("function"==typeof(t=r[e]))this.removeListener(e,t);else if(t)for(n=t.length-1;n>=0;n--)this.removeListener(e,t[n]);return this},rt.prototype.listeners=function(e){return lt(this,e,!0)},rt.prototype.rawListeners=function(e){return lt(this,e,!1)},rt.listenerCount=function(e,t){return"function"==typeof e.listenerCount?e.listenerCount(t):ft.call(e,t)},rt.prototype.listenerCount=ft,rt.prototype.eventNames=function(){return this._eventsCount>0?Reflect.ownKeys(this._events):[]};var ht=Ye.EventEmitter,pt={read:function(e,t,r,n,i){var o,a,s=8*i-n-1,u=(1<<s)-1,c=u>>1,l=-7,f=r?i-1:0,d=r?-1:1,h=e[t+f];for(f+=d,o=h&(1<<-l)-1,h>>=-l,l+=s;l>0;o=256*o+e[t+f],f+=d,l-=8);for(a=o&(1<<-l)-1,o>>=-l,l+=n;l>0;a=256*a+e[t+f],f+=d,l-=8);if(0===o)o=1-c;else{if(o===u)return a?NaN:1/0*(h?-1:1);a+=Math.pow(2,n),o-=c}return(h?-1:1)*a*Math.pow(2,o-n)},write:function(e,t,r,n,i,o){var a,s,u,c=8*o-i-1,l=(1<<c)-1,f=l>>1,d=23===i?Math.pow(2,-24)-Math.pow(2,-77):0,h=n?0:o-1,p=n?1:-1,y=t<0||0===t&&1/t<0?1:0;for(t=Math.abs(t),isNaN(t)||t===1/0?(s=isNaN(t)?1:0,a=l):(a=Math.floor(Math.log(t)/Math.LN2),t*(u=Math.pow(2,-a))<1&&(a--,u*=2),(t+=a+f>=1?d/u:d*Math.pow(2,1-f))*u>=2&&(a++,u/=2),a+f>=l?(s=0,a=l):a+f>=1?(s=(t*u-1)*Math.pow(2,i),a+=f):(s=t*Math.pow(2,f-1)*Math.pow(2,i),a=0));i>=8;e[r+h]=255&s,h+=p,s/=256,i-=8);for(a=a<<i|s,c+=i;c>0;e[r+h]=255&a,h+=p,a/=256,c-=8);e[r+h-p]|=128*y}},yt={};function mt(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),r.push.apply(r,n)}return r}function bt(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function gt(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}var vt=y({}).Buffer,wt=yt.inspect,_t=wt&&wt.custom||"inspect",qt=function(){function e(){!function(t,r){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this),this.head=null,this.tail=null,this.length=0}var t,r;return t=e,(r=[{key:"push",value:function(e){var t={data:e,next:null};this.length>0?this.tail.next=t:this.head=t,this.tail=t,++this.length}},{key:"unshift",value:function(e){var t={data:e,next:this.head};0===this.length&&(this.tail=t),this.head=t,++this.length}},{key:"shift",value:function(){if(0!==this.length){var e=this.head.data;return 1===this.length?this.head=this.tail=null:this.head=this.head.next,--this.length,e}}},{key:"clear",value:function(){this.head=this.tail=null,this.length=0}},{key:"join",value:function(e){if(0===this.length)return"";for(var t=this.head,r=""+t.data;t=t.next;)r+=e+t.data;return r}},{key:"concat",value:function(e){if(0===this.length)return vt.alloc(0);for(var t,r,n,i=vt.allocUnsafe(e>>>0),o=this.head,a=0;o;)t=o.data,r=i,n=a,vt.prototype.copy.call(t,r,n),a+=o.data.length,o=o.next;return i}},{key:"consume",value:function(e,t){var r;return e<this.head.data.length?(r=this.head.data.slice(0,e),this.head.data=this.head.data.slice(e)):r=e===this.head.data.length?this.shift():t?this._getString(e):this._getBuffer(e),r}},{key:"first",value:function(){return this.head.data}},{key:"_getString",value:function(e){var t=this.head,r=1,n=t.data;for(e-=n.length;t=t.next;){var i=t.data,o=e>i.length?i.length:e;if(o===i.length?n+=i:n+=i.slice(0,e),0==(e-=o)){o===i.length?(++r,t.next?this.head=t.next:this.head=this.tail=null):(this.head=t,t.data=i.slice(o));break}++r}return this.length-=r,n}},{key:"_getBuffer",value:function(e){var t=vt.allocUnsafe(e),r=this.head,n=1;for(r.data.copy(t),e-=r.data.length;r=r.next;){var i=r.data,o=e>i.length?i.length:e;if(i.copy(t,t.length-e,0,o),0==(e-=o)){o===i.length?(++n,r.next?this.head=r.next:this.head=this.tail=null):(this.head=r,r.data=i.slice(o));break}++n}return this.length-=n,t}},{key:_t,value:function(e,t){return wt(this,function(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?mt(Object(r),!0).forEach(function(t){bt(e,t,r[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):mt(Object(r)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))})}return e}({},t,{depth:0,customInspect:!1}))}}])&&gt(t.prototype,r),e}(),xt={};(function(e){"use strict";function t(e,t){n(e,t),r(e)}function r(e){e._writableState&&!e._writableState.emitClose||e._readableState&&!e._readableState.emitClose||e.emit("close")}function n(e,t){e.emit("error",t)}xt={destroy:function(i,o){var a=this,s=this._readableState&&this._readableState.destroyed,u=this._writableState&&this._writableState.destroyed;return s||u?(o?o(i):i&&(this._writableState?this._writableState.errorEmitted||(this._writableState.errorEmitted=!0,e.nextTick(n,this,i)):e.nextTick(n,this,i)),this):(this._readableState&&(this._readableState.destroyed=!0),this._writableState&&(this._writableState.destroyed=!0),this._destroy(i||null,function(n){!o&&n?a._writableState?a._writableState.errorEmitted?e.nextTick(r,a):(a._writableState.errorEmitted=!0,e.nextTick(t,a,n)):e.nextTick(t,a,n):o?(e.nextTick(r,a),o(n)):e.nextTick(r,a)}),this)},undestroy:function(){this._readableState&&(this._readableState.destroyed=!1,this._readableState.reading=!1,this._readableState.ended=!1,this._readableState.endEmitted=!1),this._writableState&&(this._writableState.destroyed=!1,this._writableState.ended=!1,this._writableState.ending=!1,this._writableState.finalCalled=!1,this._writableState.prefinished=!1,this._writableState.finished=!1,this._writableState.errorEmitted=!1)},errorOrDestroy:function(e,t){var r=e._readableState,n=e._writableState;r&&r.autoDestroy||n&&n.autoDestroy?e.destroy(t):e.emit("error",t)}}}).call(this,g);var Et={},Ot={};function St(e,t,r){r||(r=Error);var n=function(e){var r,n;function i(r,n,i){return e.call(this,function(e,r,n){return"string"==typeof t?t:t(e,r,n)}(r,n,i))||this}return n=e,(r=i).prototype=Object.create(n.prototype),r.prototype.constructor=r,r.__proto__=n,i}(r);n.prototype.name=r.name,n.prototype.code=e,Ot[e]=n}function Ct(e,t){if(Array.isArray(e)){var r=e.length;return e=e.map(function(e){return String(e)}),r>2?"one of ".concat(t," ").concat(e.slice(0,r-1).join(", "),", or ")+e[r-1]:2===r?"one of ".concat(t," ").concat(e[0]," or ").concat(e[1]):"of ".concat(t," ").concat(e[0])}return"of ".concat(t," ").concat(String(e))}St("ERR_INVALID_OPT_VALUE",function(e,t){return'The value "'+t+'" is invalid for option "'+e+'"'},TypeError),St("ERR_INVALID_ARG_TYPE",function(e,t,r){var n,i,o,a;if("string"==typeof t&&("not ","not "===t.substr(0,"not ".length))?(n="must not be",t=t.replace(/^not /,"")):n="must be",o=e,(void 0===a||a>o.length)&&(a=o.length)," argument"===o.substring(a-" argument".length,a))i="The ".concat(e," ").concat(n," ").concat(Ct(t,"type"));else{var s=function(e,t,r){return"number"!=typeof r&&(r=0),!(r+".".length>e.length)&&-1!==e.indexOf(".",r)}(e)?"property":"argument";i='The "'.concat(e,'" ').concat(s," ").concat(n," ").concat(Ct(t,"type"))}return i+". Received type ".concat(typeof r)},TypeError),St("ERR_STREAM_PUSH_AFTER_EOF","stream.push() after EOF"),St("ERR_METHOD_NOT_IMPLEMENTED",function(e){return"The "+e+" method is not implemented"}),St("ERR_STREAM_PREMATURE_CLOSE","Premature close"),St("ERR_STREAM_DESTROYED",function(e){return"Cannot call "+e+" after a stream was destroyed"}),St("ERR_MULTIPLE_CALLBACK","Callback called multiple times"),St("ERR_STREAM_CANNOT_PIPE","Cannot pipe, not readable"),St("ERR_STREAM_WRITE_AFTER_END","write after end"),St("ERR_STREAM_NULL_VALUES","May not write null values to stream",TypeError),St("ERR_UNKNOWN_ENCODING",function(e){return"Unknown encoding: "+e},TypeError),St("ERR_STREAM_UNSHIFT_AFTER_END_EVENT","stream.unshift() after end event"),Et.codes=Ot;var Rt=Et.codes.ERR_INVALID_OPT_VALUE,At={getHighWaterMark:function(e,t,r,n){var i=function(e,t,r){return null!=e.highWaterMark?e.highWaterMark:t?e[r]:null}(t,n,r);if(null!=i){if(!isFinite(i)||Math.floor(i)!==i||i<0)throw new Rt(n?r:"highWaterMark",i);return Math.floor(i)}return e.objectMode?16:16384}},Tt={},Pt=y({}),It=Pt.Buffer;function jt(e,t){for(var r in e)t[r]=e[r]}function Nt(e,t,r){return It(e,t,r)}It.from&&It.alloc&&It.allocUnsafe&&It.allocUnsafeSlow?Tt=Pt:(jt(Pt,Tt),Tt.Buffer=Nt),Nt.prototype=Object.create(It.prototype),jt(It,Nt),Nt.from=function(e,t,r){if("number"==typeof e)throw new TypeError("Argument must not be a number");return It(e,t,r)},Nt.alloc=function(e,t,r){if("number"!=typeof e)throw new TypeError("Argument must be a number");var n=It(e);return void 0!==t?"string"==typeof r?n.fill(t,r):n.fill(t):n.fill(0),n},Nt.allocUnsafe=function(e){if("number"!=typeof e)throw new TypeError("Argument must be a number");return It(e)},Nt.allocUnsafeSlow=function(e){if("number"!=typeof e)throw new TypeError("Argument must be a number");return Pt.SlowBuffer(e)};var Mt=zt,Lt=Et.codes,kt=Lt.ERR_METHOD_NOT_IMPLEMENTED,Dt=Lt.ERR_MULTIPLE_CALLBACK,Ft=Lt.ERR_TRANSFORM_ALREADY_TRANSFORMING,Ut=Lt.ERR_TRANSFORM_WITH_LENGTH_0,Bt=h({});function Vt(e,t){var r=this._transformState;r.transforming=!1;var n=r.writecb;if(null===n)return this.emit("error",new Dt);r.writechunk=null,r.writecb=null,null!=t&&this.push(t),n(e);var i=this._readableState;i.reading=!1,(i.needReadable||i.length<i.highWaterMark)&&this._read(i.highWaterMark)}function zt(e){if(!(this instanceof zt))return new zt(e);Bt.call(this,e),this._transformState={afterTransform:Vt.bind(this),needTransform:!1,transforming:!1,writecb:null,writechunk:null,writeencoding:null},this._readableState.needReadable=!0,this._readableState.sync=!1,e&&("function"==typeof e.transform&&(this._transform=e.transform),"function"==typeof e.flush&&(this._flush=e.flush)),this.on("prefinish",$t)}function $t(){var e=this;"function"!=typeof this._flush||this._readableState.destroyed?Ht(this,null,null):this._flush(function(t,r){Ht(e,t,r)})}function Ht(e,t,r){if(t)return e.emit("error",t);if(null!=r&&e.push(r),e._writableState.length)throw new Ut;if(e._transformState.transforming)throw new Ft;return e.push(null)}Ke(zt,Bt),zt.prototype.push=function(e,t){return this._transformState.needTransform=!1,Bt.prototype.push.call(this,e,t)},zt.prototype._transform=function(e,t,r){r(new kt("_transform()"))},zt.prototype._write=function(e,t,r){var n=this._transformState;if(n.writecb=r,n.writechunk=e,n.writeencoding=t,!n.transforming){var i=this._readableState;(n.needTransform||i.needReadable||i.length<i.highWaterMark)&&this._read(i.highWaterMark)}},zt.prototype._read=function(e){var t=this._transformState;null===t.writechunk||t.transforming?t.needTransform=!0:(t.transforming=!0,this._transform(t.writechunk,t.writeencoding,t.afterTransform))},zt.prototype._destroy=function(e,t){Bt.prototype._destroy.call(this,e,function(e){t(e)})};var Wt,Gt=Jt;function Jt(e){if(!(this instanceof Jt))return new Jt(e);Mt.call(this,e)}Ke(Jt,Mt),Jt.prototype._transform=function(e,t,r){r(null,e)};var Qt=Et.codes,Xt=Qt.ERR_MISSING_ARGS,Kt=Qt.ERR_STREAM_DESTROYED;function Yt(e){if(e)throw e}function Zt(e){e()}function er(e,t){return e.pipe(t)}var tr={};(tr=tr=u({})).Stream=tr,tr.Readable=tr,tr.Writable=p({}),tr.Duplex=h({}),tr.Transform=Mt,tr.PassThrough=Gt,tr.finished=f({}),tr.pipeline=function(){for(var e=arguments.length,t=new Array(e),r=0;r<e;r++)t[r]=arguments[r];var n,i=function(e){return e.length?"function"!=typeof e[e.length-1]?Yt:e.pop():Yt}(t);if(Array.isArray(t[0])&&(t=t[0]),t.length<2)throw new Xt("streams");var o=t.map(function(e,r){var a=r<t.length-1;return function(e,t,r,n){n=function(e){var t=!1;return function(){t||(t=!0,e.apply(void 0,arguments))}}(n);var i=!1;e.on("close",function(){i=!0}),void 0===Wt&&(Wt=f({})),Wt(e,{readable:t,writable:r},function(e){if(e)return n(e);i=!0,n()});var o=!1;return function(t){if(!i&&!o)return o=!0,function(e){return e.setHeader&&"function"==typeof e.abort}(e)?e.abort():"function"==typeof e.destroy?e.destroy():void n(t||new Kt("pipe"))}}(e,a,r>0,function(e){n||(n=e),e&&o.forEach(Zt),a||(o.forEach(Zt),i(n))})});return t.reduce(er)};var rr={};(function(e,t,r){var n=rr.readyStates={UNSENT:0,OPENED:1,HEADERS_RECEIVED:2,LOADING:3,DONE:4},i=rr.IncomingMessage=function(n,i,o,a){var s=this;if(tr.Readable.call(s),s._mode=o,s.headers={},s.rawHeaders=[],s.trailers={},s.rawTrailers=[],s.on("end",function(){e.nextTick(function(){s.emit("close")})}),"fetch"===o){if(s._fetchResponse=i,s.url=i.url,s.statusCode=i.status,s.statusMessage=i.statusText,i.headers.forEach(function(e,t){s.headers[t.toLowerCase()]=e,s.rawHeaders.push(t,e)}),Xe.writableStream){var u=new WritableStream({write:function(e){return new Promise(function(t,n){s._destroyed?n():s.push(r.from(e))?t():s._resumeFetch=t})},close:function(){t.clearTimeout(a),s._destroyed||s.push(null)},abort:function(e){s._destroyed||s.emit("error",e)}});try{return void i.body.pipeTo(u).catch(function(e){t.clearTimeout(a),s._destroyed||s.emit("error",e)})}catch(d){}}var c=i.body.getReader();!function e(){c.read().then(function(n){if(!s._destroyed){if(n.done)return t.clearTimeout(a),void s.push(null);s.push(r.from(n.value)),e()}}).catch(function(e){t.clearTimeout(a),s._destroyed||s.emit("error",e)})}()}else if(s._xhr=n,s._pos=0,s.url=n.responseURL,s.statusCode=n.status,s.statusMessage=n.statusText,n.getAllResponseHeaders().split(/\r?\n/).forEach(function(e){var t=e.match(/^([^:]+):\s*(.*)/);if(t){var r=t[1].toLowerCase();"set-cookie"===r?(void 0===s.headers[r]&&(s.headers[r]=[]),s.headers[r].push(t[2])):void 0!==s.headers[r]?s.headers[r]+=", "+t[2]:s.headers[r]=t[2],s.rawHeaders.push(t[1],t[2])}}),s._charset="x-user-defined",!Xe.overrideMimeType){var l=s.rawHeaders["mime-type"];if(l){var f=l.match(/;\s*charset=([^;])(;|$)/);f&&(s._charset=f[1].toLowerCase())}s._charset||(s._charset="utf-8")}};Ke(i,tr.Readable),i.prototype._read=function(){var e=this._resumeFetch;e&&(this._resumeFetch=null,e())},i.prototype._onXHRProgress=function(){var e=this,i=e._xhr,o=null;switch(e._mode){case"text":if((o=i.responseText).length>e._pos){var a=o.substr(e._pos);if("x-user-defined"===e._charset){for(var s=r.alloc(a.length),u=0;u<a.length;u++)s[u]=255&a.charCodeAt(u);e.push(s)}else e.push(a,e._charset);e._pos=o.length}break;case"arraybuffer":if(i.readyState!==n.DONE||!i.response)break;o=i.response,e.push(r.from(new Uint8Array(o)));break;case"moz-chunked-arraybuffer":if(o=i.response,i.readyState!==n.LOADING||!o)break;e.push(r.from(new Uint8Array(o)));break;case"ms-stream":if(o=i.response,i.readyState!==n.LOADING)break;var c=new t.MSStreamReader;c.onprogress=function(){c.result.byteLength>e._pos&&(e.push(r.from(new Uint8Array(c.result.slice(e._pos)))),e._pos=c.result.byteLength)},c.onload=function(){e.push(null)},c.readAsArrayBuffer(o)}e._xhr.readyState===n.DONE&&"ms-stream"!==e._mode&&e.push(null)}}).call(this,g,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{},y({}).Buffer);var nr={};(function(e,t,r){var n=rr.IncomingMessage,i=rr.readyStates,o=nr=function(e){var t,n=this;tr.Writable.call(n),n._opts=e,n._body=[],n._headers={},e.auth&&n.setHeader("Authorization","Basic "+r.from(e.auth).toString("base64")),Object.keys(e.headers).forEach(function(t){n.setHeader(t,e.headers[t])});var i=!0;if("disable-fetch"===e.mode||"requestTimeout"in e&&!Xe.abortController)i=!1,t=!0;else if("prefer-streaming"===e.mode)t=!1;else if("allow-wrong-content-type"===e.mode)t=!Xe.overrideMimeType;else{if(e.mode&&"default"!==e.mode&&"prefer-fast"!==e.mode)throw new Error("Invalid value for opts.mode");t=!0}n._mode=function(e,t){return Xe.fetch&&t?"fetch":Xe.mozchunkedarraybuffer?"moz-chunked-arraybuffer":Xe.msstream?"ms-stream":Xe.arraybuffer&&e?"arraybuffer":"text"}(t,i),n._fetchTimer=null,n.on("finish",function(){n._onFinish()})};Ke(o,tr.Writable),o.prototype.setHeader=function(e,t){var r=e.toLowerCase();-1===a.indexOf(r)&&(this._headers[r]={name:e,value:t})},o.prototype.getHeader=function(e){var t=this._headers[e.toLowerCase()];return t?t.value:null},o.prototype.removeHeader=function(e){delete this._headers[e.toLowerCase()]},o.prototype._onFinish=function(){var r=this;if(!r._destroyed){var n=r._opts,o=r._headers,a=null;"GET"!==n.method&&"HEAD"!==n.method&&(a=new Blob(r._body,{type:(o["content-type"]||{}).value||""}));var s=[];if(Object.keys(o).forEach(function(e){var t=o[e].name,r=o[e].value;Array.isArray(r)?r.forEach(function(e){s.push([t,e])}):s.push([t,r])}),"fetch"===r._mode){var u=null;if(Xe.abortController){var c=new AbortController;u=c.signal,r._fetchAbortController=c,"requestTimeout"in n&&0!==n.requestTimeout&&(r._fetchTimer=t.setTimeout(function(){r.emit("requestTimeout"),r._fetchAbortController&&r._fetchAbortController.abort()},n.requestTimeout))}t.fetch(r._opts.url,{method:r._opts.method,headers:s,body:a||void 0,mode:"cors",credentials:n.withCredentials?"include":"same-origin",signal:u}).then(function(e){r._fetchResponse=e,r._connect()},function(e){t.clearTimeout(r._fetchTimer),r._destroyed||r.emit("error",e)})}else{var l=r._xhr=new t.XMLHttpRequest;try{l.open(r._opts.method,r._opts.url,!0)}catch(Bi){return void e.nextTick(function(){r.emit("error",Bi)})}"responseType"in l&&(l.responseType=r._mode),"withCredentials"in l&&(l.withCredentials=!!n.withCredentials),"text"===r._mode&&"overrideMimeType"in l&&l.overrideMimeType("text/plain; charset=x-user-defined"),"requestTimeout"in n&&(l.timeout=n.requestTimeout,l.ontimeout=function(){r.emit("requestTimeout")}),s.forEach(function(e){l.setRequestHeader(e[0],e[1])}),r._response=null,l.onreadystatechange=function(){switch(l.readyState){case i.LOADING:case i.DONE:r._onXHRProgress()}},"moz-chunked-arraybuffer"===r._mode&&(l.onprogress=function(){r._onXHRProgress()}),l.onerror=function(){r._destroyed||r.emit("error",new Error("XHR error"))};try{l.send(a)}catch(Bi){return void e.nextTick(function(){r.emit("error",Bi)})}}}},o.prototype._onXHRProgress=function(){(function(e){try{var t=e.status;return null!==t&&0!==t}catch(r){return!1}})(this._xhr)&&!this._destroyed&&(this._response||this._connect(),this._response._onXHRProgress())},o.prototype._connect=function(){var e=this;e._destroyed||(e._response=new n(e._xhr,e._fetchResponse,e._mode,e._fetchTimer),e._response.on("error",function(t){e.emit("error",t)}),e.emit("response",e._response))},o.prototype._write=function(e,t,r){this._body.push(e),r()},o.prototype.abort=o.prototype.destroy=function(){this._destroyed=!0,t.clearTimeout(this._fetchTimer),this._response&&(this._response._destroyed=!0),this._xhr?this._xhr.abort():this._fetchAbortController&&this._fetchAbortController.abort()},o.prototype.end=function(e,t,r){"function"==typeof e&&(r=e,e=void 0),tr.Writable.prototype.end.call(this,e,t,r)},o.prototype.flushHeaders=function(){},o.prototype.setTimeout=function(){},o.prototype.setNoDelay=function(){},o.prototype.setSocketKeepAlive=function(){};var a=["accept-charset","accept-encoding","access-control-request-headers","access-control-request-method","connection","content-length","cookie","cookie2","date","dnt","expect","host","keep-alive","origin","referer","te","trailer","transfer-encoding","upgrade","via"]}).call(this,g,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{},y({}).Buffer);var ir=function(){for(var e={},t=0;t<arguments.length;t++){var r=arguments[t];for(var n in r)or.call(r,n)&&(e[n]=r[n])}return e},or=Object.prototype.hasOwnProperty,ar={100:"Continue",101:"Switching Protocols",102:"Processing",200:"OK",201:"Created",202:"Accepted",203:"Non-Authoritative Information",204:"No Content",205:"Reset Content",206:"Partial Content",207:"Multi-Status",208:"Already Reported",226:"IM Used",300:"Multiple Choices",301:"Moved Permanently",302:"Found",303:"See Other",304:"Not Modified",305:"Use Proxy",307:"Temporary Redirect",308:"Permanent Redirect",400:"Bad Request",401:"Unauthorized",402:"Payment Required",403:"Forbidden",404:"Not Found",405:"Method Not Allowed",406:"Not Acceptable",407:"Proxy Authentication Required",408:"Request Timeout",409:"Conflict",410:"Gone",411:"Length Required",412:"Precondition Failed",413:"Payload Too Large",414:"URI Too Long",415:"Unsupported Media Type",416:"Range Not Satisfiable",417:"Expectation Failed",418:"I'm a teapot",421:"Misdirected Request",422:"Unprocessable Entity",423:"Locked",424:"Failed Dependency",425:"Unordered Collection",426:"Upgrade Required",428:"Precondition Required",429:"Too Many Requests",431:"Request Header Fields Too Large",451:"Unavailable For Legal Reasons",500:"Internal Server Error",501:"Not Implemented",502:"Bad Gateway",503:"Service Unavailable",504:"Gateway Timeout",505:"HTTP Version Not Supported",506:"Variant Also Negotiates",507:"Insufficient Storage",508:"Loop Detected",509:"Bandwidth Limit Exceeded",510:"Not Extended",511:"Network Authentication Required"},sr={exports:{}};(function(e){!function(t){var r="object"==typeof sr.exports&&sr.exports&&!sr.exports.nodeType&&sr.exports,n=sr&&!sr.nodeType&&sr,i="object"==typeof e&&e;i.global!==i&&i.window!==i&&i.self!==i||(t=i);var o,a,s=2147483647,u=36,c=1,l=26,f=38,d=700,h=72,p=128,y="-",m=/^xn--/,b=/[^\x20-\x7E]/,g=/[\x2E\u3002\uFF0E\uFF61]/g,v={overflow:"Overflow: input needs wider integers to process","not-basic":"Illegal input >= 0x80 (not a basic code point)","invalid-input":"Invalid input"},w=u-c,_=Math.floor,q=String.fromCharCode;function x(e){throw new RangeError(v[e])}function E(e,t){for(var r=e.length,n=[];r--;)n[r]=t(e[r]);return n}function O(e,t){var r=e.split("@"),n="";return r.length>1&&(n=r[0]+"@",e=r[1]),n+E((e=e.replace(g,".")).split("."),t).join(".")}function S(e){for(var t,r,n=[],i=0,o=e.length;i<o;)(t=e.charCodeAt(i++))>=55296&&t<=56319&&i<o?56320==(64512&(r=e.charCodeAt(i++)))?n.push(((1023&t)<<10)+(1023&r)+65536):(n.push(t),i--):n.push(t);return n}function C(e){return E(e,function(e){var t="";return e>65535&&(t+=q((e-=65536)>>>10&1023|55296),e=56320|1023&e),t+q(e)}).join("")}function R(e,t){return e+22+75*(e<26)-((0!=t)<<5)}function A(e,t,r){var n=0;for(e=r?_(e/d):e>>1,e+=_(e/t);e>w*l>>1;n+=u)e=_(e/w);return _(n+(w+1)*e/(e+f))}function T(e){var t,r,n,i,o,a,f,d,m,b,g,v=[],w=e.length,q=0,E=p,O=h;for((r=e.lastIndexOf(y))<0&&(r=0),n=0;n<r;++n)e.charCodeAt(n)>=128&&x("not-basic"),v.push(e.charCodeAt(n));for(i=r>0?r+1:0;i<w;){for(o=q,a=1,f=u;i>=w&&x("invalid-input"),((d=(g=e.charCodeAt(i++))-48<10?g-22:g-65<26?g-65:g-97<26?g-97:u)>=u||d>_((s-q)/a))&&x("overflow"),q+=d*a,!(d<(m=f<=O?c:f>=O+l?l:f-O));f+=u)a>_(s/(b=u-m))&&x("overflow"),a*=b;O=A(q-o,t=v.length+1,0==o),_(q/t)>s-E&&x("overflow"),E+=_(q/t),q%=t,v.splice(q++,0,E)}return C(v)}function P(e){var t,r,n,i,o,a,f,d,m,b,g,v,w,E,O,C=[];for(v=(e=S(e)).length,t=p,r=0,o=h,a=0;a<v;++a)(g=e[a])<128&&C.push(q(g));for(n=i=C.length,i&&C.push(y);n<v;){for(f=s,a=0;a<v;++a)(g=e[a])>=t&&g<f&&(f=g);for(f-t>_((s-r)/(w=n+1))&&x("overflow"),r+=(f-t)*w,t=f,a=0;a<v;++a)if((g=e[a])<t&&++r>s&&x("overflow"),g==t){for(d=r,m=u;!(d<(b=m<=o?c:m>=o+l?l:m-o));m+=u)O=d-b,E=u-b,C.push(q(R(b+O%E,0))),d=_(O/E);C.push(q(R(d,0))),o=A(r,w,n==i),r=0,++n}++r,++t}return C.join("")}if(o={version:"1.4.1",ucs2:{decode:S,encode:C},decode:T,encode:P,toASCII:function(e){return O(e,function(e){return b.test(e)?"xn--"+P(e):e})},toUnicode:function(e){return O(e,function(e){return m.test(e)?T(e.slice(4).toLowerCase()):e})}},"function"==typeof define&&"object"==typeof define.amd&&define.amd)define("punycode",function(){return o});else if(r&&n)if(sr.exports==r)n.exports=o;else for(a in o)o.hasOwnProperty(a)&&(r[a]=o[a]);else t.punycode=o}(this)}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{}),sr=sr.exports;var ur={isString:function(e){return"string"==typeof e},isObject:function(e){return"object"==typeof e&&null!==e},isNull:function(e){return null===e},isNullOrUndefined:function(e){return null==e}};function cr(e,t){return Object.prototype.hasOwnProperty.call(e,t)}var lr=Array.isArray||function(e){return"[object Array]"===Object.prototype.toString.call(e)},fr=function(e){switch(typeof e){case"string":return e;case"boolean":return e?"true":"false";case"number":return isFinite(e)?e:"";default:return""}},dr=Array.isArray||function(e){return"[object Array]"===Object.prototype.toString.call(e)};function hr(e,t){if(e.map)return e.map(t);for(var r=[],n=0;n<e.length;n++)r.push(t(e[n],n));return r}var pr=Object.keys||function(e){var t=[];for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&t.push(r);return t},yr={parse:function(e,t,r,n){t=t||"&",r=r||"=";var i={};if("string"!=typeof e||0===e.length)return i;var o=/\+/g;e=e.split(t);var a=1e3;n&&"number"==typeof n.maxKeys&&(a=n.maxKeys);var s=e.length;a>0&&s>a&&(s=a);for(var u=0;u<s;++u){var c,l,f,d,h=e[u].replace(o,"%20"),p=h.indexOf(r);p>=0?(c=h.substr(0,p),l=h.substr(p+1)):(c=h,l=""),f=decodeURIComponent(c),d=decodeURIComponent(l),cr(i,f)?lr(i[f])?i[f].push(d):i[f]=[i[f],d]:i[f]=d}return i},stringify:function(e,t,r,n){return t=t||"&",r=r||"=",null===e&&(e=void 0),"object"==typeof e?hr(pr(e),function(n){var i=encodeURIComponent(fr(n))+r;return dr(e[n])?hr(e[n],function(e){return i+encodeURIComponent(fr(e))}).join(t):i+encodeURIComponent(fr(e[n]))}).join(t):n?encodeURIComponent(fr(n))+r+encodeURIComponent(fr(e)):""}},mr={};function br(){this.protocol=null,this.slashes=null,this.auth=null,this.host=null,this.port=null,this.hostname=null,this.hash=null,this.search=null,this.query=null,this.pathname=null,this.path=null,this.href=null}mr.parse=Tr;var gr=/^([a-z0-9.+-]+:)/i,vr=/:[0-9]*$/,wr=/^(\/\/?(?!\/)[^\?\s]*)(\?[^\s]*)?$/,_r=["{","}","|","\\","^","`"].concat(["<",">",'"',"`"," ","\r","\n","\t"]),qr=["'"].concat(_r),xr=["%","/","?",";","#"].concat(qr),Er=["/","?","#"],Or=/^[+a-z0-9A-Z_-]{0,63}$/,Sr=/^([+a-z0-9A-Z_-]{0,63})(.*)$/,Cr={javascript:!0,"javascript:":!0},Rr={javascript:!0,"javascript:":!0},Ar={http:!0,https:!0,ftp:!0,gopher:!0,file:!0,"http:":!0,"https:":!0,"ftp:":!0,"gopher:":!0,"file:":!0};function Tr(e,t,r){if(e&&ur.isObject(e)&&e instanceof br)return e;var n=new br;return n.parse(e,t,r),n}br.prototype.parse=function(e,t,r){if(!ur.isString(e))throw new TypeError("Parameter 'url' must be a string, not "+typeof e);var n=e.indexOf("?"),i=-1!==n&&n<e.indexOf("#")?"?":"#",o=e.split(i);o[0]=o[0].replace(/\\/g,"/");var a=e=o.join(i);if(a=a.trim(),!r&&1===e.split("#").length){var s=wr.exec(a);if(s)return this.path=a,this.href=a,this.pathname=s[1],s[2]?(this.search=s[2],this.query=t?yr.parse(this.search.substr(1)):this.search.substr(1)):t&&(this.search="",this.query={}),this}var u=gr.exec(a);if(u){var c=(u=u[0]).toLowerCase();this.protocol=c,a=a.substr(u.length)}if(r||u||a.match(/^\/\/[^@\/]+@[^@\/]+/)){var l="//"===a.substr(0,2);!l||u&&Rr[u]||(a=a.substr(2),this.slashes=!0)}if(!Rr[u]&&(l||u&&!Ar[u])){for(var f,d,h=-1,p=0;p<Er.length;p++)-1!==(y=a.indexOf(Er[p]))&&(-1===h||y<h)&&(h=y);for(-1!==(d=-1===h?a.lastIndexOf("@"):a.lastIndexOf("@",h))&&(f=a.slice(0,d),a=a.slice(d+1),this.auth=decodeURIComponent(f)),h=-1,p=0;p<xr.length;p++){var y;-1!==(y=a.indexOf(xr[p]))&&(-1===h||y<h)&&(h=y)}-1===h&&(h=a.length),this.host=a.slice(0,h),a=a.slice(h),this.parseHost(),this.hostname=this.hostname||"";var m="["===this.hostname[0]&&"]"===this.hostname[this.hostname.length-1];if(!m)for(var b=this.hostname.split(/\./),g=(p=0,b.length);p<g;p++){var v=b[p];if(v&&!v.match(Or)){for(var w="",_=0,q=v.length;_<q;_++)v.charCodeAt(_)>127?w+="x":w+=v[_];if(!w.match(Or)){var x=b.slice(0,p),E=b.slice(p+1),O=v.match(Sr);O&&(x.push(O[1]),E.unshift(O[2])),E.length&&(a="/"+E.join(".")+a),this.hostname=x.join(".");break}}}this.hostname.length>255?this.hostname="":this.hostname=this.hostname.toLowerCase(),m||(this.hostname=sr.toASCII(this.hostname));var S=this.port?":"+this.port:"",C=this.hostname||"";this.host=C+S,this.href+=this.host,m&&(this.hostname=this.hostname.substr(1,this.hostname.length-2),"/"!==a[0]&&(a="/"+a))}if(!Cr[c])for(p=0,g=qr.length;p<g;p++){var R=qr[p];if(-1!==a.indexOf(R)){var A=encodeURIComponent(R);A===R&&(A=escape(R)),a=a.split(R).join(A)}}var T=a.indexOf("#");-1!==T&&(this.hash=a.substr(T),a=a.slice(0,T));var P=a.indexOf("?");if(-1!==P?(this.search=a.substr(P),this.query=a.substr(P+1),t&&(this.query=yr.parse(this.query)),a=a.slice(0,P)):t&&(this.search="",this.query={}),a&&(this.pathname=a),Ar[c]&&this.hostname&&!this.pathname&&(this.pathname="/"),this.pathname||this.search){S=this.pathname||"";var I=this.search||"";this.path=S+I}return this.href=this.format(),this},br.prototype.format=function(){var e=this.auth||"";e&&(e=(e=encodeURIComponent(e)).replace(/%3A/i,":"),e+="@");var t=this.protocol||"",r=this.pathname||"",n=this.hash||"",i=!1,o="";this.host?i=e+this.host:this.hostname&&(i=e+(-1===this.hostname.indexOf(":")?this.hostname:"["+this.hostname+"]"),this.port&&(i+=":"+this.port)),this.query&&ur.isObject(this.query)&&Object.keys(this.query).length&&(o=yr.stringify(this.query));var a=this.search||o&&"?"+o||"";return t&&":"!==t.substr(-1)&&(t+=":"),this.slashes||(!t||Ar[t])&&!1!==i?(i="//"+(i||""),r&&"/"!==r.charAt(0)&&(r="/"+r)):i||(i=""),n&&"#"!==n.charAt(0)&&(n="#"+n),a&&"?"!==a.charAt(0)&&(a="?"+a),t+i+(r=r.replace(/[?#]/g,function(e){return encodeURIComponent(e)}))+(a=a.replace("#","%23"))+n},br.prototype.resolve=function(e){return this.resolveObject(Tr(e,!1,!0)).format()},br.prototype.resolveObject=function(e){if(ur.isString(e)){var t=new br;t.parse(e,!1,!0),e=t}for(var r=new br,n=Object.keys(this),i=0;i<n.length;i++){var o=n[i];r[o]=this[o]}if(r.hash=e.hash,""===e.href)return r.href=r.format(),r;if(e.slashes&&!e.protocol){for(var a=Object.keys(e),s=0;s<a.length;s++){var u=a[s];"protocol"!==u&&(r[u]=e[u])}return Ar[r.protocol]&&r.hostname&&!r.pathname&&(r.path=r.pathname="/"),r.href=r.format(),r}if(e.protocol&&e.protocol!==r.protocol){if(!Ar[e.protocol]){for(var c=Object.keys(e),l=0;l<c.length;l++){var f=c[l];r[f]=e[f]}return r.href=r.format(),r}if(r.protocol=e.protocol,e.host||Rr[e.protocol])r.pathname=e.pathname;else{for(var d=(e.pathname||"").split("/");d.length&&!(e.host=d.shift()););e.host||(e.host=""),e.hostname||(e.hostname=""),""!==d[0]&&d.unshift(""),d.length<2&&d.unshift(""),r.pathname=d.join("/")}if(r.search=e.search,r.query=e.query,r.host=e.host||"",r.auth=e.auth,r.hostname=e.hostname||e.host,r.port=e.port,r.pathname||r.search){var h=r.pathname||"",p=r.search||"";r.path=h+p}return r.slashes=r.slashes||e.slashes,r.href=r.format(),r}var y=r.pathname&&"/"===r.pathname.charAt(0),m=e.host||e.pathname&&"/"===e.pathname.charAt(0),b=m||y||r.host&&e.pathname,g=b,v=r.pathname&&r.pathname.split("/")||[],w=(d=e.pathname&&e.pathname.split("/")||[],r.protocol&&!Ar[r.protocol]);if(w&&(r.hostname="",r.port=null,r.host&&(""===v[0]?v[0]=r.host:v.unshift(r.host)),r.host="",e.protocol&&(e.hostname=null,e.port=null,e.host&&(""===d[0]?d[0]=e.host:d.unshift(e.host)),e.host=null),b=b&&(""===d[0]||""===v[0])),m)r.host=e.host||""===e.host?e.host:r.host,r.hostname=e.hostname||""===e.hostname?e.hostname:r.hostname,r.search=e.search,r.query=e.query,v=d;else if(d.length)v||(v=[]),v.pop(),v=v.concat(d),r.search=e.search,r.query=e.query;else if(!ur.isNullOrUndefined(e.search))return w&&(r.hostname=r.host=v.shift(),(O=!!(r.host&&r.host.indexOf("@")>0)&&r.host.split("@"))&&(r.auth=O.shift(),r.host=r.hostname=O.shift())),r.search=e.search,r.query=e.query,ur.isNull(r.pathname)&&ur.isNull(r.search)||(r.path=(r.pathname?r.pathname:"")+(r.search?r.search:"")),r.href=r.format(),r;if(!v.length)return r.pathname=null,r.search?r.path="/"+r.search:r.path=null,r.href=r.format(),r;for(var _=v.slice(-1)[0],q=(r.host||e.host||v.length>1)&&("."===_||".."===_)||""===_,x=0,E=v.length;E>=0;E--)"."===(_=v[E])?v.splice(E,1):".."===_?(v.splice(E,1),x++):x&&(v.splice(E,1),x--);if(!b&&!g)for(;x--;x)v.unshift("..");!b||""===v[0]||v[0]&&"/"===v[0].charAt(0)||v.unshift(""),q&&"/"!==v.join("/").substr(-1)&&v.push("");var O,S=""===v[0]||v[0]&&"/"===v[0].charAt(0);return w&&(r.hostname=r.host=S?"":v.length?v.shift():"",(O=!!(r.host&&r.host.indexOf("@")>0)&&r.host.split("@"))&&(r.auth=O.shift(),r.host=r.hostname=O.shift())),(b=b||r.host&&v.length)&&!S&&v.unshift(""),v.length?r.pathname=v.join("/"):(r.pathname=null,r.path=null),ur.isNull(r.pathname)&&ur.isNull(r.search)||(r.path=(r.pathname?r.pathname:"")+(r.search?r.search:"")),r.auth=e.auth||r.auth,r.slashes=r.slashes||e.slashes,r.href=r.format(),r},br.prototype.parseHost=function(){var e=this.host,t=vr.exec(e);t&&(":"!==(t=t[0])&&(this.port=t.substr(1)),e=e.substr(0,e.length-t.length)),e&&(this.hostname=e)};function Pr(e){var t="undefined"==typeof window,r=Ve.applyDefaults(e,{domain:"db.fauna.com",scheme:"https",port:null,secret:null,timeout:60,observer:null,keepAlive:!0,headers:{},fetch:void 0}),n="https"===r.scheme;null===r.port&&(r.port=n?443:80),this._baseUrl=r.scheme+"://"+r.domain+":"+r.port,this._timeout=Math.floor(1e3*r.timeout),this._secret=r.secret,this._observer=r.observer,this._lastSeen=null,this._headers=r.headers,this._fetch=r.fetch||m({}),t&&r.keepAlive&&(this._keepAliveEnabledAgent=new((n?a({}):s({})).Agent)({keepAlive:!0}))}function Ir(e,t){return void 0===e?t:e}function jr(e){return"Basic "+I(e+":")}Pr.prototype.query=function(e,t){return this._execute("POST","",Se.wrap(e),null,t)},Pr.prototype.paginate=function(e,t,r){return t=Ir(t,{}),r=Ir(r,{}),new ze(this,e,t,r)},Pr.prototype.ping=function(e,t){return this._execute("GET","ping",null,{scope:e,timeout:t})},Pr.prototype.getLastTxnTime=function(){return this._lastSeen},Pr.prototype.syncLastTxnTime=function(e){(null==this._lastSeen||this._lastSeen<e)&&(this._lastSeen=e)},Pr.prototype._execute=function(e,t,r,n,i){n=Ir(n,null),t instanceof le.Ref&&(t=t.value),null!==n&&(n=Ve.removeUndefinedValues(n));var o=Date.now(),a=this,s=["GET","HEAD"].indexOf(e)>=0?void 0:JSON.stringify(r);return this._performRequest(e,t,s,n,i).then(function(i){var u=Date.now(),c=i.text,l=Fe.parseJSON(c),f=new Ue(e,t,n,s,r,c,l,i.status,function(e){let t={};for(const[r,n]of e.headers.entries())t[r]=n;return t}(i),o,u);return i.headers.has("x-txn-time")&&a.syncLastTxnTime(parseInt(i.headers.get("x-txn-time"),10)),null!=a._observer&&a._observer(f,a),L.FaunaHTTPError.raiseForStatusCode(f),l.resource})},Pr.prototype._performRequest=function(e,t,r,n,i){var o=Qe(this._baseUrl);o.set("pathname",t),o.set("query",n);const a=(i=Ir(i,{})).secret||this._secret;return this._fetch(o.href,{agent:this._keepAliveEnabledAgent,body:r,headers:Ve.removeNullAndUndefinedValues({...this._headers,Authorization:a&&jr(a),"X-FaunaDB-API-Version":"2.7","X-Fauna-Driver":"Javascript","X-Last-Seen-Txn":this._lastSeen}),method:e,timeout:this._timeout}).then(function(e){return e.text().then(function(t){return e.text=t,e})})};var Nr={Client:Pr,query:Se},Mr={};Object.defineProperty(Mr,"__esModule",{value:!0}),Mr.DOUBLE_SEPARATOR="__",Mr.TS_2500_YEARS=1672518456e4,Mr.CONVENTION={ROLE_PREFIX:"biota.",INDEX_PREFIX:"biota.",COLLECTION_PREFIX:"biota.",UDFUNCTION_PREFIX:"biota."};var Lr={};function kr(e){return e.endsWith("s")?e:e+"s"}Object.defineProperty(Lr,"__esModule",{value:!0}),Lr.collectionNameNormalized=function(e){return`${Mr.CONVENTION.COLLECTION_PREFIX}${kr(e.replace(Mr.CONVENTION.COLLECTION_PREFIX,""))}`},Lr.collectionNamePlural=kr,Lr.Collection=function(e){let{name:t,data:r,history_days:n,ttl_days:i}=e||{};return{name:t,data:r,history_days:n,ttl_days:i}};var Dr={};Object.defineProperty(Dr,"__esModule",{value:!0}),Dr.Batch=function(e){return e};var Fr={};Object.defineProperty(Fr,"__esModule",{value:!0});const Ur=Nr.query;Fr.Reference=function({collection:e,id:t,ref:r}={}){return r||(t?Ur.Ref(Ur.Collection(e),t):Ur.Collection(e))},Fr.Ref=function(e,t){if("string"==typeof e){const[t,r]=e.split("/");return Ur.Ref(Ur.Collection(t),r)}return Ur.Ref(e)};var Br={};Object.defineProperty(Br,"__esModule",{value:!0});const Vr=Nr.query;Br.Identity=function(){return Vr.If(Vr.HasIdentity(),Vr.Identity(),null)};var zr={};Object.defineProperty(zr,"__esModule",{value:!0}),zr.StringSplit=((e,t=".")=>Nr.query.If(Nr.query.Not(Nr.query.IsString(e)),Nr.query.Abort("SplitString only accept strings"),Nr.query.Map(Nr.query.FindStrRegex(e,Nr.query.Concat(["[^\\",t,"]+"])),Nr.query.Lambda("res",Nr.query.Select(["data"],Nr.query.Var("res"))))));var $r={};function Hr(e){for(var t in e)$r.hasOwnProperty(t)||($r[t]=e[t])}Object.defineProperty($r,"__esModule",{value:!0}),Hr(Dr),Hr(Fr),Hr(Br),Hr(zr);var Wr={};Object.defineProperty(Wr,"__esModule",{value:!0}),Wr.collection=function e(t){if(!t)throw new Error("biota.collection(name) - valid name is required");return{login:(e,r)=>Nr.query.Login($r.Reference({collection:t,id:e}),{password:r}),changePassword:(e,t=Nr.query.Identity())=>Nr.query.Call("biota.ChangePassword",[$r.Identity(),t,e]),get:e=>Nr.query.Get(Nr.query.Ref(Nr.query.Collection(t),e)),insert:(e,{id:r,password:n,credentials:i}={})=>Nr.query.Call("biota.Insert",[$r.Identity(),$r.Reference({collection:t,id:r}),{data:e,credentials:{...i,password:n}}]),update:(e,r)=>Nr.query.Call("biota.Update",[$r.Identity(),$r.Reference({collection:t,id:e}),{data:r}]),replace:(e,r)=>Nr.query.Call("biota.Replace",[$r.Identity(),$r.Reference({collection:t,id:e}),{data:r}]),upsert:(r,n)=>Nr.query.If(Nr.query.Exists($r.Reference({collection:t,id:r})),e(t).update(r,n),e(t).insert(n,{id:r})),repsert:(r,n)=>Nr.query.If(Nr.query.Exists($r.Reference({collection:t,id:r})),e(t).replace(r,n),e(t).insert(n,{id:r})),delete:e=>Nr.query.Call("biota.Delete",[$r.Identity(),$r.Reference({collection:t,id:e})]),forget:e=>Nr.query.Call("biota.Forget",[$r.Identity(),$r.Reference({collection:t,id:e})])}};var Gr={};Object.defineProperty(Gr,"__esModule",{value:!0}),Gr.get={get:function(e){return Nr.query.Get(e)},collections:function(){return Nr.query.Paginate(Nr.query.Collections(),{})},indexes:function(){return Nr.query.Paginate(Nr.query.Indexes(),{})},functions:function(){return Nr.query.Paginate(Nr.query.Functions(),{})},roles:function(){return Nr.query.Paginate(Nr.query.Roles(),{})},keys:function(){return Nr.query.Paginate(Nr.query.Keys())},tokens:function(){return Nr.query.Paginate(Nr.query.Documents(Nr.query.Tokens()))},credentials:function(){return Nr.query.Paginate(Nr.query.Documents(Nr.query.Credentials()))}};var Jr={};Object.defineProperty(Jr,"__esModule",{value:!0}),Jr.stringPath=function(e){return Array.isArray(e)?e.map(e=>`${e}`).join("."):e?e=`${e}`:e},Jr.path=function(e){let t=[];return Array.isArray(e)?t=e.map(e=>`${e}`):e&&(t=(e=`${e}`).split(".")),t.length>0&&(t[0].startsWith("~")?t[0]=t[0].slice(1):t.unshift("data")),t},Jr.name=function(e){return e.join(Mr.DOUBLE_SEPARATOR)},Jr.nameOrOptions=function(e,t){return"object"==typeof e?e:{name:e,...t}},Jr.splitEvery=function(e,t){let r=[],n=0;for(;n<t.length;)r.push(t.slice(n,n+=e));return r};var Qr={};Object.defineProperty(Qr,"__esModule",{value:!0}),Qr.Database=function(e){let{name:t,data:r={},api_version:n}=e||{};return{name:t,data:r,api_version:n}};var Xr={};Object.defineProperty(Xr,"__esModule",{value:!0}),Xr.udfunctionNameNormalized=function(e){return`${Mr.CONVENTION.UDFUNCTION_PREFIX}${e.replace(Mr.CONVENTION.UDFUNCTION_PREFIX,"")}`},Xr.UDFunction=function(e){let{name:t="",body:r,data:n,role:i}=e||{};return{name:t,body:r,data:n,role:i}};var Kr={};function Yr(e){let{name:t,source:r={collection:void 0,fields:{}},terms:n=[],values:i=[],unique:o=!1,serialized:a=!0,permissions:s={},data:u={}}=e||{};return{name:t,source:r,terms:n,values:i,unique:o,serialized:a,permissions:s,data:u}}function Zr(e=10,t){return Nr.query.Union(Nr.query.Map(new Array(e).fill(null).map((e,t)=>t+1),Nr.query.Lambda("min",Nr.query.NGram(Nr.query.LowerCase(Nr.query.Select(t,Nr.query.Var("instance"))),Nr.query.Var("min"),Nr.query.Add(1,Nr.query.Var("min"))))))}Object.defineProperty(Kr,"__esModule",{value:!0}),Kr.indexNameNormalized=function(e){return`biota.${e.replace("biota.","")}`},Kr.Index=Yr,Kr.NGramOnField=Zr;var en={};Object.defineProperty(en,"__esModule",{value:!0}),en.RuleBuilder=function(e){return(...t)=>(e||{}).query(...t)},en.Rule=function(e){return(e||{}).query},en.Rules=function(e){return e.length>1?Nr.query.And(...e):e[0]};var tn={};Object.defineProperty(tn,"__esModule",{value:!0}),tn.all=en.Rule({name:"all",query:!0});var rn={};Object.defineProperty(rn,"__esModule",{value:!0}),rn.are_rights_not_changed=en.Rule({name:"are_rights_not_changed"});var nn={};Object.defineProperty(nn,"__esModule",{value:!0}),nn.is_activity_not_changed=en.Rule({name:"is_activity_not_changed"});var on={};Object.defineProperty(on,"__esModule",{value:!0}),on.has_role=en.RuleBuilder({name:"has_role",query:e=>Nr.query.GT(Nr.query.Filter(Nr.query.Select(["access","roles"],Nr.query.Var("doc"),[]),Nr.query.Lambda(["role"],Nr.query.Equals(Nr.query.Role(e),Nr.query.Var("role")))),0)});var an={};Object.defineProperty(an,"__esModule",{value:!0}),an.is_assignee=en.Rule({name:"is_assignee",query:Nr.query.Equals(Nr.query.Select(["activity","assignees"],Nr.query.Var("doc"),null),Nr.query.Identity())});var sn={};Object.defineProperty(sn,"__esModule",{value:!0}),sn.is_not_assignee=en.Rule({name:"is_not_assignee",query:Nr.query.Not(Nr.query.Equals(Nr.query.Select(["activity","assignees"],Nr.query.Var("doc"),null),Nr.query.Identity()))});var un={};Object.defineProperty(un,"__esModule",{value:!0}),un.is_document_available=en.Rule({name:"is_document_available",query:Nr.query.Let({deleted_at:Nr.query.Select(["data","activity","deleted_at"],Nr.query.Var("doc"),Nr.query.ToTime(Mr.TS_2500_YEARS)),archived_at:Nr.query.Select(["data","activity","archived_at"],Nr.query.Var("doc"),Nr.query.ToTime(Mr.TS_2500_YEARS)),expired_at:Nr.query.Select(["data","activity","expired_at"],Nr.query.Var("doc"),Nr.query.ToTime(Mr.TS_2500_YEARS))},Nr.query.If(Nr.query.LTE(Nr.query.Var("deleted_at"),Nr.query.Var("archived_at"),Nr.query.Var("expired_at")),Nr.query.Var("deleted_at"),Nr.query.If(Nr.query.LTE(Nr.query.Var("archived_at"),Nr.query.Var("expired_at"),Nr.query.Var("deleted_at")),Nr.query.Var("archived_at"),Nr.query.Var("expired_at"))))});var cn={};Object.defineProperty(cn,"__esModule",{value:!0}),cn.is_first_argument_identity=en.Rule({name:"is_first_argument_identity",query:Nr.query.Lambda("args",Nr.query.Equals(Nr.query.Select(0,Nr.query.Var("args"),null),Nr.query.Identity()))});var ln={};Object.defineProperty(ln,"__esModule",{value:!0}),ln.is_not_owner=en.Rule({name:"is_not_owner",query:Nr.query.Not(Nr.query.Equals(Nr.query.Select(["activity","owner"],Nr.query.Var("doc"),null),Nr.query.Identity()))});var fn={};Object.defineProperty(fn,"__esModule",{value:!0}),fn.is_owner=en.Rule({name:"is_owner",query:Nr.query.Equals(Nr.query.Select(["activity","owner"],Nr.query.Var("doc"),null),Nr.query.Identity())});var dn={};Object.defineProperty(dn,"__esModule",{value:!0}),dn.is_self=en.Rule({name:"is_self",query:Nr.query.Equals(Nr.query.Var("ref"),Nr.query.Identity())});var hn={};Object.defineProperty(hn,"__esModule",{value:!0}),hn.none=en.Rule({name:"none",query:!1});var pn={};function yn(e){for(var t in e)pn.hasOwnProperty(t)||(pn[t]=e[t])}Object.defineProperty(pn,"__esModule",{value:!0}),yn(tn),yn(rn),yn(nn),yn(on),yn(an),yn(sn),yn(un),yn(cn),yn(ln),yn(fn),yn(dn),yn(hn);var mn={};Object.defineProperty(mn,"__esModule",{value:!0}),mn.wrapDoc=function(e,t){return Nr.query.Let({doc:Nr.query.Get(Nr.query.Var(e))},t)};var bn={};Object.defineProperty(bn,"__esModule",{value:!0});const gn=Nr.query;function vn(e){switch(e){case"self":return pn.is_self;case"owner":return pn.is_owner;case"not_owner":return pn.is_not_owner;case"assignee":return pn.is_assignee;case"not_assignee":return pn.is_not_assignee;case"all":return pn.all;case"none":return pn.none;default:return!1}}function wn(e,t=[]){return!(!e&&0===t.length)&&(Array.isArray(e)?[...e,...t]:[e,...t])}function _n(e){return en.Rules(e.map(e=>"string"==typeof e?vn(e):e))}bn.Action=vn,bn.ReadAction=function(e){return"boolean"==typeof(e=wn(e))?e:gn.Lambda("ref",mn.wrapDoc("ref",_n(e)))},bn.WriteAction=function(e){return"boolean"==typeof(e=wn(e,[]))?e:gn.Lambda(["oldDoc","newDoc"],_n(e))},bn.CreateAction=function(e){return!!e&&("boolean"==typeof(e=wn(e,[]))?e:gn.Lambda(["doc"],_n(e)))},bn.DeleteAction=function(e){return"boolean"==typeof(e=wn(e))?e:gn.Lambda(["ref"],gn.Let({doc:gn.Get(gn.Var("ref"))},_n(e)))},bn.HistoryReadAction=function(e){return"boolean"==typeof(e=wn(e))?e:gn.Lambda(["ref"],gn.Let({doc:gn.Get(gn.Var("ref"))},_n(e)))},bn.HistoryWriteAction=function(e){return"boolean"==typeof(e=wn(e,[]))?e:gn.Lambda(["ref","ts","action","doc"],_n(e))},bn.UnrestrictedReadAction=function(e){return"boolean"==typeof(e=wn(e))?e:_n(e)},bn.CallAction=function(e){return"boolean"==typeof(e=wn(e,[]))?e:gn.Lambda("args",_n(e))};var qn={};function xn(e){return"boolean"==typeof e?e:Nr.query.Query(e)}Object.defineProperty(qn,"__esModule",{value:!0}),qn.CustomPrivilege=function(e){let{resource:t,actions:r}=e||{};return{resource:t,actions:r}},qn.Privilege=function(e){let{resource:t,actions:r={}}=e||{},n={create:xn(bn.CreateAction(r.create)),delete:xn(bn.DeleteAction(r.delete)),read:xn(bn.ReadAction(r.read)),write:xn(bn.WriteAction(r.write)),history_write:xn(bn.HistoryWriteAction(r.history_read)),history_read:xn(bn.HistoryReadAction(r.history_read)),unrestricted_read:xn(bn.UnrestrictedReadAction(r.unrestricted_read)),call:xn(bn.CallAction(r.call))},i={};for(let o in r)i[o]=n[o];return{resource:t,actions:i}};var En={};function On(e){for(var t in e)En.hasOwnProperty(t)||(En[t]=e[t])}Object.defineProperty(En,"__esModule",{value:!0}),On(bn),On(qn),En.roleNameNormalized=function(e){return`${Mr.CONVENTION.ROLE_PREFIX}${e.replace(Mr.CONVENTION.ROLE_PREFIX,"")}`},En.Role=function(e){let{name:t,membership:r,privileges:n}=e||{};return{name:t,membership:r,privileges:n||[]}};var Sn={};Object.defineProperty(Sn,"__esModule",{value:!0}),Sn.create={document:function(e,t={}){return Nr.query.Create($r.Reference({collection:e,id:t.id}),t)},database:function(e,t={}){let r=Jr.nameOrOptions(e,t);return Nr.query.CreateDatabase(Qr.Database(r))},collection:function(e,t={}){let r=Jr.nameOrOptions(e,t);return Nr.query.CreateCollection(Lr.Collection(r))},index:function(e,t={}){let r=Jr.nameOrOptions(e,t);return Nr.query.CreateIndex(Kr.Index(r))},function:function(e,t={}){let r=Jr.nameOrOptions(e,t);return Nr.query.CreateFunction(Xr.UDFunction(r))},role:function(e,t={}){let r=Jr.nameOrOptions(e,t);return Nr.query.CreateRole(En.Role(r))},token:function(e,t={}){return Nr.query.Create(Nr.query.Tokens(),{instance:e,...t})},key:function(e){return Nr.query.CreateKey(e)}};var Cn={};Object.defineProperty(Cn,"__esModule",{value:!0}),Cn.update={database:function(e,t){return Nr.query.Update(Nr.query.Database(e),t)},collection:function(e,t){return Nr.query.Update(Nr.query.Collection(e),t)},index:function(e,t={}){let{unique:r}=t;return Nr.query.Update(Nr.query.Index(e),{name:e,unique:r})},function:function(e,t){return Nr.query.Update(Nr.query.Function(e),t)},role:function(e,t={}){let r=Jr.nameOrOptions(e,t),n=r.membership||[];Array.isArray(n)||(n=[n]);let i=r.privileges||[];return Nr.query.Let({role:Nr.query.Get(Nr.query.Role(r.name)),memberships:Nr.query.Select("membership",Nr.query.Var("role"),[]),privileges:Nr.query.Select("privileges",Nr.query.Var("role"),[]),membershipArray:Nr.query.If(Nr.query.IsArray(Nr.query.Var("memberships")),Nr.query.Var("memberships"),[Nr.query.Var("memberships")]),differencedPrivileges:Nr.query.Filter(Nr.query.Var("privileges"),Nr.query.Lambda("privilege",Nr.query.Let({checks:Nr.query.Map(i,Nr.query.Lambda("newPrivilege",Nr.query.Not(Nr.query.Equals(Nr.query.Select("resource",Nr.query.Var("privilege"),-1),Nr.query.Select("resource",Nr.query.Var("newPrivilege"),-1)))))},Nr.query.If(Nr.query.IsEmpty(Nr.query.Var("checks")),!0,Nr.query.And(Nr.query.Var("checks")))))),filteredPrivileges:Nr.query.Filter(Nr.query.Var("differencedPrivileges"),Nr.query.Lambda("privilege",Nr.query.Let({resource:Nr.query.Select("resource",Nr.query.Var("privilege"),!1)},Nr.query.If(Nr.query.IsRef(Nr.query.Var("resource")),Nr.query.Exists(Nr.query.Var("resource")),!1)))),differencedMembership:Nr.query.Filter(Nr.query.Var("membershipArray"),Nr.query.Lambda("membership",Nr.query.Let({checks:Nr.query.Map(n,Nr.query.Lambda("newMembership",Nr.query.Not(Nr.query.Equals(Nr.query.Select("resource",Nr.query.Var("membership"),-1),Nr.query.Select("resource",Nr.query.Var("newMembership"),-1)))))},Nr.query.If(Nr.query.IsEmpty(Nr.query.Var("checks")),!0,Nr.query.And(Nr.query.Var("checks")))))),filteredMembership:Nr.query.Filter(Nr.query.Var("differencedMembership"),Nr.query.Lambda("membership",Nr.query.Let({resource:Nr.query.Select("resource",Nr.query.Var("membership"),!1)},Nr.query.If(Nr.query.IsRef(Nr.query.Var("resource")),Nr.query.Exists(Nr.query.Var("resource")),!1))))},Nr.query.Distinct(Nr.query.Union(Nr.query.Var("filteredPrivileges"),i)))},token:function(e,t){return Nr.query.Update(Nr.query.Ref(Nr.query.Tokens(),e),t)},key:function(e,t){return Nr.query.Update(Nr.query.Ref(Nr.query.Keys(),e),t)}};var Rn={};Object.defineProperty(Rn,"__esModule",{value:!0}),Rn.upsert={database:function(e,t={}){let r=Jr.nameOrOptions(e,t);return Nr.query.If(Nr.query.Exists(Nr.query.Database(r.name)),Cn.update.database(r.name,r),Sn.create.database(r.name,r))},collection:function(e,t={}){let r=Jr.nameOrOptions(e,t);return Nr.query.If(Nr.query.Exists(Nr.query.Collection(r.name)),Cn.update.collection(r.name,r),Sn.create.collection(r.name,r))},index:function(e,t={}){let r=Jr.nameOrOptions(e,t);return Nr.query.If(Nr.query.Exists(Nr.query.Index(r.name)),Cn.update.index(r.name,r),Sn.create.index(r.name,r))},function:function(e,t={}){let r=Jr.nameOrOptions(e,t);return Nr.query.If(Nr.query.Exists(Nr.query.Function(r.name)),Cn.update.function(r.name,r),Sn.create.function(r.name,r))},role:function(e,t={}){let r=Jr.nameOrOptions(e,t);return Nr.query.If(Nr.query.Exists(Nr.query.Role(r.name)),Cn.update.role(r.name,r),Sn.create.role(r.name,r))},token:function(e,t={}){let r=Jr.nameOrOptions(e,t);return Nr.query.If(Nr.query.Exists(Nr.query.Ref(Nr.query.Tokens(),r.name)),Cn.update.token(r.name,r),Sn.create.token(r.name,r))},key:function(e,t={}){let r=Jr.nameOrOptions(e,t);return Nr.query.If(Nr.query.Exists(Nr.query.Ref(Nr.query.Keys(),r.name)),Cn.update.key(r.name,r),Sn.create.key(r))}};var An={};Object.defineProperty(An,"__esModule",{value:!0}),An.replace={database:function(e,t){return Nr.query.Replace(Nr.query.Database(e),t)},collection:function(e,t){return Nr.query.Replace(Nr.query.Collection(e),t)},index:function(e,t){return Nr.query.Replace(Nr.query.Index(e),t)},function:function(e,t){return Nr.query.Replace(Nr.query.Function(e),t)},role:function(e,t){return Nr.query.Replace(Nr.query.Role(e),t)},token:function(e,t){return Nr.query.Replace(Nr.query.Ref(Nr.query.Tokens(),e),t)},key:function(e,t){return Nr.query.Replace(Nr.query.Ref(Nr.query.Keys(),e),t)}};var Tn={};Object.defineProperty(Tn,"__esModule",{value:!0}),Tn.repsert={database:function(e,t){let r=Jr.nameOrOptions(e,t);return Nr.query.If(Nr.query.Exists(Nr.query.Database(r.name)),An.replace.database(r.name,r),Sn.create.database(r.name,r))},collection:function(e,t){let r=Jr.nameOrOptions(e,t);return Nr.query.If(Nr.query.Exists(Nr.query.Collection(r.name)),An.replace.collection(r.name,r),Sn.create.collection(r.name,r))},index:function(e,t){let r=Jr.nameOrOptions(e,t);return Nr.query.If(Nr.query.Exists(Nr.query.Index(r.name)),An.replace.index(r.name,r),Sn.create.index(r.name,r))},function:function(e,t){let r=Jr.nameOrOptions(e,t);return Nr.query.If(Nr.query.Exists(Nr.query.Function(r.name)),An.replace.function(r.name,r),Sn.create.function(r.name,r))},role:function(e,t){let r=Jr.nameOrOptions(e,t);return Nr.query.If(Nr.query.Exists(Nr.query.Role(r.name)),An.replace.role(r.name,r),Sn.create.role(r.name,r))},token:function(e,t){let r=Jr.nameOrOptions(e,t);return Nr.query.If(Nr.query.Exists(Nr.query.Ref(Nr.query.Tokens(),r.name)),An.replace.token(r.name,r),Sn.create.token(r.name,r))},key:function(e,t){let r=Jr.nameOrOptions(e,t);return Nr.query.If(Nr.query.Exists(Nr.query.Ref(Nr.query.Keys(),r.name)),An.replace.key(r.name,r),Sn.create.key(r))}};var Pn={};Object.defineProperty(Pn,"__esModule",{value:!0}),Pn.forget={database:function(e){return Nr.query.Delete(Nr.query.Database(e))},collection:function(e){return Nr.query.Delete(Nr.query.Collection(e))},index:function(e){return Nr.query.Delete(Nr.query.Index(e))},function:function(e){return Nr.query.Delete(Nr.query.Function(e))},role:function(e){return Nr.query.Delete(Nr.query.Role(e))},token:function(e){return Nr.query.Delete(Nr.query.Ref(Nr.query.Tokens(),e))},key:function(e){return Nr.query.Delete(Nr.query.Ref(Nr.query.Keys(),e))}};var In={};Object.defineProperty(In,"__esModule",{value:!0}),In.ql=$r,In.collection=Wr.collection,In.get=Gr.get,In.create=Sn.create,In.update=Cn.update,In.upsert=Rn.upsert,In.repsert=Tn.repsert,In.replace=An.replace,In.forget=Pn.forget;var jn={};Object.defineProperty(jn,"__esModule",{value:!0}),jn.execute=async function(e,t){let{indent:r=0,singleResult:n=!1,domain:i="task"}=t||{};const o=P.default("biota").extend(i);let a="--".repeat(r),s={},u=[];for(let l of e)o(`${a} ${l.name}`),await new Promise((e,t)=>l.task(s).then(e).catch(t)).then(e=>u.push(e)).catch(e=>{u.push({error:e}),o(`${a} error: ${l.name}: ${e.message}`);try{o(JSON.stringify(JSON.parse(e.requestResult.responseRaw),null,2))}catch(e){o(JSON.stringify(e,null,2))}if(l.fullError)try{o(JSON.stringify(JSON.parse(e.requestResult.responseRaw),null,2))}catch(t){o(e)}});if(n)try{return u[0]}catch(c){return{}}return u};var Nn={};Object.defineProperty(Nn,"__esModule",{value:!0}),Nn.scaffold=function(e){let t=this;return async function(r={}){let n=["~ref","~ts","access.roles","access.owner","access.assignees","activity.assigned_by","activity.owner_changed_by","activity.credentials_changed_by","activity.created_by","activity.updated_by","activity.replaced_by","activity.expired_by","activity.deleted_by","activity.archived_by","activity.hidden_by"],{index:i=n,compute:o=[],field:a=[]}=r||{},s=[{name:`Upserting collection (${e.name})`,task:async()=>t.query(In.upsert.collection(e))}];for(let u of i)s.push({name:`Upserting index field (${u}) on (${e.name})`,task:async()=>t.collection(e.name).index(u,{role:"user"})});for(let u of o)s.push({name:`Upserting viewable field (${u.field}) on (${e.name})`,task:async()=>t.collection(e.name).compute(u,{role:"user"})});for(let u of a)s.push({name:`Upserting viewable field (${u.field}) on (${e.name})`,task:async()=>t.collection(e.name).field(u)});return jn.execute(s,{domain:"DB.collection.scaffold"})}};var Mn={};function Ln(e){let t={inputs:[],outputs:[],field:void 0,data:{},reverse:!1,binding:void 0,name:void 0,action:void 0,ngram:!1,ngramMin:3,ngramMax:10,unique:!1,serialized:void 0,permissions:void 0};return"string"==typeof e?(t.name=e,t.field=e):"object"==typeof e&&Object.assign(t,e),t}Object.defineProperty(Mn,"__esModule",{value:!0}),Mn.field=function(e){let t=this;return async function(r){let n=Ln(r),i=Kr.Index({source:{collection:Nr.query.Collection(e.name),fields:{}},unique:n.unique,serialized:n.serialized,data:n.data}),o=[];const a=({field:e,binding:t,reverse:r},n={})=>{if(t){let i=Jr.stringPath(e||"cursor");return n[i]=t,{binding:i,reverse:r}}if(e)return{field:Jr.path(e),reverse:r}};if("index"===n.action)if(n.field?i.terms=[a({field:n.field,binding:n.binding,reverse:n.reverse},i.source.fields)]:n.inputs.length>0?i.terms=n.inputs.map(e=>"string"==typeof e?a({field:e},i.source.fields):e.binding?a({field:e.field,binding:e.binding,reverse:e.reverse},i.source.fields):e.field?a({field:e.field},i.source.fields):void 0):i.terms=[{field:["ref"]}],n.outputs.length>0?i.values=n.outputs.map(e=>{if("string"==typeof e)return a({field:e},i.source.fields);if(e.binding){let t=Jr.stringPath(e.field)||"cursor";return i.source.fields[Jr.stringPath(t)]=e.binding,a({field:e.field,binding:e.binding,reverse:e.reverse},i.source.fields)}return e.field?a({field:e.field},i.source.fields):void 0}):i.values=[{field:["ref"]}],i.name=Kr.indexNameNormalized(Jr.name([e.name,"search","on",Jr.stringPath(n.name||n.field)])),n.ngram){if(i.terms.length>0&&i.terms.length>1)throw new Error(`Can't produce an ngram index with ${i.terms.length} terms`);let r="";try{r=Jr.stringPath(n.field||i.terms[0].field)}catch(s){throw new Error("Couldn't find a correct field name")}let a="ngram:"+r,u={name:Kr.indexNameNormalized(Jr.name([e.name,"ngram","on",Jr.stringPath(r)])),source:{collection:Nr.query.Collection(e.name),fields:{[a]:Nr.query.Query(Nr.query.Lambda("instance",Nr.query.Distinct(Kr.NGramOnField(n.ngramMax,Jr.path(n.field)))))}},terms:[{binding:a}],serialized:!0,data:n.data};o.push({name:`Creating (ngram search) index: ${u.name}`,task:async()=>t.query(Rn.upsert.index(u)),fullError:!0})}else o.push({name:`Creating (search) index: ${i.name}`,task:async()=>t.query(Rn.upsert.index(i))});else if("compute"===n.action){const r=n.field||n.name;i.source.fields[r]=n.binding;let a={...i,name:Kr.indexNameNormalized(Jr.name([e.name,"compute","on",Jr.stringPath(r)])),values:[{binding:r}],terms:[{field:["ref"]}]};o.push({name:`Creating (search compute) index: ${a.name}`,task:async()=>t.query(Rn.upsert.index(a))})}return jn.execute(o,{domain:"DB.collection.field"})}};var kn={};Object.defineProperty(kn,"__esModule",{value:!0}),kn.index=function(e){let t=this;return async function(r,n={}){let{role:i,roles:o,maxLength:a}=n,s=i||o;Array.isArray(s)||(s=[i]);let u=[],c={field:null,action:"index",ngram:!1,ngramMax:a};return"string"==typeof r?c.field=r:"object"==typeof r&&Object.assign(c,r),u.push({name:`Adding index field ${c.field} on ${e.name}`,task:async()=>t.collection(e.name).field(c).then(async e=>{for(let r of e){let{ref:e,name:n}=r||{};if(n&&i){let r=[];for(let i of s)r.push({name:`Adding privilege (read) for index ${n} on ${i}`,task:()=>t.query(In.update.role(i,{privileges:[{resource:e,actions:{read:!0,history_read:!0}}]})),fullError:!0});await jn.execute(r)}}return e})}),jn.execute(u,{domain:"DB.collection.index"})}};var Dn={};Object.defineProperty(Dn,"__esModule",{value:!0}),Dn.compute=function(e){let t=this;return async function(r,n={}){let{role:i,roles:o}=n,a=i||o;Array.isArray(a)||(a=[i]);let s=[];return s.push({name:`Scaffolding index field on ${e.name}`,task:async()=>t.collection(e.name).field({...r,action:"compute"}).then(async e=>{for(let r of e){let{ref:e,name:n}=r||{};if(n&&i){let r=[];for(let i of a)r.push({name:`Adding privilege (read) for index ${n} on ${i}`,task:()=>t.query(Cn.update.role(i,{privileges:[{resource:e,actions:{read:!0,history_read:!0}}]}))});await jn.execute(r)}}return e})}),jn.execute(s,{domain:"DB.collection.compute"})}};var Fn={};function Un(e,t){const r=t=>Nr.query.Call(Xr.udfunctionNameNormalized("SearchQuery"),[Nr.query.Collection(e),t]),n={$and:(...e)=>Nr.query.Intersection(...e.map(r)),$or:(...e)=>(console.log("queries",e),Nr.query.Union(...e.map(r))),$nor:(e,...t)=>Nr.query.Difference(r(e),...t.map(r))},i=e=>Object.keys(e).some(e=>Object.keys(n).includes(e)),o=e=>{let t={};const r=(e,t)=>{if("object"==typeof e)if(i(e)){let r=(e=>Object.keys(e).find(e=>(e=>Object.keys(n).includes(e))(e)))(e),i=e[r],o=n[r](...i);Object.assign(t,o)}else for(let n in e)t[n]={},r(e[n],t[n]);else t=Array.isArray(e)?e.map(e=>"object"==typeof e||Array.isArray(e)?o(e):e):e};return r(e,t),t};return t?i(t)?o(t):r(t):Nr.query.Documents(Nr.query.Collection(e))}Object.defineProperty(Fn,"__esModule",{value:!0}),Fn.find=function(e){let t=this;return async function(r,n={},i=Nr.query.Lambda("x",Nr.query.Get(Nr.query.Var("x")))){return jn.execute([{name:`Find (${yr.stringify(r).slice(0,20)}...) in (${e.name})`,task(){let o=Nr.query.Paginate(Un(e.name,r),n);return t.query(i?Nr.query.Map(o,i):o)}}],{domain:"DB.collection.find"})}};var Bn={};Object.defineProperty(Bn,"__esModule",{value:!0}),Bn.paginate=function(e){let t=this;return async function*(r,n={},i){let o,a=!0;for(;o||a;)a&&(a=!1),yield jn.execute([{name:`Paginate after ${o} in (${e.name})`,task:async()=>t.collection(e.name).find(r,{...n,after:o},i).then(e=>(o=e.after?e.after:void 0,e))}],{domain:"DB.collection.paginate"})}};var Vn={};Object.defineProperty(Vn,"__esModule",{value:!0}),Vn.get=function(e){let t=this;return async function(r){return jn.execute([{name:`Get (${r}) in (${e.name})`,task:()=>t.query(Wr.collection(e.name).get(r))}],{domain:"DB.collection.get"})}};var zn={};Object.defineProperty(zn,"__esModule",{value:!0}),zn.insert=function(e){let t=this;return async function(r,n){let{keepId:i=!1}=n||{};const{id:o,credentials:a}=r||{};return jn.execute([{name:(i?`Upserting ${o}`:"Inserting")+` in ${e.name}`,task(){if(i){if(!o)throw new Error("Doesn't have any given id");return t.query(Wr.collection(e.name).upsert(r.data||{},{id:o,credentials:a}))}return t.query(Wr.collection(e.name).insert(r))}}],{domain:"DB.collection.insert"})}};var $n={};Object.defineProperty($n,"__esModule",{value:!0}),$n.insertBatch=function(e){let t=this;return async function(r,n={}){let{batchSize:i=50,keepId:o=!1}=n,a=r;Array.isArray(a)||(a=[a]);let s,u=Jr.splitEvery(i,a),c=[];s=o?Nr.query.Let({data:Nr.query.Select("data",Nr.query.Var("item"),{}),credentials:Nr.query.Select("credentials",Nr.query.Var("item"),{}),id:Nr.query.Select("id",Nr.query.Var("item"),null)},Nr.query.If(Nr.query.Var("id"),Wr.collection(e.name).upsert(Nr.query.Var("data"),{id:Nr.query.Var("id"),credentials:Nr.query.Var("credentials")}),null)):Wr.collection(e.name).insert(Nr.query.Var("item"));for(let[e,l]of Object.entries(u))c.push({name:`Inserting batch n\xb0${e+1} on ${u.length}`,task:()=>t.query(Nr.query.Map(l,Nr.query.Lambda("item",s)))});return jn.execute(c,{domain:"DB.collection.insertBatch"})}};var Hn={};Object.defineProperty(Hn,"__esModule",{value:!0}),Hn.replace=function(e){let t=this;return async function(r,n){return jn.execute([{name:`Replace (${r}) in (${e.name})`,task:()=>t.query(Wr.collection(e.name).replace(r,n))}],{domain:"DB.collection.replace"})}};var Wn={};Object.defineProperty(Wn,"__esModule",{value:!0}),Wn.update=function(e){let t=this;return async function(r,n){return jn.execute([{name:`Update (${r}) in (${e.name})`,task:()=>t.query(Wr.collection(e.name).update(r,n))}],{domain:"DB.collection.update"})}};var Gn={};Object.defineProperty(Gn,"__esModule",{value:!0}),Gn.repsert=function(e){let t=this;return async function(r,n){return jn.execute([{name:`Replace/Insert (${r}) in (${e.name})`,task:()=>t.query(Wr.collection(e.name).repsert(r,n))}],{domain:"DB.collection.repsert"})}};var Jn={};Object.defineProperty(Jn,"__esModule",{value:!0}),Jn.upsert=function(e){let t=this;return async function(r,n){return jn.execute([{name:`Update/Insert (${r}) in (${e.name})`,task:()=>t.query(Wr.collection(e.name).upsert(r,n))}],{domain:"DB.collection.upsert"})}};var Qn={};Object.defineProperty(Qn,"__esModule",{value:!0}),Qn.deleteFn=function(e){let t=this;return async function(r){return jn.execute([{name:`Delete (${r}) in (${e.name})`,task:()=>t.query(Wr.collection(e.name).delete(r))}],{domain:"DB.collection.delete"})}};var Xn={};Object.defineProperty(Xn,"__esModule",{value:!0}),Xn.forget=function(e){let t=this;return async function(r){return jn.execute([{name:`Forget (${r}) in (${e.name})`,task:()=>t.query(Wr.collection(e.name).forget(r))}],{domain:"DB.collection.forget"})}};var Kn={};Object.defineProperty(Kn,"__esModule",{value:!0}),Kn.collection=function(e){let t=Lr.Collection({});if("string"==typeof e?t.name=e:"object"==typeof e&&Object.assign(t,e),!t.name)throw new Error("biota.collection() - no valid collection name");return{scaffold:Nn.scaffold.call(this,t),field:Mn.field.call(this,t),index:kn.index.call(this,t),compute:Dn.compute.call(this,t),find:Fn.find.call(this,t),paginate:Bn.paginate.call(this,t),get:Vn.get.call(this,t),insert:zn.insert.call(this,t),insertBatch:$n.insertBatch.call(this,t),replace:Hn.replace.call(this,t),update:Wn.update.call(this,t),repsert:Gn.repsert.call(this,t),upsert:Jn.upsert.call(this,t),delete:Qn.deleteFn.call(this,t),forget:Xn.forget.call(this,t),async changes(){}}};var Yn={};Object.defineProperty(Yn,"__esModule",{value:!0}),Yn.paginate=function*(e,t={}){let r=1/0;for(;r;)yield jn.execute([{name:"Paginating your query",task(){return this.client.query(Nr.query.Paginate(e,t)).then(e=>(r=e.after?e.after:void 0,e))}}],{singleResult:!0,domain:"DB.paginate"})};var Zn={};Object.defineProperty(Zn,"__esModule",{value:!0}),Zn.query=async function(e){return this.client.query(e)};var ei={};Object.defineProperty(ei,"__esModule",{value:!0}),ei.LogAction=Xr.UDFunction({name:Xr.udfunctionNameNormalized("LogAction"),body:Nr.query.Query(Nr.query.Lambda(["documentRef","ts","userRef","actionName"],Nr.query.Create(Nr.query.Collection(Lr.collectionNameNormalized("actions")),{data:{document:Nr.query.Var("documentRef"),ts:Nr.query.Var("ts"),user:Nr.query.Var("userRef"),name:Nr.query.Var("actionName")}})))});var ti={};Object.defineProperty(ti,"__esModule",{value:!0}),ti.FindIndex=Xr.UDFunction({name:Xr.udfunctionNameNormalized("FindIndex"),body:Nr.query.Query(Nr.query.Lambda(["resource","terms_fields"],Nr.query.Let({indexes:Nr.query.Paginate(Nr.query.Intersection(Nr.query.Match(Nr.query.Index(Kr.indexNameNormalized("indexes__by__resource")),[Nr.query.Var("resource")]),Nr.query.Union(Nr.query.Map(Nr.query.Var("terms_fields"),Nr.query.Lambda(["field"],Nr.query.Match(Nr.query.Index(Kr.indexNameNormalized("indexes__by__terms")),[Nr.query.Var("field")])))))),termsCount:Nr.query.Count(Nr.query.Var("terms_fields")),filteredIndexes:Nr.query.Filter(Nr.query.Var("indexes"),Nr.query.Lambda(["index"],Nr.query.Equals(Nr.query.Var("termsCount"),Nr.query.Count(Nr.query.Select("terms",Nr.query.Get(Nr.query.Var("index")),1/0)))))},Nr.query.Select(0,Nr.query.Var("filteredIndexes"),null)))),role:Nr.query.Role("system")});var ri={};function ni(e){return Nr.query.Let({pathArray:Nr.query.If(Nr.query.IsArray(e),Nr.query.Map(e,Nr.query.Lambda("part",Nr.query.ToString(Nr.query.Var("part")))),zr.StringSplit(Nr.query.ToString(e)))},Nr.query.If(Nr.query.GT(Nr.query.Count(Nr.query.Var("pathArray")),0),Nr.query.If(Nr.query.StartsWith(Nr.query.Select(0,Nr.query.Var("pathArray"),""),"~"),Nr.query.Drop(1,Nr.query.Var("pathArray")),Nr.query.Append(Nr.query.Var("pathArray"),["data"])),[]))}Object.defineProperty(ri,"__esModule",{value:!0}),ri.pathString=function(e){return Nr.query.Concat(ni(e),".")};var ii={};Object.defineProperty(ii,"__esModule",{value:!0}),ii.SearchQuery=Xr.UDFunction({name:Xr.udfunctionNameNormalized("SearchQuery"),body:Nr.query.Query(Nr.query.Lambda(["resource","search_terms"],Nr.query.Let({searchTerms:Nr.query.ToArray(Nr.query.Var("search_terms")),termIndexes:Nr.query.Map(Nr.query.Var("searchTerms"),Nr.query.Lambda(["field","value"],Nr.query.If(Nr.query.IsObject(Nr.query.Var("value")),Nr.query.If(Nr.query.Contains("$ngram",Nr.query.Var("value")),[Nr.query.Call(Kr.indexNameNormalized("FindIndex"),[Nr.query.Var("resource"),[Nr.query.Concat(["binding:","ngram:",Nr.query.Var("field")])]]),Nr.query.LowerCase(Nr.query.ToString(Nr.query.Select("$ngram",Nr.query.Var("value"),""))),Nr.query.Concat(["ngram:",ri.pathString(Nr.query.Var("field"))])],[null,null,null]),[Nr.query.Call(Kr.indexNameNormalized("FindIndex"),[Nr.query.Var("resource"),[Nr.query.Concat(["term:",ri.pathString(Nr.query.Var("field"))])]]),Nr.query.Var("value"),Nr.query.Var("field")]))),validTermIndexes:Nr.query.Filter(Nr.query.Var("termIndexes"),Nr.query.Lambda(["index","value","field"],Nr.query.IsIndex(Nr.query.Var("index")))),unvalidIndexes:Nr.query.Filter(Nr.query.Var("termIndexes"),Nr.query.Lambda(["index","value","field"],Nr.query.Not(Nr.query.IsIndex(Nr.query.Var("index"))))),unvalidFields:Nr.query.Concat(Nr.query.Map(Nr.query.Var("unvalidIndexes"),Nr.query.Lambda(["index","value","field"],Nr.query.Var("field"))),", ")},Nr.query.If(Nr.query.LT(Nr.query.Count(Nr.query.Var("unvalidIndexes")),1),Nr.query.Intersection(Nr.query.Map(Nr.query.Var("validTermIndexes"),Nr.query.Lambda(["index","value","field"],Nr.query.Match(Nr.query.Var("index"),Nr.query.Var("value"))))),Nr.query.Abort(Nr.query.Concat(["Indexes couldn't be found for field(s): ",Nr.query.Concat(Nr.query.Var("unvalidFields"),", ")]," "))))))});var oi={};Object.defineProperty(oi,"__esModule",{value:!0}),oi.WrapActionAndLog=((e,t)=>Nr.query.Let({doc:t,action:Nr.query.If(Nr.query.IsRef(Nr.query.Select("ref",Nr.query.Var("doc"),null)),Nr.query.Call(Xr.udfunctionNameNormalized("LogAction"),Nr.query.Select("ref",Nr.query.Var("doc")),Nr.query.Select("ts",Nr.query.Var("doc")),$r.Identity(),e),null)},{doc:Nr.query.Var("doc"),action:Nr.query.Var("action")}));var ai={};Object.defineProperty(ai,"__esModule",{value:!0});const si=(e,t=Nr.query.Var("data"))=>{let r={};for(let n in e)r[n]=Nr.query.Merge(Nr.query.Select(n,t,{}),e[n]);return Nr.query.Merge(t,r)};ai.logData={own:()=>si({access:{owner:Nr.query.Var("ref")},activity:{owner_changed_at:Nr.query.Now(),owner_changed_by:Nr.query.Var("userRef")}}),credentials:()=>si({activity:{credentials_changed_by:Nr.query.Var("ref"),credentials_changed_at:Nr.query.Now()}},{}),assign:()=>si({access:{assignees:Nr.query.Var("ref")},activity:{assigned_by:Nr.query.Var("userRef"),assigned_at:Nr.query.Now()}}),insert:()=>si({activity:{created_by:Nr.query.Var("userRef"),created_at:Nr.query.Now()}}),update:()=>si({activity:{updated_by:Nr.query.Var("userRef"),updated_at:Nr.query.Now()}}),replace:()=>si({activity:{replaced_by:Nr.query.Var("userRef"),replaced_at:Nr.query.Now()}}),expire:()=>si({activity:{expired_by:Nr.query.Var("userRef"),expired_at:Nr.query.Var("at")}},{}),delete:()=>si({activity:{deleted_by:Nr.query.Var("userRef"),deleted_at:Nr.query.Now()}},{}),archive:()=>si({activity:{archived_by:Nr.query.Var("userRef"),archived_at:Nr.query.Now()}},{})};var ui={};Object.defineProperty(ui,"__esModule",{value:!0}),ui.Insert=Xr.UDFunction({name:Xr.udfunctionNameNormalized("Insert"),body:Nr.query.Query(Nr.query.Lambda(["userRef","collectionRef","data"],oi.WrapActionAndLog("insert",Nr.query.Create(Nr.query.Var("collectionRef"),{data:ai.logData.insert()}))))});var ci={};Object.defineProperty(ci,"__esModule",{value:!0}),ci.Update=Xr.UDFunction({name:Xr.udfunctionNameNormalized("Update"),body:Nr.query.Query(Nr.query.Lambda(["userRef","ref","data"],oi.WrapActionAndLog("update",Nr.query.Update(Nr.query.Var("ref"),{data:ai.logData.update()}))))});var li={};Object.defineProperty(li,"__esModule",{value:!0}),li.Assign=Xr.UDFunction({name:Xr.udfunctionNameNormalized("Assign"),body:Nr.query.Query(Nr.query.Lambda(["userRef","ref","data"],oi.WrapActionAndLog("assign",Nr.query.Update(Nr.query.Var("ref"),{data:ai.logData.assign()}))))});var fi={};Object.defineProperty(fi,"__esModule",{value:!0}),fi.Archive=Xr.UDFunction({name:Xr.udfunctionNameNormalized("Archive"),body:Nr.query.Query(Nr.query.Lambda(["userRef","ref","at"],oi.WrapActionAndLog("archive",Nr.query.Update(Nr.query.Var("ref"),{data:ai.logData.archive()}))))});var di={};Object.defineProperty(di,"__esModule",{value:!0}),di.ChangePassword=Xr.UDFunction({name:Xr.udfunctionNameNormalized("ChangePassword"),body:Nr.query.Query(Nr.query.Lambda(["userRef","ref","password"],oi.WrapActionAndLog("credentials",Nr.query.Update(Nr.query.Var("ref"),{data:ai.logData.credentials(),credentials:{password:Nr.query.Var("password")}}))))});var hi={};Object.defineProperty(hi,"__esModule",{value:!0}),hi.Delete=Xr.UDFunction({name:Xr.udfunctionNameNormalized("Delete"),body:Nr.query.Query(Nr.query.Lambda(["userRef","ref","at"],oi.WrapActionAndLog("delete",Nr.query.Update(Nr.query.Var("ref"),{data:ai.logData.delete()}))))});var pi={};Object.defineProperty(pi,"__esModule",{value:!0}),pi.Expire=Xr.UDFunction({name:Xr.udfunctionNameNormalized("Expire"),body:Nr.query.Query(Nr.query.Lambda(["userRef","ref","at"],oi.WrapActionAndLog("expire",Nr.query.Update(Nr.query.Var("ref"),{data:ai.logData.expire()}))))});var yi={};Object.defineProperty(yi,"__esModule",{value:!0}),yi.Forget=Xr.UDFunction({name:Xr.udfunctionNameNormalized("Forget"),body:Nr.query.Query(Nr.query.Lambda(["userRef","ref","at"],oi.WrapActionAndLog("forget",Nr.query.Delete(Nr.query.Var("ref")))))});var mi={};Object.defineProperty(mi,"__esModule",{value:!0}),mi.Own=Xr.UDFunction({name:Xr.udfunctionNameNormalized("Own"),body:Nr.query.Query(Nr.query.Lambda(["userRef","ref","data"],oi.WrapActionAndLog("own",Nr.query.Update(Nr.query.Var("ref"),{data:ai.logData.own()}))))});var bi={};Object.defineProperty(bi,"__esModule",{value:!0}),bi.Replace=Xr.UDFunction({name:Xr.udfunctionNameNormalized("Replace"),body:Nr.query.Query(Nr.query.Lambda(["userRef","ref","data"],oi.WrapActionAndLog("replace",Nr.query.Do(Nr.query.Replace(Nr.query.Var("ref"),{data:Nr.query.Var("data")}),Nr.query.Update(Nr.query.Var("ref"),{data:ai.logData.replace()})))))});var gi={};Object.defineProperty(gi,"__esModule",{value:!0}),gi.Relations=Xr.UDFunction({name:Xr.udfunctionNameNormalized("Relations"),body:Nr.query.Query(Nr.query.Lambda(["userRef","ref"],Nr.query.If(Nr.query.And(Nr.query.IsRef(Nr.query.Var("ref")),Nr.query.Exists(Nr.query.Var("ref"))),Nr.query.Let({relations:Nr.query.Map(Nr.query.Paginate(Nr.query.Call(Xr.udfunctionNameNormalized("SearchQuery"),[Nr.query.Collection(Lr.collectionNameNormalized("relations")),{"parts.collection":Nr.query.Select("collection",Nr.query.Var("ref"),null)}]),{size:1e3}),e=>Nr.query.Get(e))},Nr.query.If(Nr.query.Not(Nr.query.IsEmpty(Nr.query.Var("relations"))),Nr.query.Var("relations"),[])),Nr.query.Abort("Ref doesn't exists"))))});var vi={};Object.defineProperty(vi,"__esModule",{value:!0}),vi.Reverse=Xr.UDFunction({name:Xr.udfunctionNameNormalized("Array.Reverse"),body:Nr.query.Query(Nr.query.Lambda(["arr"],Nr.query.Reduce(Nr.query.Lambda(["reversed","item"],Nr.query.Prepend(Nr.query.Var("item"),Nr.query.Var("reversed"))),[],Nr.query.Var("arr"))))});var wi={};function _i(e){for(var t in e)wi.hasOwnProperty(t)||(wi[t]=e[t])}Object.defineProperty(wi,"__esModule",{value:!0}),_i(ei),_i(ti),_i(ii),_i(ui),_i(ci),_i(li),_i(fi),_i(di),_i(hi),_i(pi),_i(yi),_i(mi),_i(bi),_i(gi),_i(vi);var qi={};Object.defineProperty(qi,"__esModule",{value:!0}),qi.user=En.Role({name:"user",membership:{resource:Nr.query.Collection("users"),predicate:Nr.query.Query(Nr.query.Lambda("ref",mn.wrapDoc("ref",on.has_role("user"))))},privileges:[En.Privilege({resource:Nr.query.Collection("users"),actions:{read:"self"}}),En.Privilege({resource:Nr.query.Function(Xr.udfunctionNameNormalized("SearchQuery")),actions:{call:"all"}})]});var xi={};Object.defineProperty(xi,"__esModule",{value:!0}),xi.system={name:"system",privileges:[En.Privilege({resource:Nr.query.Indexes(),actions:{read:"all",unrestricted_read:"all"}}),En.Privilege({resource:Nr.query.Index(Kr.indexNameNormalized("indexes__by__resource")),actions:{read:"all",unrestricted_read:"all"}}),En.Privilege({resource:Nr.query.Index(Kr.indexNameNormalized("indexes__by__terms")),actions:{read:"all",unrestricted_read:"all"}}),En.Privilege({resource:Nr.query.Function(Xr.udfunctionNameNormalized("FindIndex")),actions:{call:"all"}})]};var Ei={};function Oi(e){for(var t in e)Ei.hasOwnProperty(t)||(Ei[t]=e[t])}Object.defineProperty(Ei,"__esModule",{value:!0}),Oi(qi),Oi(xi);var Si={};Object.defineProperty(Si,"__esModule",{value:!0}),Si.users=Lr.Collection({name:"users",history_days:null,ttl_days:null});var Ci={};Object.defineProperty(Ci,"__esModule",{value:!0}),Ci.actions=Lr.Collection({name:Lr.collectionNameNormalized("actions"),history_days:null,ttl_days:null});var Ri={};Object.defineProperty(Ri,"__esModule",{value:!0}),Ri.relations=Lr.Collection({name:Lr.collectionNameNormalized("relations"),history_days:null,ttl_days:null});var Ai={};function Ti(e){for(var t in e)Ai.hasOwnProperty(t)||(Ai[t]=e[t])}Object.defineProperty(Ai,"__esModule",{value:!0}),Ti(Si),Ti(Ci),Ti(Ri);var Pi={};Object.defineProperty(Pi,"__esModule",{value:!0});const Ii=Nr.query;Pi.indexes__by__resource=Kr.Index({name:Kr.indexNameNormalized("indexes__by__resource"),source:{collection:Ii.Indexes(),fields:{source:Ii.Query(Ii.Lambda("index",Ii.Let({source:Ii.Select("source",Ii.Var("index"),!1),collection:Ii.Select("collection",Ii.Var("source"),!1)},Ii.If(Ii.IsRef(Ii.Var("collection")),Ii.Var("collection"),!1))))}},terms:[{binding:"source"}],values:[{field:["ref"]}]});var ji={};Object.defineProperty(ji,"__esModule",{value:!0});const Ni=Nr.query;ji.indexes__by__terms=Kr.Index({name:Kr.indexNameNormalized("indexes__by__terms"),source:{collection:Ni.Indexes(),fields:{terms:Ni.Query(Ni.Lambda("index",Ni.Map(Ni.Select("terms",Ni.Var("index"),[]),Ni.Lambda("term",Ni.If(Ni.Contains("binding",Ni.Var("term")),Ni.Concat(["binding:",Ni.Select("binding",Ni.Var("term"),"")],""),Ni.Concat(["term:",Ni.Concat(Ni.Select("field",Ni.Var("term"),[]),".")],""))))))}},terms:[{binding:"terms"}],values:[{field:["ref"]}]});var Mi={};function Li(e){for(var t in e)Mi.hasOwnProperty(t)||(Mi[t]=e[t])}Object.defineProperty(Mi,"__esModule",{value:!0}),Li(Pi),Li(ji);var ki={};Object.defineProperty(ki,"__esModule",{value:!0}),ki.foundation=async function(e){const t=this;let r=[];if((e={roles:!0,functions:!0,collections:!0,indexes:!0,...e}).roles)for(let n of Object.values(Ei))r.push({name:`Creating (base) role: ${n.name}`,task:()=>t.query(Nr.query.If(Nr.query.Exists(Nr.query.Role(n.name)),null,Sn.create.role(n.name)))});if(e.functions)for(let n of Object.values(wi))r.push({name:`Upserting function: ${n.name}`,task:()=>t.query(Tn.repsert.function(n)),fullError:!0});if(e.collections&&(r.push({name:`Scaffold collection: ${Ai.users.name}`,task:()=>t.collection(Ai.users).scaffold()}),r.push({name:`Scaffold collection: ${Ai.actions.name}`,task:()=>t.collection(Ai.actions).scaffold({index:["document","ts","user","name",{field:"at",binding:Nr.query.Query(Nr.query.Lambda("doc",Nr.query.Let({ts:Nr.query.Select("ts",Nr.query.Var("doc"),null)},Nr.query.If(Nr.query.IsTimestamp(Nr.query.Var("ts")),Nr.query.ToTime(Nr.query.Var("ts")),null))))}]})}),r.push({name:`Scaffold collection: ${Ai.relations.name}`,task:()=>t.collection(Ai.relations).scaffold({index:["name","parts.relation","parts.collection","parts.path"],field:[{field:"uniqueness_check",unique:!0,outputs:[{field:"data.parts.0.relation"},{field:"data.parts.0.collection"},{field:"data.parts.0.path"},{field:"data.parts.1.relation"},{field:"data.parts.1.collection"},{field:"data.parts.1.path"}]}]}),fullError:!0})),e.indexes)for(let n of Object.values(Mi))r.push({name:`Upserting index: ${n.name}`,task:()=>t.query(Rn.upsert.index(n))});if(e.roles)for(let n of Object.values(Ei))r.push({name:`Upserting role: ${n.name}`,task:()=>t.query(Rn.upsert.role(n)),fullError:!0});return jn.execute(r,{domain:"DB.foundation"})};var Di={};Object.defineProperty(Di,"__esModule",{value:!0}),Di.relation=function(e){let t=this,r={name:e,destructive:!1,parts:[]};async function n(){r.name||(r.name=Jr.name([""]));let e=r.parts.map(e=>e.relation),n=(r.parts[0],r.parts[1],[]);if(n.push({task:async()=>t.collection(Lr.collectionNameNormalized("relations")).insert({data:{relations:{}}})}),e.includes("one")&&!e.includes("many"));else if(e.includes("one")&&e.includes("many"));else if(!e.includes("many")||e.includes("one"))throw new Error(`Relation ${Jr.name} isn't right`);return jn.execute(n)}let i={many:function(e,t="~ref"){return r.parts.push({relation:"many",collection:Lr.collectionNamePlural(e),path:t}),a},one:function(e,t="~ref"){return r.parts.push({relation:"one",collection:Lr.collectionNamePlural(e),path:t}),a}},o={many:function(e,t="~ref"){return r.parts.push({relation:"many",collection:Lr.collectionNamePlural(e),path:t}),n()},one:function(e,t="~ref"){return r.parts.push({relation:"one",collection:Lr.collectionNamePlural(e),path:t}),n()}},a={connects:o,can:{have:o}};return i};var Fi={};Object.defineProperty(Fi,"__esModule",{value:!0}),Fi.Page=async function(e){return e.next().then(({value:e})=>e||{data:[]})};var Ui={};(function(e){"use strict";Object.defineProperty(Ui,"__esModule",{value:!0});const t=n({});Object.assign(window,{Biota:t.DB,BiotaQ:Nr.query,BiotaFactory:In,BiotaPage:Fi.Page}),Object.assign(e,{Biota:t.DB,BiotaQ:Nr.query,BiotaFactory:In,BiotaPage:Fi.Page})}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})}();